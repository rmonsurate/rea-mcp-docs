{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Rea MCP Integration Guide","text":"<p>Welcome to the official documentation for implementing Model Context Protocol (MCP) connectors in Rea.pro - the agentic framework and orchestration platform for running automations and consulting pods.</p> <p></p>"},{"location":"#what-is-mcp","title":"What is MCP?","text":"<p>The Model Context Protocol (MCP) is an open standard created by Anthropic that enables AI applications to connect with external data sources, tools, and workflows. Think of it as a universal \"USB-C for AI\" - a standardized way for AI agents to interact with the world.</p>"},{"location":"#rea-mcp","title":"Rea + MCP","text":"<p>Rea implements MCP in two directions:</p> Direction Description Use Cases MCP Host Rea connects to external MCP servers Access Notion, Slack, GitHub, and more MCP Server Rea exposes its capabilities to external clients Let Claude Desktop trigger Consulting Pods"},{"location":"#why-mcp-for-rea","title":"Why MCP for Rea?","text":"<p>By implementing MCP support, Rea's LLaMA-powered agents gain:</p> <ul> <li>Standardized Integrations - Connect to any MCP-compatible service using a single protocol</li> <li>Tool Access - Allow agents to search, read, write, and interact with external systems</li> <li>Resource Context - Provide agents with relevant data from connected services</li> <li>Extensibility - Easily add new integrations without modifying core agent logic</li> <li>Security - Leverage MCP's built-in security model for safe AI-to-service communication</li> </ul>"},{"location":"#quick-navigation","title":"Quick Navigation","text":"<ul> <li> <p>:material-rocket-launch: Getting Started</p> <p>New to MCP? Start here to understand the basics and get up and running quickly.</p> <p>:octicons-arrow-right-24: Introduction</p> </li> <li> <p>:material-cog: Core Concepts</p> <p>Deep dive into MCP primitives: Tools, Resources, and Prompts.</p> <p>:octicons-arrow-right-24: Learn More</p> </li> <li> <p>:material-code-braces: Implementation Guide</p> <p>Step-by-step guides for implementing MCP in PHP/Rea.</p> <p>:octicons-arrow-right-24: Start Building</p> </li> <li> <p>:material-school: Tutorials</p> <p>Practical examples including Notion MCP integration.</p> <p>:octicons-arrow-right-24: View Tutorials</p> </li> </ul>"},{"location":"#rea-platform-components","title":"Rea Platform Components","text":"<p>MCP integrates with Rea's core components:</p> Component MCP Role Description LLaMA + Reflection Tool Consumer AI engine with enhanced reasoning calls MCP tools Consulting Pods MCP Tool Multi-agent workflows exposed as callable tools Command Room MCP Resource Activity capture data available as resources n8n Workflows MCP Tool Automation workflows triggered via MCP"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>MCP uses a client-server architecture where Rea acts as both host (consuming external tools) and server (exposing Rea capabilities).</p>"},{"location":"#getting-help","title":"Getting Help","text":"<ul> <li>Documentation Issues: Open a PR on the docs repository</li> <li>Feature Requests: Submit via the Rea feedback portal</li> <li>Security Issues: Contact security@rea.pro directly</li> </ul> <p>Start with the Notion Tutorial</p> <p>If you want to see MCP in action, jump straight to our Notion MCP Tutorial for a complete, working example.</p>"},{"location":"concepts/prompts/","title":"Prompts","text":"<p>Prompts are user-controlled templates that provide predefined workflows for AI interactions.</p>"},{"location":"concepts/prompts/#overview","title":"Overview","text":"<p>Prompts differ from tools and resources in their control model:</p> Primitive Control Initiated By Tools Model-controlled AI decides Resources Application-controlled App decides Prompts User-controlled User decides <p>Prompts are typically exposed as: - Slash commands (<code>/summarize</code>) - Menu items in UI - Quick actions</p> <pre><code>sequenceDiagram\n    participant U as User\n    participant App as Application\n    participant AI as AI Agent\n    participant MCP as MCP Server\n\n    U-&gt;&gt;App: Selects \"/code-review\"\n    App-&gt;&gt;MCP: prompts/get(\"code_review\", {code: \"...\"})\n    MCP--&gt;&gt;App: Formatted prompt messages\n    App-&gt;&gt;AI: Send prompt to AI\n    AI--&gt;&gt;App: Review response\n    App--&gt;&gt;U: Display code review\n</code></pre>"},{"location":"concepts/prompts/#prompt-definition","title":"Prompt Definition","text":"<pre><code>{\n  \"name\": \"code_review\",\n  \"description\": \"Perform a code review with specific focus areas\",\n  \"arguments\": [\n    {\n      \"name\": \"code\",\n      \"description\": \"The code to review\",\n      \"required\": true\n    },\n    {\n      \"name\": \"focus\",\n      \"description\": \"Areas to focus on (security, performance, style)\",\n      \"required\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"concepts/prompts/#properties","title":"Properties","text":"Property Type Required Description <code>name</code> string Yes Unique identifier <code>description</code> string No Human-readable description <code>arguments</code> array No Input parameters"},{"location":"concepts/prompts/#argument-properties","title":"Argument Properties","text":"Property Type Required Description <code>name</code> string Yes Argument name <code>description</code> string No Description for UI <code>required</code> boolean No Is argument required?"},{"location":"concepts/prompts/#protocol-operations","title":"Protocol Operations","text":""},{"location":"concepts/prompts/#list-prompts","title":"List Prompts","text":"<pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"prompts/list\"\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"prompts\": [\n      {\n        \"name\": \"code_review\",\n        \"description\": \"Review code for issues\",\n        \"arguments\": [...]\n      },\n      {\n        \"name\": \"summarize\",\n        \"description\": \"Summarize content\",\n        \"arguments\": [...]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/prompts/#get-prompt","title":"Get Prompt","text":"<pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"method\": \"prompts/get\",\n  \"params\": {\n    \"name\": \"code_review\",\n    \"arguments\": {\n      \"code\": \"function add(a, b) { return a + b; }\",\n      \"focus\": \"performance\"\n    }\n  }\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"result\": {\n    \"description\": \"Code review focusing on performance\",\n    \"messages\": [\n      {\n        \"role\": \"user\",\n        \"content\": {\n          \"type\": \"text\",\n          \"text\": \"Please review the following code with a focus on performance:\\n\\n```javascript\\nfunction add(a, b) { return a + b; }\\n```\\n\\nProvide specific suggestions for improvement.\"\n        }\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/prompts/#message-structure","title":"Message Structure","text":"<p>Prompts return an array of messages ready for the AI:</p> <pre><code>{\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": {\n        \"type\": \"text\",\n        \"text\": \"Review this code...\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"concepts/prompts/#content-types","title":"Content Types","text":"<p>Prompt messages can include:</p> <p>Text <pre><code>{\n  \"type\": \"text\",\n  \"text\": \"Analyze this code for security issues.\"\n}\n</code></pre></p> <p>Images <pre><code>{\n  \"type\": \"image\",\n  \"data\": \"base64-encoded-image\",\n  \"mimeType\": \"image/png\"\n}\n</code></pre></p> <p>Embedded Resources <pre><code>{\n  \"type\": \"resource\",\n  \"resource\": {\n    \"uri\": \"file:///project/src/main.ts\",\n    \"mimeType\": \"text/typescript\",\n    \"text\": \"// File contents...\"\n  }\n}\n</code></pre></p>"},{"location":"concepts/prompts/#implementing-prompts-in-php","title":"Implementing Prompts in PHP","text":"<pre><code>&lt;?php\n\nuse Mcp\\Capability\\Attribute\\McpPrompt;\n\nclass CodePrompts\n{\n    #[McpPrompt(\n        name: 'code_review',\n        description: 'Review code for issues and improvements'\n    )]\n    public function codeReview(\n        string $code,\n        ?string $focus = null,\n        ?string $language = null\n    ): array {\n        $focusText = $focus\n            ? \"Focus particularly on: {$focus}\"\n            : \"Cover all aspects: security, performance, readability, and best practices\";\n\n        $languageHint = $language\n            ? \"The code is written in {$language}.\"\n            : \"\";\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Please review the following code:\n\n                    ```\n                    {$code}\n                    ```\n\n                    {$languageHint}\n\n                    {$focusText}\n\n                    Provide:\n                    1. Summary of what the code does\n                    2. Identified issues (if any)\n                    3. Specific improvement suggestions\n                    4. Overall quality assessment\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n\n    #[McpPrompt(\n        name: 'summarize_document',\n        description: 'Summarize a document or text'\n    )]\n    public function summarize(\n        string $content,\n        ?string $style = 'concise'\n    ): array {\n        $styleInstructions = match($style) {\n            'detailed' =&gt; 'Provide a comprehensive summary with key details.',\n            'bullet' =&gt; 'Use bullet points for the main takeaways.',\n            'executive' =&gt; 'Write an executive summary suitable for leadership.',\n            default =&gt; 'Provide a concise 2-3 sentence summary.',\n        };\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; \"Summarize the following content:\\n\\n{$content}\\n\\n{$styleInstructions}\"\n                ]\n            ]\n        ];\n    }\n\n    #[McpPrompt(\n        name: 'explain_concept',\n        description: 'Explain a technical concept'\n    )]\n    public function explain(\n        string $concept,\n        ?string $audience = 'developer'\n    ): array {\n        $audienceContext = match($audience) {\n            'beginner' =&gt; 'Explain as if to someone new to programming.',\n            'manager' =&gt; 'Explain in non-technical terms for a business audience.',\n            'expert' =&gt; 'Provide an in-depth technical explanation.',\n            default =&gt; 'Explain for an experienced developer.',\n        };\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; \"Explain: {$concept}\\n\\n{$audienceContext}\"\n                ]\n            ]\n        ];\n    }\n}\n</code></pre>"},{"location":"concepts/prompts/#embedding-resources-in-prompts","title":"Embedding Resources in Prompts","text":"<p>Prompts can reference MCP resources:</p> <pre><code>#[McpPrompt(name: 'analyze_file')]\npublic function analyzeFile(string $filePath): array\n{\n    // Read the file resource\n    $content = $this-&gt;resourceManager-&gt;read(\"file://{$filePath}\");\n\n    return [\n        [\n            'role' =&gt; 'user',\n            'content' =&gt; [\n                'type' =&gt; 'resource',\n                'resource' =&gt; [\n                    'uri' =&gt; \"file://{$filePath}\",\n                    'mimeType' =&gt; $content['mimeType'],\n                    'text' =&gt; $content['text']\n                ]\n            ]\n        ],\n        [\n            'role' =&gt; 'user',\n            'content' =&gt; [\n                'type' =&gt; 'text',\n                'text' =&gt; 'Analyze this file and provide insights.'\n            ]\n        ]\n    ];\n}\n</code></pre>"},{"location":"concepts/prompts/#rea-ui-integration","title":"Rea UI Integration","text":"<p>In Rea, prompts could be exposed as slash commands:</p> <pre><code>// Frontend: Register prompt commands\nconst promptCommands = await mcpClient.listPrompts();\n\npromptCommands.forEach(prompt =&gt; {\n  registerSlashCommand({\n    name: prompt.name,\n    description: prompt.description,\n    arguments: prompt.arguments,\n    execute: async (args) =&gt; {\n      const messages = await mcpClient.getPrompt(prompt.name, args);\n      return sendToAgent(messages);\n    }\n  });\n});\n</code></pre> <p>Users would interact via: - <code>/code-review [paste code]</code> - <code>/summarize [paste text]</code> - <code>/explain [concept]</code></p>"},{"location":"concepts/prompts/#best-practices","title":"Best Practices","text":""},{"location":"concepts/prompts/#1-clear-action-oriented-names","title":"1. Clear, Action-Oriented Names","text":"<pre><code>\u2713 code_review\n\u2713 summarize_document\n\u2713 generate_tests\n\n\u2717 review\n\u2717 summary\n\u2717 tests\n</code></pre>"},{"location":"concepts/prompts/#2-descriptive-arguments","title":"2. Descriptive Arguments","text":"<pre><code>#[McpPrompt(name: 'translate')]\npublic function translate(\n    string $text,        // The content to translate\n    string $targetLang,  // Target language (e.g., \"Spanish\", \"French\")\n    ?string $tone = null // Optional: formal, casual, technical\n): array { ... }\n</code></pre>"},{"location":"concepts/prompts/#3-validate-inputs","title":"3. Validate Inputs","text":"<pre><code>#[McpPrompt(name: 'code_review')]\npublic function codeReview(string $code): array\n{\n    if (strlen($code) &gt; 50000) {\n        throw new InvalidArgumentException(\n            'Code exceeds maximum length of 50,000 characters'\n        );\n    }\n\n    if (empty(trim($code))) {\n        throw new InvalidArgumentException(\n            'Code cannot be empty'\n        );\n    }\n\n    return $this-&gt;buildPrompt($code);\n}\n</code></pre>"},{"location":"concepts/prompts/#4-provide-sensible-defaults","title":"4. Provide Sensible Defaults","text":"<pre><code>#[McpPrompt(name: 'summarize')]\npublic function summarize(\n    string $content,\n    string $style = 'concise',     // Default to concise\n    int $maxLength = 500,          // Default max length\n    string $language = 'English'   // Default output language\n): array { ... }\n</code></pre>"},{"location":"concepts/prompts/#5-support-multi-turn-conversations","title":"5. Support Multi-Turn Conversations","text":"<pre><code>#[McpPrompt(name: 'interactive_review')]\npublic function interactiveReview(string $code): array\n{\n    return [\n        [\n            'role' =&gt; 'user',\n            'content' =&gt; [\n                'type' =&gt; 'text',\n                'text' =&gt; \"I'd like you to review this code: {$code}\"\n            ]\n        ],\n        [\n            'role' =&gt; 'assistant',\n            'content' =&gt; [\n                'type' =&gt; 'text',\n                'text' =&gt; \"I'll review this code. Before I begin, could you tell me:\\n1. What is the purpose of this code?\\n2. Are there specific concerns you have?\\n3. What's the target environment?\"\n            ]\n        ]\n    ];\n}\n</code></pre>"},{"location":"concepts/prompts/#dynamic-prompts","title":"Dynamic Prompts","text":"<p>Prompts can change based on server state:</p> <pre><code>#[McpPrompt(name: 'daily_standup')]\npublic function dailyStandup(): array\n{\n    // Fetch recent activity\n    $recentTasks = $this-&gt;taskService-&gt;getRecentTasks();\n    $blockers = $this-&gt;taskService-&gt;getBlockers();\n\n    $taskList = implode(\"\\n\", array_map(\n        fn($t) =&gt; \"- {$t['title']} ({$t['status']})\",\n        $recentTasks\n    ));\n\n    return [\n        [\n            'role' =&gt; 'user',\n            'content' =&gt; [\n                'type' =&gt; 'text',\n                'text' =&gt; \"Help me prepare my daily standup. Here's my recent work:\\n\\n{$taskList}\\n\\nBlockers: \" . (count($blockers) &gt; 0 ? implode(\", \", $blockers) : \"None\")\n            ]\n        ]\n    ];\n}\n</code></pre>"},{"location":"concepts/prompts/#next-steps","title":"Next Steps","text":"<ul> <li>Transports - How MCP communicates</li> <li>PHP Server Implementation - Build custom prompts</li> <li>Notion Tutorial - See prompts in action</li> </ul>"},{"location":"concepts/rea-components/","title":"Rea Platform Components","text":"<p>This page documents the Rea-specific components that integrate with MCP.</p>"},{"location":"concepts/rea-components/#consulting-pods","title":"Consulting Pods","text":"<p>Consulting Pods are multi-agent workflows that orchestrate multiple specialized AI agents to accomplish complex tasks. Each pod defines:</p> <ul> <li>A set of specialized agents with specific roles</li> <li>Workflow logic for agent collaboration</li> <li>Input/output specifications</li> <li>Configuration options</li> </ul>"},{"location":"concepts/rea-components/#pod-structure","title":"Pod Structure","text":"<pre><code>class ConsultingPod\n{\n    public string $id;\n    public string $name;\n    public string $description;\n    public array $agents;         // Specialized agents in the pod\n    public array $config;         // Pod configuration\n    public string $category;      // e.g., \"research\", \"analysis\", \"creative\"\n\n    public function execute(array $inputs): PodResult;\n    public function executeAsync(array $inputs): string; // Returns job ID\n}\n</code></pre>"},{"location":"concepts/rea-components/#example-pods","title":"Example Pods","text":"Pod Name Agents Purpose Research Pod Researcher, Fact-Checker, Summarizer Deep research on topics Analysis Pod Data Analyst, Visualizer, Interpreter Analyze data and generate insights Content Pod Writer, Editor, SEO Specialist Create and optimize content Code Review Pod Reviewer, Security Analyst, Performance Expert Comprehensive code reviews"},{"location":"concepts/rea-components/#mcp-integration","title":"MCP Integration","text":"<p>Consulting Pods are exposed via MCP as:</p> <p>Tools:</p> <ul> <li><code>rea_create_pod</code> - Create a new consulting pod</li> <li><code>rea_run_pod</code> - Execute a pod with inputs</li> <li><code>rea_list_pods</code> - List available pods</li> </ul> <p>Resources:</p> <ul> <li><code>rea://pods</code> - List all pods</li> <li><code>rea://pods/{id}</code> - Get pod details and recent executions</li> </ul> <p>Prompts:</p> <ul> <li><code>rea_pod_builder</code> - Interactive prompt for designing new pods</li> </ul>"},{"location":"concepts/rea-components/#command-room","title":"Command Room","text":"<p>The Command Room is Rea's activity capture and analysis system. It collects user activity data from the Chrome extension and provides:</p> <ul> <li>Activity Logging: Records user actions across web applications</li> <li>Pattern Detection: Identifies repetitive tasks and workflows</li> <li>Automation Suggestions: Recommends automations based on patterns</li> <li>Context Awareness: Provides relevant context for AI agent decisions</li> </ul>"},{"location":"concepts/rea-components/#activity-structure","title":"Activity Structure","text":"<pre><code>class CommandRoomActivity\n{\n    public string $id;\n    public string $userId;\n    public string $app;           // Application name (e.g., \"gmail\", \"notion\")\n    public string $action;        // Action type (e.g., \"click\", \"type\", \"navigate\")\n    public array $metadata;       // Action-specific data\n    public Carbon $timestamp;\n    public ?string $sessionId;    // Group related activities\n}\n</code></pre>"},{"location":"concepts/rea-components/#data-flow","title":"Data Flow","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Chrome     \u2502\u2500\u2500\u2500\u25ba\u2502   Command Room   \u2502\u2500\u2500\u2500\u25ba\u2502   Pattern         \u2502\n\u2502  Extension   \u2502    \u2502   Service        \u2502    \u2502   Analyzer        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502                        \u2502\n                             \u25bc                        \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   Activity     \u2502       \u2502   Automation      \u2502\n                    \u2502   Database     \u2502       \u2502   Suggestions     \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/rea-components/#mcp-integration_1","title":"MCP Integration","text":"<p>Command Room is exposed via MCP as:</p> <p>Tools:</p> <ul> <li><code>rea_search_command_room</code> - Search activities by query, date range, app</li> </ul> <p>Resources:</p> <ul> <li><code>rea://command-room/recent</code> - Recent activity feed</li> <li><code>rea://command-room/patterns</code> - Detected patterns</li> </ul> <p>Prompts:</p> <ul> <li><code>rea_automation_analysis</code> - Analyze activities and suggest automations</li> </ul>"},{"location":"concepts/rea-components/#n8n-workflow-integration","title":"n8n Workflow Integration","text":"<p>Rea integrates with n8n for cross-application workflow automation. MCP extends this by:</p> <ul> <li>Allowing AI agents to trigger n8n workflows</li> <li>Exposing workflow status and results</li> <li>Enabling workflow discovery and parameter inspection</li> </ul>"},{"location":"concepts/rea-components/#mcp-integration_2","title":"MCP Integration","text":"<p>Tools:</p> <ul> <li><code>rea_trigger_workflow</code> - Trigger an n8n workflow with parameters</li> <li><code>rea_get_workflow_status</code> - Check execution status</li> </ul> <p>Resources:</p> <ul> <li><code>rea://workflows</code> - List available workflows</li> <li><code>rea://workflows/{id}</code> - Workflow details and execution history</li> </ul>"},{"location":"concepts/rea-components/#llama-agent-engine","title":"LLaMA Agent Engine","text":"<p>Rea uses LLaMA (Large Language Model Meta AI) as its primary language model, enhanced with:</p>"},{"location":"concepts/rea-components/#reflection-prompt-framework","title":"Reflection Prompt Framework","text":"<p>A 5-step reasoning framework that improves accuracy:</p> <ol> <li>Understand - Restate the user's request</li> <li>Plan - Outline steps to fulfill the request</li> <li>Execute - Carry out the plan (including tool calls)</li> <li>Verify - Check the response addresses the request</li> <li>Reflect - Consider if there's a better approach</li> </ol>"},{"location":"concepts/rea-components/#tool-integration","title":"Tool Integration","text":"<p>LLaMA's tool calling is mapped to MCP:</p> <pre><code>// MCP tool definition format\n$mcpTool = [\n    'name' =&gt; 'notion.search',\n    'description' =&gt; 'Search Notion pages',\n    'inputSchema' =&gt; [\n        'type' =&gt; 'object',\n        'properties' =&gt; [\n            'query' =&gt; ['type' =&gt; 'string']\n        ],\n        'required' =&gt; ['query']\n    ]\n];\n\n// Converted for LLaMA\n$llamaTool = [\n    'type' =&gt; 'function',\n    'function' =&gt; [\n        'name' =&gt; 'notion.search',\n        'description' =&gt; 'Search Notion pages',\n        'parameters' =&gt; $mcpTool['inputSchema']\n    ]\n];\n</code></pre>"},{"location":"concepts/rea-components/#chrome-extension","title":"Chrome Extension","text":"<p>The Rea Chrome Extension captures user activity for the Command Room:</p>"},{"location":"concepts/rea-components/#captured-data","title":"Captured Data","text":"<ul> <li>Page visits and navigation</li> <li>Click actions and form interactions</li> <li>Time spent on applications</li> <li>Cross-app workflows</li> </ul>"},{"location":"concepts/rea-components/#privacy-controls","title":"Privacy Controls","text":"<ul> <li>User-configurable capture settings</li> <li>Domain whitelist/blacklist</li> <li>Data encryption in transit</li> <li>Local processing options</li> </ul>"},{"location":"concepts/rea-components/#mcp-relevance","title":"MCP Relevance","text":"<p>The extension provides context that enhances MCP tool usage:</p> <ul> <li>Recent activity informs tool suggestions</li> <li>Patterns help predict user intent</li> <li>Cross-app context improves automation recommendations</li> </ul>"},{"location":"concepts/rea-components/#next-steps","title":"Next Steps","text":"<ul> <li>Rea Integration Guide - Full implementation details</li> <li>Custom Connectors Tutorial - Build your own MCP server</li> <li>Security Reference - Security best practices</li> </ul>"},{"location":"concepts/resources/","title":"Resources","text":"<p>Resources are application-controlled data sources that provide context to AI agents.</p>"},{"location":"concepts/resources/#overview","title":"Overview","text":"<p>While tools let AI agents take actions, resources provide read-only access to data. The key difference is control:</p> Aspect Tools Resources Control Model decides when to use Application decides what to expose Operation Read/Write Read-only Interaction AI invokes directly Application surfaces to AI Use Case Actions and computations Context and information <pre><code>graph LR\n    subgraph Application[\"Application Control\"]\n        App[Rea Platform]\n        Decision{Which resources&lt;br&gt;to show?}\n    end\n\n    subgraph MCP\n        Client[MCP Client]\n        Server[MCP Server]\n    end\n\n    subgraph Data[\"Data Sources\"]\n        Files[Files]\n        DB[Database]\n        API[API Data]\n    end\n\n    App --&gt; Decision\n    Decision --&gt; Client\n    Client --&gt; Server\n    Server --&gt; Files\n    Server --&gt; DB\n    Server --&gt; API\n</code></pre>"},{"location":"concepts/resources/#resource-structure","title":"Resource Structure","text":"<p>Each resource is identified by a unique URI:</p> <pre><code>{\n  \"uri\": \"notion://workspace/pages/abc123\",\n  \"name\": \"Project Roadmap\",\n  \"description\": \"Q4 2024 product roadmap\",\n  \"mimeType\": \"application/json\",\n  \"annotations\": {\n    \"audience\": [\"user\"],\n    \"priority\": 0.9\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#uri-schemes","title":"URI Schemes","text":"<p>Resources use URIs following RFC 3986:</p> Scheme Purpose Example <code>file://</code> Local files <code>file:///home/user/doc.md</code> <code>https://</code> Web resources <code>https://api.example.com/data</code> <code>notion://</code> Notion content <code>notion://workspace/pages/abc123</code> <code>db://</code> Database records <code>db://users/123</code>"},{"location":"concepts/resources/#resource-types","title":"Resource Types","text":""},{"location":"concepts/resources/#static-resources","title":"Static Resources","text":"<p>Fixed resources that don't change frequently:</p> <pre><code>{\n  \"uri\": \"config://app/settings\",\n  \"name\": \"Application Settings\",\n  \"mimeType\": \"application/json\"\n}\n</code></pre>"},{"location":"concepts/resources/#dynamic-resources-templates","title":"Dynamic Resources (Templates)","text":"<p>Resources with variable URIs:</p> <pre><code>{\n  \"uriTemplate\": \"notion://pages/{pageId}\",\n  \"name\": \"Notion Page\",\n  \"description\": \"Retrieve any Notion page by ID\",\n  \"mimeType\": \"application/json\"\n}\n</code></pre>"},{"location":"concepts/resources/#protocol-operations","title":"Protocol Operations","text":""},{"location":"concepts/resources/#list-resources","title":"List Resources","text":"<pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"resources/list\"\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"resources\": [\n      {\n        \"uri\": \"notion://workspace/pages/abc123\",\n        \"name\": \"Project Roadmap\",\n        \"mimeType\": \"application/json\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#read-resource","title":"Read Resource","text":"<pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"method\": \"resources/read\",\n  \"params\": {\n    \"uri\": \"notion://workspace/pages/abc123\"\n  }\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"result\": {\n    \"contents\": [\n      {\n        \"uri\": \"notion://workspace/pages/abc123\",\n        \"mimeType\": \"application/json\",\n        \"text\": \"{\\\"title\\\": \\\"Project Roadmap\\\", \\\"content\\\": \\\"...\\\"}\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#list-templates","title":"List Templates","text":"<pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 3,\n  \"method\": \"resources/templates/list\"\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 3,\n  \"result\": {\n    \"resourceTemplates\": [\n      {\n        \"uriTemplate\": \"notion://pages/{pageId}\",\n        \"name\": \"Notion Page\",\n        \"mimeType\": \"application/json\"\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#resource-subscriptions","title":"Resource Subscriptions","text":"<p>Clients can subscribe to resource changes:</p> <pre><code>// Subscribe\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 4,\n  \"method\": \"resources/subscribe\",\n  \"params\": {\n    \"uri\": \"notion://workspace/pages/abc123\"\n  }\n}\n\n// Server notification on change\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"notifications/resources/updated\",\n  \"params\": {\n    \"uri\": \"notion://workspace/pages/abc123\"\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#implementing-resources-in-php","title":"Implementing Resources in PHP","text":"<pre><code>&lt;?php\n\nuse Mcp\\Capability\\Attribute\\McpResource;\n\nclass NotionResources\n{\n    #[McpResource(\n        uri: 'notion://workspace/info',\n        name: 'Workspace Information',\n        mimeType: 'application/json'\n    )]\n    public function getWorkspaceInfo(): array\n    {\n        $user = $this-&gt;notionClient-&gt;users()-&gt;me();\n\n        return [\n            'user' =&gt; $user['name'],\n            'workspace' =&gt; $user['workspace_name'] ?? 'Unknown',\n            'type' =&gt; $user['type'],\n        ];\n    }\n\n    #[McpResource(\n        uri: 'notion://pages/{pageId}',\n        name: 'Notion Page',\n        mimeType: 'application/json',\n        isTemplate: true\n    )]\n    public function getPage(string $pageId): array\n    {\n        $page = $this-&gt;notionClient-&gt;pages()-&gt;retrieve($pageId);\n        $blocks = $this-&gt;notionClient-&gt;blocks()-&gt;children()-&gt;list($pageId);\n\n        return [\n            'id' =&gt; $page['id'],\n            'title' =&gt; $this-&gt;extractTitle($page),\n            'properties' =&gt; $page['properties'],\n            'content' =&gt; $this-&gt;formatBlocks($blocks),\n            'url' =&gt; $page['url'],\n        ];\n    }\n\n    #[McpResource(\n        uri: 'notion://databases/{databaseId}/schema',\n        name: 'Database Schema',\n        mimeType: 'application/json',\n        isTemplate: true\n    )]\n    public function getDatabaseSchema(string $databaseId): array\n    {\n        $db = $this-&gt;notionClient-&gt;databases()-&gt;retrieve($databaseId);\n\n        return [\n            'id' =&gt; $db['id'],\n            'title' =&gt; $this-&gt;extractTitle($db),\n            'properties' =&gt; array_map(fn($prop) =&gt; [\n                'name' =&gt; $prop['name'],\n                'type' =&gt; $prop['type'],\n            ], $db['properties']),\n        ];\n    }\n}\n</code></pre>"},{"location":"concepts/resources/#content-types","title":"Content Types","text":"<p>Resources can return different content types:</p>"},{"location":"concepts/resources/#text-content","title":"Text Content","text":"<pre><code>{\n  \"uri\": \"file:///docs/readme.md\",\n  \"mimeType\": \"text/markdown\",\n  \"text\": \"# Project README\\n\\nThis is the documentation...\"\n}\n</code></pre>"},{"location":"concepts/resources/#binary-content","title":"Binary Content","text":"<pre><code>{\n  \"uri\": \"file:///images/logo.png\",\n  \"mimeType\": \"image/png\",\n  \"blob\": \"base64-encoded-data...\"\n}\n</code></pre>"},{"location":"concepts/resources/#resource-annotations","title":"Resource Annotations","text":"<p>Annotations provide metadata to help applications:</p> <pre><code>{\n  \"uri\": \"notion://pages/abc123\",\n  \"annotations\": {\n    \"audience\": [\"user\", \"assistant\"],\n    \"priority\": 0.8,\n    \"lastModified\": \"2024-01-15T10:30:00Z\"\n  }\n}\n</code></pre> Annotation Type Description <code>audience</code> array Who should see: <code>user</code>, <code>assistant</code> <code>priority</code> number 0.0-1.0, higher = more relevant"},{"location":"concepts/resources/#best-practices","title":"Best Practices","text":""},{"location":"concepts/resources/#1-use-descriptive-uris","title":"1. Use Descriptive URIs","text":"<pre><code>\u2713 notion://workspace/pages/abc123\n\u2713 file:///project/src/main.ts\n\u2713 db://users/123/profile\n\n\u2717 resource://1\n\u2717 data://x\n</code></pre>"},{"location":"concepts/resources/#2-appropriate-mime-types","title":"2. Appropriate MIME Types","text":"<pre><code>\u2713 application/json - Structured data\n\u2713 text/markdown - Documentation\n\u2713 text/plain - Simple text\n\u2713 image/png - Images\n\n\u2717 application/octet-stream (unless truly binary)\n</code></pre>"},{"location":"concepts/resources/#3-efficient-resource-loading","title":"3. Efficient Resource Loading","text":"<pre><code>#[McpResource(uri: 'notion://pages/{pageId}')]\npublic function getPage(string $pageId): array\n{\n    // Use caching for frequently accessed resources\n    $cacheKey = \"notion_page_{$pageId}\";\n\n    return Cache::remember($cacheKey, 300, function () use ($pageId) {\n        return $this-&gt;fetchPage($pageId);\n    });\n}\n</code></pre>"},{"location":"concepts/resources/#4-handle-missing-resources","title":"4. Handle Missing Resources","text":"<pre><code>public function getPage(string $pageId): array\n{\n    try {\n        return $this-&gt;notionClient-&gt;pages()-&gt;retrieve($pageId);\n    } catch (NotFoundException $e) {\n        throw new ResourceNotFoundException(\n            \"Page not found: {$pageId}\",\n            uri: \"notion://pages/{$pageId}\"\n        );\n    }\n}\n</code></pre>"},{"location":"concepts/resources/#5-implement-pagination","title":"5. Implement Pagination","text":"<p>For large resource lists:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"resources/list\",\n  \"params\": {\n    \"cursor\": \"eyJwYWdlIjogMn0=\"\n  }\n}\n\n// Response includes nextCursor\n{\n  \"result\": {\n    \"resources\": [...],\n    \"nextCursor\": \"eyJwYWdlIjogM30=\"\n  }\n}\n</code></pre>"},{"location":"concepts/resources/#when-to-use-resources-vs-tools","title":"When to Use Resources vs Tools","text":"Use Resources When Use Tools When Providing context Taking actions Read-only access Modifying data Application controls visibility AI decides what to use Static or semi-static data Dynamic operations Bulk data exposure Specific queries"},{"location":"concepts/resources/#next-steps","title":"Next Steps","text":"<ul> <li>Prompts - User-controlled workflow templates</li> <li>Transports - Communication mechanisms</li> <li>PHP Server Implementation - Build your own resources</li> </ul>"},{"location":"concepts/tools/","title":"Tools","text":"<p>Tools are model-controlled functions that enable AI agents to perform actions and computations.</p>"},{"location":"concepts/tools/#overview","title":"Overview","text":"<p>Tools are the primary way AI agents interact with external systems through MCP. When an MCP server exposes tools, AI models can discover and invoke them to accomplish tasks.</p> <pre><code>sequenceDiagram\n    participant User\n    participant Agent as AI Agent\n    participant Client as MCP Client\n    participant Server as MCP Server\n    participant API as External API\n\n    User-&gt;&gt;Agent: \"Search my Notion for meeting notes\"\n    Agent-&gt;&gt;Client: tools/list\n    Client-&gt;&gt;Server: tools/list\n    Server--&gt;&gt;Client: [search, get_page, ...]\n    Client--&gt;&gt;Agent: Available tools\n\n    Agent-&gt;&gt;Agent: Decides to use \"search\" tool\n    Agent-&gt;&gt;Client: tools/call(\"search\", {query: \"meeting notes\"})\n    Client-&gt;&gt;Server: tools/call\n    Server-&gt;&gt;API: Notion API request\n    API--&gt;&gt;Server: Results\n    Server--&gt;&gt;Client: Tool result\n    Client--&gt;&gt;Agent: Search results\n    Agent--&gt;&gt;User: \"I found 5 pages about meeting notes...\"\n</code></pre>"},{"location":"concepts/tools/#tool-definition","title":"Tool Definition","text":"<p>Tools are defined with a JSON Schema:</p> <pre><code>{\n  \"name\": \"search_pages\",\n  \"description\": \"Search for pages by title or content\",\n  \"inputSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"query\": {\n        \"type\": \"string\",\n        \"description\": \"Search query\"\n      },\n      \"limit\": {\n        \"type\": \"integer\",\n        \"description\": \"Maximum results\",\n        \"default\": 10\n      }\n    },\n    \"required\": [\"query\"]\n  }\n}\n</code></pre>"},{"location":"concepts/tools/#required-properties","title":"Required Properties","text":"Property Type Description <code>name</code> string Unique identifier (max 64 chars) <code>description</code> string Human-readable description <code>inputSchema</code> object JSON Schema for parameters"},{"location":"concepts/tools/#optional-properties","title":"Optional Properties","text":"Property Type Description <code>title</code> string Display name for UI <code>annotations</code> object Metadata (audience, priority)"},{"location":"concepts/tools/#tool-execution-flow","title":"Tool Execution Flow","text":""},{"location":"concepts/tools/#1-discovery","title":"1. Discovery","text":"<p>The client requests available tools:</p> <pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/list\"\n}\n\n// Response\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"tools\": [\n      {\n        \"name\": \"search_pages\",\n        \"description\": \"Search for pages\",\n        \"inputSchema\": {...}\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"concepts/tools/#2-invocation","title":"2. Invocation","text":"<p>The AI model calls the tool:</p> <pre><code>// Request\n{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"search_pages\",\n    \"arguments\": {\n      \"query\": \"meeting notes\",\n      \"limit\": 5\n    }\n  }\n}\n</code></pre>"},{"location":"concepts/tools/#3-response","title":"3. Response","text":"<p>The server returns results:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 2,\n  \"result\": {\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"{\\\"results\\\": [{\\\"id\\\": \\\"abc123\\\", \\\"title\\\": \\\"Meeting Notes\\\"}]}\"\n      }\n    ],\n    \"isError\": false\n  }\n}\n</code></pre>"},{"location":"concepts/tools/#content-types","title":"Content Types","text":"<p>Tool responses can include multiple content types:</p>"},{"location":"concepts/tools/#text-content","title":"Text Content","text":"<pre><code>{\n  \"type\": \"text\",\n  \"text\": \"Search completed. Found 5 results.\"\n}\n</code></pre>"},{"location":"concepts/tools/#image-content","title":"Image Content","text":"<pre><code>{\n  \"type\": \"image\",\n  \"data\": \"base64-encoded-image-data\",\n  \"mimeType\": \"image/png\"\n}\n</code></pre>"},{"location":"concepts/tools/#resource-links","title":"Resource Links","text":"<pre><code>{\n  \"type\": \"resource\",\n  \"resource\": {\n    \"uri\": \"file:///path/to/document.pdf\",\n    \"mimeType\": \"application/pdf\"\n  }\n}\n</code></pre>"},{"location":"concepts/tools/#implementing-tools-in-php","title":"Implementing Tools in PHP","text":"<p>Using the MCP PHP SDK:</p> <pre><code>&lt;?php\n\nuse Mcp\\Capability\\Attribute\\McpTool;\n\nclass NotionTools\n{\n    #[McpTool(\n        name: 'search_pages',\n        description: 'Search for Notion pages by query'\n    )]\n    public function searchPages(\n        string $query,\n        int $limit = 10\n    ): array {\n        // Implementation\n        $results = $this-&gt;notionClient-&gt;search([\n            'query' =&gt; $query,\n            'page_size' =&gt; $limit,\n        ]);\n\n        return [\n            'results' =&gt; array_map(fn($page) =&gt; [\n                'id' =&gt; $page['id'],\n                'title' =&gt; $this-&gt;extractTitle($page),\n                'url' =&gt; $page['url'],\n            ], $results['results']),\n        ];\n    }\n\n    #[McpTool(\n        name: 'get_page',\n        description: 'Get a Notion page by ID'\n    )]\n    public function getPage(string $pageId): array\n    {\n        $page = $this-&gt;notionClient-&gt;pages()-&gt;retrieve($pageId);\n\n        return [\n            'id' =&gt; $page['id'],\n            'title' =&gt; $this-&gt;extractTitle($page),\n            'properties' =&gt; $page['properties'],\n            'created_time' =&gt; $page['created_time'],\n            'last_edited_time' =&gt; $page['last_edited_time'],\n        ];\n    }\n}\n</code></pre>"},{"location":"concepts/tools/#best-practices","title":"Best Practices","text":""},{"location":"concepts/tools/#1-clear-naming","title":"1. Clear Naming","text":"<p>Use descriptive, action-oriented names:</p> <pre><code>\u2713 search_pages\n\u2713 create_task\n\u2713 send_message\n\n\u2717 pages\n\u2717 task\n\u2717 msg\n</code></pre>"},{"location":"concepts/tools/#2-detailed-descriptions","title":"2. Detailed Descriptions","text":"<p>Help the AI understand when to use the tool:</p> <pre><code>\u2713 \"Search for Notion pages by title or content. Returns matching pages\n   with their IDs, titles, and URLs. Use this to find specific documents.\"\n\n\u2717 \"Search pages\"\n</code></pre>"},{"location":"concepts/tools/#3-input-validation","title":"3. Input Validation","text":"<p>Always validate inputs before execution:</p> <pre><code>#[McpTool]\npublic function searchPages(string $query, int $limit = 10): array\n{\n    // Validate\n    if (strlen($query) &lt; 2) {\n        throw new InvalidArgumentException(\n            'Query must be at least 2 characters'\n        );\n    }\n\n    if ($limit &lt; 1 || $limit &gt; 100) {\n        $limit = min(max($limit, 1), 100);\n    }\n\n    // Execute\n    return $this-&gt;doSearch($query, $limit);\n}\n</code></pre>"},{"location":"concepts/tools/#4-error-handling","title":"4. Error Handling","text":"<p>Return structured errors:</p> <pre><code>try {\n    $result = $this-&gt;executeOperation();\n    return ['success' =&gt; true, 'data' =&gt; $result];\n} catch (ApiException $e) {\n    return [\n        'success' =&gt; false,\n        'error' =&gt; $e-&gt;getMessage(),\n        'code' =&gt; $e-&gt;getCode(),\n    ];\n}\n</code></pre>"},{"location":"concepts/tools/#5-human-in-the-loop","title":"5. Human-in-the-Loop","text":"<p>For destructive operations, require confirmation:</p> <pre><code>#[McpTool(\n    name: 'delete_page',\n    description: 'Delete a Notion page. DESTRUCTIVE - requires confirmation.'\n)]\npublic function deletePage(\n    string $pageId,\n    bool $confirmed = false\n): array {\n    if (!$confirmed) {\n        return [\n            'status' =&gt; 'confirmation_required',\n            'message' =&gt; 'Please confirm deletion by calling with confirmed=true',\n        ];\n    }\n\n    $this-&gt;notionClient-&gt;pages()-&gt;delete($pageId);\n    return ['status' =&gt; 'deleted', 'pageId' =&gt; $pageId];\n}\n</code></pre>"},{"location":"concepts/tools/#tool-change-notifications","title":"Tool Change Notifications","text":"<p>Servers can notify clients when tools change:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"notifications/tools/list_changed\"\n}\n</code></pre> <p>Clients should re-fetch the tool list when receiving this notification.</p>"},{"location":"concepts/tools/#security-considerations","title":"Security Considerations","text":"<ol> <li>Rate Limiting: Implement rate limits to prevent abuse</li> <li>Input Sanitization: Sanitize all user inputs</li> <li>Audit Logging: Log all tool executions</li> <li>Permission Checks: Verify user has access to requested resources</li> <li>Timeout Handling: Set reasonable timeouts for external API calls</li> </ol>"},{"location":"concepts/tools/#next-steps","title":"Next Steps","text":"<ul> <li>Resources - Application-controlled data access</li> <li>Prompts - User-controlled workflow templates</li> <li>PHP Server Implementation - Build your own tools</li> </ul>"},{"location":"concepts/transports/","title":"Transports","text":"<p>Transports define how MCP clients and servers communicate. MCP supports two primary transport mechanisms.</p> <p></p>"},{"location":"concepts/transports/#overview","title":"Overview","text":"Transport Use Case Latency Setup Complexity stdio Local processes Low Simple HTTP/SSE Remote servers Medium Moderate"},{"location":"concepts/transports/#stdio-transport","title":"stdio Transport","text":"<p>The stdio (standard input/output) transport runs the MCP server as a subprocess, communicating via standard streams.</p>"},{"location":"concepts/transports/#how-it-works","title":"How It Works","text":"<pre><code>graph LR\n    subgraph Client[\"PHP Client Process\"]\n        C[MCP Client]\n        Write[Write to stdin]\n        Read[Read from stdout]\n    end\n\n    subgraph Server[\"Server Process\"]\n        S[MCP Server]\n        In[Read stdin]\n        Out[Write stdout]\n    end\n\n    C --&gt; Write\n    Write --&gt;|JSON-RPC| In\n    In --&gt; S\n    S --&gt; Out\n    Out --&gt;|JSON-RPC| Read\n    Read --&gt; C\n</code></pre>"},{"location":"concepts/transports/#php-implementation","title":"PHP Implementation","text":"<pre><code>&lt;?php\n\nuse Symfony\\Component\\Process\\Process;\n\nclass StdioTransport\n{\n    private Process $process;\n    private $stdin;\n    private $stdout;\n\n    public function __construct(\n        private string $command,\n        private array $args = [],\n        private array $env = []\n    ) {}\n\n    public function connect(): void\n    {\n        $fullCommand = array_merge([$this-&gt;command], $this-&gt;args);\n\n        $this-&gt;process = new Process($fullCommand);\n        $this-&gt;process-&gt;setEnv(array_merge($_ENV, $this-&gt;env));\n        $this-&gt;process-&gt;setTimeout(null);\n        $this-&gt;process-&gt;start();\n\n        // Get streams\n        $this-&gt;stdin = $this-&gt;process-&gt;getInput();\n        $this-&gt;stdout = $this-&gt;process-&gt;getOutput();\n    }\n\n    public function send(array $message): void\n    {\n        $json = json_encode($message) . \"\\n\";\n        fwrite($this-&gt;stdin, $json);\n        fflush($this-&gt;stdin);\n    }\n\n    public function receive(): ?array\n    {\n        $line = fgets($this-&gt;stdout);\n\n        if ($line === false) {\n            return null;\n        }\n\n        return json_decode(trim($line), true);\n    }\n\n    public function close(): void\n    {\n        $this-&gt;process-&gt;stop(3);\n    }\n}\n</code></pre>"},{"location":"concepts/transports/#configuration-example","title":"Configuration Example","text":"<pre><code>$config = [\n    'transport' =&gt; 'stdio',\n    'command' =&gt; 'npx',\n    'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n    'env' =&gt; [\n        'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n    ],\n];\n</code></pre>"},{"location":"concepts/transports/#advantages","title":"Advantages","text":"<ul> <li>Simple setup - Just start a process</li> <li>Low latency - Direct pipe communication</li> <li>Secure - No network exposure</li> <li>Self-contained - Server lifecycle tied to client</li> </ul>"},{"location":"concepts/transports/#limitations","title":"Limitations","text":"<ul> <li>Single client - One client per server process</li> <li>Local only - Cannot run on remote machines</li> <li>Process management - Must handle crashes/restarts</li> </ul>"},{"location":"concepts/transports/#httpsse-transport","title":"HTTP/SSE Transport","text":"<p>The Streamable HTTP transport enables remote communication using HTTP POST for requests and Server-Sent Events (SSE) for notifications.</p>"},{"location":"concepts/transports/#how-it-works_1","title":"How It Works","text":"<pre><code>sequenceDiagram\n    participant C as PHP Client\n    participant S as MCP HTTP Server\n\n    Note over C,S: Session Initialization\n    C-&gt;&gt;S: POST /mcp (initialize)\n    S--&gt;&gt;C: 200 OK + Mcp-Session-Id header\n    Note over C,S: Response includes session ID\n\n    Note over C,S: Tool Execution\n    C-&gt;&gt;S: POST /mcp (tools/call)\n    Note over C: Include Mcp-Session-Id header\n    S--&gt;&gt;C: 200 OK + result\n\n    Note over C,S: Event Stream (Optional)\n    C-&gt;&gt;S: GET /mcp\n    S--&gt;&gt;C: SSE stream\n    Note over C: Receive notifications\n</code></pre>"},{"location":"concepts/transports/#php-implementation_1","title":"PHP Implementation","text":"<pre><code>&lt;?php\n\nuse GuzzleHttp\\Client;\nuse GuzzleHttp\\Psr7\\Request;\n\nclass HttpTransport\n{\n    private Client $client;\n    private ?string $sessionId = null;\n    private ?string $eventStreamUrl = null;\n\n    public function __construct(\n        private string $baseUrl,\n        private array $headers = []\n    ) {\n        $this-&gt;client = new Client([\n            'base_uri' =&gt; $this-&gt;baseUrl,\n            'timeout' =&gt; 30,\n        ]);\n    }\n\n    public function connect(): void\n    {\n        // Initial request to establish session\n        $response = $this-&gt;send([\n            'jsonrpc' =&gt; '2.0',\n            'id' =&gt; 1,\n            'method' =&gt; 'initialize',\n            'params' =&gt; [\n                'protocolVersion' =&gt; '2024-11-05',\n                'capabilities' =&gt; [],\n                'clientInfo' =&gt; [\n                    'name' =&gt; 'rea-mcp-client',\n                    'version' =&gt; '1.0.0',\n                ],\n            ],\n        ]);\n\n        // Extract session ID from response headers\n        $this-&gt;sessionId = $response-&gt;getHeader('Mcp-Session-Id')[0] ?? null;\n    }\n\n    public function send(array $message): array\n    {\n        $headers = array_merge($this-&gt;headers, [\n            'Content-Type' =&gt; 'application/json',\n        ]);\n\n        if ($this-&gt;sessionId !== null) {\n            $headers['Mcp-Session-Id'] = $this-&gt;sessionId;\n        }\n\n        $response = $this-&gt;client-&gt;post('/mcp', [\n            'headers' =&gt; $headers,\n            'json' =&gt; $message,\n        ]);\n\n        return json_decode($response-&gt;getBody()-&gt;getContents(), true);\n    }\n\n    public function openEventStream(callable $onMessage): void\n    {\n        $headers = [\n            'Accept' =&gt; 'text/event-stream',\n            'Mcp-Session-Id' =&gt; $this-&gt;sessionId,\n        ];\n\n        $response = $this-&gt;client-&gt;get('/mcp', [\n            'headers' =&gt; $headers,\n            'stream' =&gt; true,\n        ]);\n\n        $body = $response-&gt;getBody();\n\n        while (!$body-&gt;eof()) {\n            $line = $body-&gt;read(1024);\n            if (str_starts_with($line, 'data: ')) {\n                $data = json_decode(substr($line, 6), true);\n                $onMessage($data);\n            }\n        }\n    }\n\n    public function close(): void\n    {\n        if ($this-&gt;sessionId !== null) {\n            $this-&gt;client-&gt;delete('/mcp', [\n                'headers' =&gt; ['Mcp-Session-Id' =&gt; $this-&gt;sessionId],\n            ]);\n        }\n    }\n}\n</code></pre>"},{"location":"concepts/transports/#configuration-example_1","title":"Configuration Example","text":"<pre><code>$config = [\n    'transport' =&gt; 'http',\n    'url' =&gt; 'https://mcp.example.com',\n    'headers' =&gt; [\n        'Authorization' =&gt; 'Bearer ' . env('MCP_AUTH_TOKEN'),\n    ],\n    'timeout' =&gt; 30,\n];\n</code></pre>"},{"location":"concepts/transports/#http-endpoints","title":"HTTP Endpoints","text":"Endpoint Method Purpose <code>/mcp</code> POST Send JSON-RPC requests <code>/mcp</code> GET Open SSE stream for notifications <code>/mcp</code> DELETE Close session <code>/health</code> GET Health check (no auth required)"},{"location":"concepts/transports/#headers","title":"Headers","text":"Header Direction Description <code>Mcp-Session-Id</code> Both Session identifier <code>Mcp-Protocol-Version</code> Request Protocol version <code>Last-Event-ID</code> Request Resume SSE from event"},{"location":"concepts/transports/#advantages_1","title":"Advantages","text":"<ul> <li>Remote access - Connect to servers anywhere</li> <li>Multi-client - Multiple clients per server</li> <li>Scalable - Standard HTTP infrastructure</li> <li>Resumable - SSE supports reconnection</li> </ul>"},{"location":"concepts/transports/#limitations_1","title":"Limitations","text":"<ul> <li>Authentication required - Must implement auth</li> <li>Network latency - Higher than stdio</li> <li>Session management - Must handle sessions</li> </ul>"},{"location":"concepts/transports/#choosing-a-transport","title":"Choosing a Transport","text":""},{"location":"concepts/transports/#use-stdio-when","title":"Use stdio When","text":"<ul> <li>Server runs on the same machine</li> <li>Single client connection is sufficient</li> <li>You want simple deployment</li> <li>Security is paramount (no network exposure)</li> </ul>"},{"location":"concepts/transports/#use-http-when","title":"Use HTTP When","text":"<ul> <li>Server needs to run remotely</li> <li>Multiple clients need simultaneous access</li> <li>You need to scale horizontally</li> <li>Building a shared service</li> </ul>"},{"location":"concepts/transports/#security-considerations","title":"Security Considerations","text":""},{"location":"concepts/transports/#stdio-security","title":"stdio Security","text":"<pre><code>// Ensure no debug output on stdout\nini_set('display_errors', '0');\nerror_reporting(0);\n\n// Redirect errors to stderr\nini_set('error_log', 'php://stderr');\n</code></pre>"},{"location":"concepts/transports/#http-security","title":"HTTP Security","text":"<pre><code>// Validate origin header\n$origin = $request-&gt;getHeader('Origin')[0] ?? '';\nif (!in_array($origin, $allowedOrigins)) {\n    return new Response(403, [], 'Forbidden');\n}\n\n// Require authentication\nif (!$this-&gt;validateAuthToken($request)) {\n    return new Response(401, [], 'Unauthorized');\n}\n\n// Rate limiting\nif ($this-&gt;rateLimiter-&gt;tooManyAttempts($clientId)) {\n    return new Response(429, [], 'Rate limited');\n}\n</code></pre>"},{"location":"concepts/transports/#message-flow","title":"Message Flow","text":""},{"location":"concepts/transports/#json-rpc-format","title":"JSON-RPC Format","text":"<p>All messages follow JSON-RPC 2.0:</p> <p>Request: <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"search\",\n    \"arguments\": {\"query\": \"test\"}\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"content\": [{\"type\": \"text\", \"text\": \"...\"}]\n  }\n}\n</code></pre></p> <p>Notification (no id): <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"notifications/tools/list_changed\"\n}\n</code></pre></p>"},{"location":"concepts/transports/#next-steps","title":"Next Steps","text":"<ul> <li>PHP Client Implementation - Build a complete client</li> <li>PHP Server Implementation - Build your own server</li> <li>Security Reference - Secure your transports</li> </ul>"},{"location":"getting-started/architecture/","title":"MCP Architecture Overview","text":"<p>This document provides a detailed technical overview of the Model Context Protocol architecture and how it applies to Rea.</p>"},{"location":"getting-started/architecture/#core-architecture","title":"Core Architecture","text":"<p>MCP follows a client-server architecture with three main participants:</p> <pre><code>graph TB\n    subgraph Host[\"Host (Rea Platform)\"]\n        UI[User Interface]\n        Agent[AI Agent]\n        Client1[MCP Client 1]\n        Client2[MCP Client 2]\n        Client3[MCP Client N]\n    end\n\n    subgraph Servers[\"MCP Servers\"]\n        Server1[Notion Server]\n        Server2[Slack Server]\n        Server3[Custom Server]\n    end\n\n    UI --&gt; Agent\n    Agent --&gt; Client1\n    Agent --&gt; Client2\n    Agent --&gt; Client3\n    Client1 --&gt; Server1\n    Client2 --&gt; Server2\n    Client3 --&gt; Server3\n</code></pre>"},{"location":"getting-started/architecture/#component-roles","title":"Component Roles","text":""},{"location":"getting-started/architecture/#host-rea-platform","title":"Host (Rea Platform)","text":"<p>The host is the main AI application responsible for:</p> <ul> <li>Managing the user experience</li> <li>Coordinating between AI agents and MCP clients</li> <li>Aggregating capabilities from multiple servers</li> <li>Enforcing security policies</li> <li>Handling user consent for operations</li> </ul>"},{"location":"getting-started/architecture/#mcp-client","title":"MCP Client","text":"<p>Each MCP client maintains a 1:1 connection with an MCP server:</p> <ul> <li>Establishes and maintains server connection</li> <li>Handles protocol negotiation and capability exchange</li> <li>Routes requests to the appropriate server</li> <li>Manages session state</li> </ul>"},{"location":"getting-started/architecture/#mcp-server","title":"MCP Server","text":"<p>Servers expose capabilities to clients:</p> <ul> <li>Declares available tools, resources, and prompts</li> <li>Executes tool calls and returns results</li> <li>Provides resource content on request</li> <li>Can run locally (stdio) or remotely (HTTP)</li> </ul>"},{"location":"getting-started/architecture/#protocol-layers","title":"Protocol Layers","text":"<p>MCP has two distinct layers:</p>"},{"location":"getting-started/architecture/#data-layer-protocol","title":"Data Layer (Protocol)","text":"<p>The inner layer defines the message format and semantics:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"search_notion\",\n    \"arguments\": {\n      \"query\": \"meeting notes\"\n    }\n  }\n}\n</code></pre> <p>Components:</p> <ul> <li>JSON-RPC 2.0 message format</li> <li>Lifecycle management (initialize, shutdown)</li> <li>Capability negotiation</li> <li>Request/response patterns</li> <li>Notifications</li> </ul>"},{"location":"getting-started/architecture/#transport-layer","title":"Transport Layer","text":"<p>The outer layer handles communication:</p>"},{"location":"getting-started/architecture/#stdio-transport","title":"stdio Transport","text":"<p>For local process communication:</p> <pre><code>Client Process \u2190\u2192 stdin/stdout \u2190\u2192 Server Process\n</code></pre> <ul> <li>Server runs as subprocess of client</li> <li>Messages sent via standard I/O</li> <li>Simple, secure, no network exposure</li> <li>Used by Claude Desktop, VS Code, etc.</li> </ul>"},{"location":"getting-started/architecture/#streamable-http-transport","title":"Streamable HTTP Transport","text":"<p>For remote server communication:</p> <pre><code>Client \u2190\u2192 HTTP POST (requests) \u2190\u2192 Server\n       \u2190\u2192 SSE (notifications)  \u2190\u2192\n</code></pre> <ul> <li>RESTful endpoints for requests</li> <li>Server-Sent Events for real-time updates</li> <li>Session management via headers</li> <li>Supports multiple concurrent clients</li> </ul>"},{"location":"getting-started/architecture/#message-flow","title":"Message Flow","text":""},{"location":"getting-started/architecture/#initialization-sequence","title":"Initialization Sequence","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as Server\n\n    C-&gt;&gt;S: initialize(protocolVersion, capabilities, clientInfo)\n    S--&gt;&gt;C: {protocolVersion, capabilities, serverInfo}\n    C-&gt;&gt;S: notifications/initialized\n    Note over C,S: Connection established\n</code></pre>"},{"location":"getting-started/architecture/#tool-discovery-and-execution","title":"Tool Discovery and Execution","text":"<pre><code>sequenceDiagram\n    participant H as Host\n    participant C as Client\n    participant S as Server\n\n    H-&gt;&gt;C: List available tools\n    C-&gt;&gt;S: tools/list\n    S--&gt;&gt;C: {tools: [...]}\n    C--&gt;&gt;H: Tool definitions\n\n    H-&gt;&gt;C: Execute \"search_notion\"\n    C-&gt;&gt;S: tools/call(name, arguments)\n    S--&gt;&gt;C: {content: [...]}\n    C--&gt;&gt;H: Tool result\n</code></pre>"},{"location":"getting-started/architecture/#capability-negotiation","title":"Capability Negotiation","text":"<p>During initialization, both parties declare their capabilities:</p>"},{"location":"getting-started/architecture/#server-capabilities","title":"Server Capabilities","text":"<pre><code>{\n  \"capabilities\": {\n    \"tools\": {\n      \"listChanged\": true\n    },\n    \"resources\": {\n      \"subscribe\": true,\n      \"listChanged\": true\n    },\n    \"prompts\": {\n      \"listChanged\": true\n    },\n    \"logging\": {}\n  }\n}\n</code></pre>"},{"location":"getting-started/architecture/#client-capabilities","title":"Client Capabilities","text":"<pre><code>{\n  \"capabilities\": {\n    \"sampling\": {},\n    \"roots\": {\n      \"listChanged\": true\n    },\n    \"elicitation\": {}\n  }\n}\n</code></pre>"},{"location":"getting-started/architecture/#rea-specific-architecture","title":"Rea-Specific Architecture","text":"<p>Rea.pro is an agentic framework and orchestration platform that uses LLaMA with Reflection prompts for enhanced reasoning. MCP integration extends Rea's capabilities to connect with external services and expose Rea's features to other AI applications.</p>"},{"location":"getting-started/architecture/#llama-mcp-integration","title":"LLaMA + MCP Integration","text":"<p>The integration layer bridges LLaMA's tool calling with MCP's standardized protocol:</p> <ol> <li>MCP-Aware Agent receives user queries and available tools</li> <li>Reflection Prompt Builder constructs system prompts with the 5-step framework</li> <li>LLaMA processes the prompt, deciding when to call MCP tools</li> <li>MCP Host routes tool calls to the appropriate connected servers</li> <li>Results flow back through the agent for final response generation</li> </ol>"},{"location":"getting-started/architecture/#dual-mcp-architecture","title":"Dual MCP Architecture","text":"<p>Rea implements MCP in two directions:</p> <pre><code>                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502                      REA.PRO                            \u2502\n                    \u2502                                                          \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502   Notion    \u2502\u25c4\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2524  MCP HOST    \u2502           \u2502    MCP SERVER        \u2502\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u25ba\u2502 Claude       \u2502\n\u2502   Slack     \u2502     \u2502  \u2502  (Client)    \u2502           \u2502    (Exposes Rea)     \u2502   \u2502     \u2502 Desktop      \u2502\n\u2502   GitHub    \u2502     \u2502  \u2502              \u2502           \u2502                      \u2502   \u2502     \u2502              \u2502\n\u2502   Custom    \u2502     \u2502  \u2502 Consumes     \u2502           \u2502 Provides:            \u2502   \u2502     \u2502 Cursor       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502  \u2502 external     \u2502           \u2502 - Consulting Pods    \u2502   \u2502     \u2502              \u2502\n                    \u2502  \u2502 MCP tools    \u2502           \u2502 - Command Room       \u2502   \u2502     \u2502 Other MCP    \u2502\n                    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518           \u2502 - n8n Workflows      \u2502   \u2502     \u2502 Clients      \u2502\n                    \u2502         \u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    \u2502         \u2502                              \u2502               \u2502\n                    \u2502         \u25bc                              \u25bc               \u2502\n                    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n                    \u2502  \u2502              LLaMA + Reflection                 \u2502   \u2502\n                    \u2502  \u2502                                                  \u2502   \u2502\n                    \u2502  \u2502   System Prompt + Tool Definitions + Context    \u2502   \u2502\n                    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/architecture/#consulting-pods-via-mcp","title":"Consulting Pods via MCP","text":"<p>Rea's Consulting Pods (multi-agent workflows) are exposed as MCP tools, allowing external clients to:</p> <ul> <li>Create new consulting pods for complex tasks</li> <li>Execute existing pods with custom inputs</li> <li>Query pod results and execution history</li> </ul>"},{"location":"getting-started/architecture/#command-room-integration","title":"Command Room Integration","text":"<p>The Command Room captures user activity via browser extension and provides:</p> <ul> <li>Resources: Recent activity data accessible via <code>rea://command-room/recent</code></li> <li>Tools: <code>rea_search_command_room</code> for querying historical activities</li> <li>Prompts: <code>rea_automation_analysis</code> for suggesting automations based on patterns</li> </ul>"},{"location":"getting-started/architecture/#proposed-rea-mcp-architecture","title":"Proposed Rea MCP Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                       Rea Platform (Laravel)                         \u2502\n\u2502                                                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502   API       \u2502\u2500\u2500\u2500\u25ba\u2502   Agent     \u2502\u2500\u2500\u2500\u25ba\u2502  Reflection Prompt      \u2502  \u2502\n\u2502  \u2502 Controller  \u2502    \u2502   Service   \u2502    \u2502  Builder                \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                            \u2502                                          \u2502\n\u2502                            \u25bc                                          \u2502\n\u2502                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                  \u2502\n\u2502                   \u2502  MCP Manager   \u2502                                  \u2502\n\u2502                   \u2502    Service     \u2502                                  \u2502\n\u2502                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                  \u2502\n\u2502                           \u2502                                           \u2502\n\u2502         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                        \u2502\n\u2502         \u25bc                 \u25bc                 \u25bc                        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                 \u2502\n\u2502  \u2502 Stdio      \u2502    \u2502 HTTP       \u2502    \u2502 Custom     \u2502                 \u2502\n\u2502  \u2502 Client     \u2502    \u2502 Client     \u2502    \u2502 Client     \u2502                 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                 \u2502                 \u2502\n         \u25bc                 \u25bc                 \u25bc\n  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n  \u2502 Local      \u2502    \u2502 Remote     \u2502    \u2502 Remote     \u2502\n  \u2502 Server     \u2502    \u2502 Server     \u2502    \u2502 Server     \u2502\n  \u2502 (stdio)    \u2502    \u2502 (HTTP)     \u2502    \u2502 (HTTP)     \u2502\n  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/architecture/#key-components","title":"Key Components","text":""},{"location":"getting-started/architecture/#mcp-manager-service","title":"MCP Manager Service","text":"<p>Central service managing all MCP connections:</p> <pre><code>class MCPManagerService\n{\n    private array $clients = [];\n\n    public function registerServer(string $name, ServerConfig $config): void\n    {\n        $client = $this-&gt;createClient($config);\n        $client-&gt;initialize();\n        $this-&gt;clients[$name] = $client;\n    }\n\n    public function getTools(): array\n    {\n        $tools = [];\n        foreach ($this-&gt;clients as $name =&gt; $client) {\n            $serverTools = $client-&gt;listTools();\n            foreach ($serverTools as $tool) {\n                $tools[\"{$name}.{$tool['name']}\"] = $tool;\n            }\n        }\n        return $tools;\n    }\n\n    public function callTool(string $fullName, array $arguments): mixed\n    {\n        [$serverName, $toolName] = explode('.', $fullName, 2);\n        return $this-&gt;clients[$serverName]-&gt;callTool($toolName, $arguments);\n    }\n}\n</code></pre>"},{"location":"getting-started/architecture/#server-configuration","title":"Server Configuration","text":"<pre><code>class ServerConfig\n{\n    public function __construct(\n        public string $name,\n        public TransportType $transport,\n        public ?string $command = null,      // For stdio\n        public ?array $args = null,          // For stdio\n        public ?string $url = null,          // For HTTP\n        public array $env = [],\n        public array $headers = [],\n    ) {}\n}\n</code></pre>"},{"location":"getting-started/architecture/#security-considerations","title":"Security Considerations","text":""},{"location":"getting-started/architecture/#authentication-flow","title":"Authentication Flow","text":"<pre><code>sequenceDiagram\n    participant U as User\n    participant R as Rea\n    participant M as MCP Client\n    participant S as MCP Server\n    participant A as External API\n\n    U-&gt;&gt;R: Configure integration\n    R-&gt;&gt;R: Store credentials securely\n\n    U-&gt;&gt;R: Request action\n    R-&gt;&gt;M: Call tool with auth\n    M-&gt;&gt;S: Request with token\n    S-&gt;&gt;A: API call with credentials\n    A--&gt;&gt;S: Response\n    S--&gt;&gt;M: Tool result\n    M--&gt;&gt;R: Result\n    R--&gt;&gt;U: Display result\n</code></pre>"},{"location":"getting-started/architecture/#security-layers","title":"Security Layers","text":"<ol> <li>Transport Security</li> <li>HTTPS for remote servers</li> <li> <p>Process isolation for local servers</p> </li> <li> <p>Authentication</p> </li> <li>API tokens stored in Rea's secure storage</li> <li> <p>Passed to servers via environment or headers</p> </li> <li> <p>Authorization</p> </li> <li>User consent for sensitive operations</li> <li>Per-server permission configuration</li> <li> <p>Tool-level access control</p> </li> <li> <p>Input Validation</p> </li> <li>Schema validation via JSON Schema</li> <li>Sanitization of all inputs</li> </ol>"},{"location":"getting-started/architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"getting-started/architecture/#connection-pooling","title":"Connection Pooling","text":"<p>Maintain persistent connections to frequently-used servers:</p> <pre><code>class ConnectionPool\n{\n    private array $connections = [];\n    private int $maxConnections = 10;\n\n    public function getConnection(string $serverId): MCPClient\n    {\n        if (!isset($this-&gt;connections[$serverId])) {\n            $this-&gt;connections[$serverId] = $this-&gt;createConnection($serverId);\n        }\n        return $this-&gt;connections[$serverId];\n    }\n}\n</code></pre>"},{"location":"getting-started/architecture/#caching","title":"Caching","text":"<p>Cache tool definitions and resource metadata:</p> <pre><code>class MCPCache\n{\n    public function cacheTools(string $serverId, array $tools, int $ttl = 300): void\n    {\n        Cache::put(\"mcp.tools.{$serverId}\", $tools, $ttl);\n    }\n\n    public function getCachedTools(string $serverId): ?array\n    {\n        return Cache::get(\"mcp.tools.{$serverId}\");\n    }\n}\n</code></pre>"},{"location":"getting-started/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Guide - Get started with MCP</li> <li>PHP Client Implementation - Build the MCP client</li> <li>Rea Integration - Integrate with Rea</li> </ul> <p>Architecture Decision Records</p> <p>Major architectural decisions should be documented in ADRs within the Rea codebase.</p>"},{"location":"getting-started/introduction/","title":"Introduction to MCP","text":""},{"location":"getting-started/introduction/#what-is-the-model-context-protocol","title":"What is the Model Context Protocol?","text":"<p>The Model Context Protocol (MCP) is an open-source standard developed by Anthropic for connecting AI applications to external systems. It provides a unified way for Large Language Models (LLMs) and AI agents to:</p> <ul> <li>Access external data sources</li> <li>Execute tools and functions</li> <li>Use predefined workflows and prompts</li> </ul>"},{"location":"getting-started/introduction/#the-problem-mcp-solves","title":"The Problem MCP Solves","text":"<p>Before MCP, every AI integration required custom code:</p> <pre><code>Without MCP:\nAI App \u2192 Custom Notion Code \u2192 Notion API\nAI App \u2192 Custom Slack Code \u2192 Slack API\nAI App \u2192 Custom Database Code \u2192 Database\nAI App \u2192 Custom GitHub Code \u2192 GitHub API\n</code></pre> <p>This approach has significant drawbacks:</p> <ul> <li>Duplication: Each AI app reimplements the same integrations</li> <li>Inconsistency: Different apps handle the same APIs differently</li> <li>Maintenance burden: Updates to APIs require changes everywhere</li> <li>Security risks: Multiple implementations mean multiple attack surfaces</li> </ul>"},{"location":"getting-started/introduction/#the-mcp-solution","title":"The MCP Solution","text":"<p>MCP standardizes the connection layer:</p> <pre><code>With MCP:\nAI App \u2192 MCP Client \u2192 MCP Server (Notion) \u2192 Notion API\n                   \u2192 MCP Server (Slack) \u2192 Slack API\n                   \u2192 MCP Server (Database) \u2192 Database\n                   \u2192 MCP Server (GitHub) \u2192 GitHub API\n</code></pre> <p>Benefits:</p> <ul> <li>Write once, use everywhere: MCP servers work with any MCP-compatible client</li> <li>Consistent interface: All integrations follow the same patterns</li> <li>Centralized security: Security handled at the protocol level</li> <li>Growing ecosystem: Community-built servers for popular services</li> </ul>"},{"location":"getting-started/introduction/#key-concepts","title":"Key Concepts","text":""},{"location":"getting-started/introduction/#three-primitives","title":"Three Primitives","text":"<p>MCP defines three core primitives for AI interaction:</p> Primitive Control Purpose Example Tools Model-controlled Execute actions Search database, send email Resources Application-controlled Provide context File contents, API data Prompts User-controlled Workflow templates Code review, summarization"},{"location":"getting-started/introduction/#communication-model","title":"Communication Model","text":"<p>MCP uses JSON-RPC 2.0 over two transport types:</p> <ol> <li>stdio - For local processes (command-line tools)</li> <li>Streamable HTTP - For remote servers (web services)</li> </ol> <pre><code>sequenceDiagram\n    participant Host as Rea (Host)\n    participant Client as MCP Client\n    participant Server as MCP Server\n\n    Host-&gt;&gt;Client: Initialize\n    Client-&gt;&gt;Server: initialize request\n    Server--&gt;&gt;Client: capabilities response\n    Client--&gt;&gt;Host: Ready\n\n    Host-&gt;&gt;Client: List tools\n    Client-&gt;&gt;Server: tools/list\n    Server--&gt;&gt;Client: Available tools\n    Client--&gt;&gt;Host: Tool definitions\n\n    Host-&gt;&gt;Client: Call tool\n    Client-&gt;&gt;Server: tools/call\n    Server--&gt;&gt;Client: Tool result\n    Client--&gt;&gt;Host: Result\n</code></pre>"},{"location":"getting-started/introduction/#mcp-in-the-rea-context","title":"MCP in the Rea Context","text":"<p>For Rea to support MCP, the platform needs to act as an MCP Host with MCP Client capabilities:</p>"},{"location":"getting-started/introduction/#current-rea-architecture","title":"Current Rea Architecture","text":"<pre><code>User \u2192 Rea UI \u2192 Rea Backend (Laravel/PHP) \u2192 AI Agents \u2192 ?\n</code></pre>"},{"location":"getting-started/introduction/#target-architecture-with-mcp","title":"Target Architecture with MCP","text":"<pre><code>User \u2192 Rea UI \u2192 Rea Backend \u2192 AI Agents \u2192 MCP Client \u2192 MCP Servers\n                                              \u2193\n                                         Notion, Slack,\n                                         Database, etc.\n</code></pre>"},{"location":"getting-started/introduction/#implementation-requirements","title":"Implementation Requirements","text":"<ol> <li>MCP Client in PHP - Protocol implementation for connecting to servers</li> <li>Server Management - Configuration and lifecycle for multiple MCP servers</li> <li>Agent Integration - Exposing MCP tools to Rea's AI agents</li> <li>Security Layer - Authentication and authorization for server connections</li> </ol>"},{"location":"getting-started/introduction/#whats-next","title":"What's Next?","text":"<p>Now that you understand what MCP is, proceed to:</p> <ul> <li>Architecture Overview - Detailed technical architecture</li> <li>Quick Start - Get MCP running in Rea</li> <li>Notion Tutorial - Complete working example</li> </ul> <p>Official Documentation</p> <p>For the complete MCP specification, visit modelcontextprotocol.io</p>"},{"location":"getting-started/quickstart/","title":"Quick Start Guide","text":"<p>Get MCP working with Rea in under 15 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Rea platform (v1.15+)</li> <li>PHP 8.1+ with Composer</li> <li>Node.js 18+ (for running MCP servers)</li> <li>A Notion account (for this tutorial)</li> </ul>"},{"location":"getting-started/quickstart/#step-1-install-the-php-mcp-sdk","title":"Step 1: Install the PHP MCP SDK","text":"<p>Add the MCP SDK to your Rea installation:</p> <pre><code>composer require mcp/sdk\n</code></pre> <p>SDK Status</p> <p>The PHP MCP SDK is currently in active development. Check the official repository for the latest version.</p>"},{"location":"getting-started/quickstart/#step-2-create-a-notion-integration","title":"Step 2: Create a Notion Integration","text":"<ol> <li>Go to Notion Integrations</li> <li>Click \"New integration\"</li> <li>Configure:</li> <li>Name: <code>Rea MCP Integration</code></li> <li>Associated workspace: Select your workspace</li> <li>Capabilities: Enable all (Read, Update, Insert, Comment)</li> <li>Click Submit</li> <li>Copy the Internal Integration Token (starts with <code>ntn_</code>)</li> </ol>"},{"location":"getting-started/quickstart/#step-3-grant-notion-access","title":"Step 3: Grant Notion Access","text":"<p>For each Notion page/database you want to access:</p> <ol> <li>Open the page in Notion</li> <li>Click \"...\" (menu) \u2192 \"Add connections\"</li> <li>Select your <code>Rea MCP Integration</code></li> </ol>"},{"location":"getting-started/quickstart/#step-4-configure-mcp-server","title":"Step 4: Configure MCP Server","text":"<p>Create an MCP configuration file in your Rea project:</p> JSON ConfigurationPHP Configuration config/mcp-servers.json<pre><code>{\n  \"servers\": {\n    \"notion\": {\n      \"transport\": \"stdio\",\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"@notionhq/notion-mcp-server\"],\n      \"env\": {\n        \"NOTION_TOKEN\": \"${NOTION_TOKEN}\"\n      }\n    }\n  }\n}\n</code></pre> config/mcp.php<pre><code>&lt;?php\n\nreturn [\n    'servers' =&gt; [\n        'notion' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n            'env' =&gt; [\n                'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n            ],\n        ],\n    ],\n];\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-set-environment-variable","title":"Step 5: Set Environment Variable","text":"<p>Add your Notion token to <code>.env</code>:</p> .env<pre><code>NOTION_TOKEN=ntn_your_token_here\n</code></pre> <p>Security Warning</p> <p>Never commit API tokens to version control. Always use environment variables.</p>"},{"location":"getting-started/quickstart/#step-6-initialize-mcp-in-rea","title":"Step 6: Initialize MCP in Rea","text":"<p>Create a service to manage MCP connections:</p> app/Services/MCPService.php<pre><code>&lt;?php\n\nnamespace App\\Services;\n\nuse Mcp\\Client\\Client;\nuse Mcp\\Client\\Transport\\StdioClientTransport;\n\nclass MCPService\n{\n    private array $clients = [];\n\n    public function __construct(\n        private array $config\n    ) {}\n\n    public function connect(string $serverName): void\n    {\n        $serverConfig = $this-&gt;config['servers'][$serverName];\n\n        $transport = new StdioClientTransport(\n            command: $serverConfig['command'],\n            args: $serverConfig['args'],\n            env: array_map(\n                fn($v) =&gt; str_starts_with($v, '${')\n                    ? getenv(trim($v, '${}'))\n                    : $v,\n                $serverConfig['env']\n            )\n        );\n\n        $client = new Client([\n            'name' =&gt; 'rea-mcp-client',\n            'version' =&gt; '1.0.0',\n        ]);\n\n        $client-&gt;connect($transport);\n\n        $this-&gt;clients[$serverName] = $client;\n    }\n\n    public function listTools(string $serverName): array\n    {\n        return $this-&gt;clients[$serverName]-&gt;listTools();\n    }\n\n    public function callTool(string $serverName, string $toolName, array $args): mixed\n    {\n        return $this-&gt;clients[$serverName]-&gt;callTool([\n            'name' =&gt; $toolName,\n            'arguments' =&gt; $args,\n        ]);\n    }\n}\n</code></pre>"},{"location":"getting-started/quickstart/#step-7-test-the-connection","title":"Step 7: Test the Connection","text":"<p>Create a simple test command:</p> app/Console/Commands/TestMCP.php<pre><code>&lt;?php\n\nnamespace App\\Console\\Commands;\n\nuse App\\Services\\MCPService;\nuse Illuminate\\Console\\Command;\n\nclass TestMCP extends Command\n{\n    protected $signature = 'mcp:test';\n    protected $description = 'Test MCP connection';\n\n    public function handle(MCPService $mcp): int\n    {\n        $this-&gt;info('Connecting to Notion MCP server...');\n        $mcp-&gt;connect('notion');\n\n        $this-&gt;info('Listing available tools:');\n        $tools = $mcp-&gt;listTools('notion');\n\n        foreach ($tools as $tool) {\n            $this-&gt;line(\"  - {$tool['name']}: {$tool['description']}\");\n        }\n\n        $this-&gt;info('Testing search...');\n        $result = $mcp-&gt;callTool('notion', 'search', [\n            'query' =&gt; 'test',\n        ]);\n\n        $this-&gt;info('Search results:');\n        $this-&gt;line(json_encode($result, JSON_PRETTY_PRINT));\n\n        return 0;\n    }\n}\n</code></pre> <p>Run the test:</p> <pre><code>php artisan mcp:test\n</code></pre>"},{"location":"getting-started/quickstart/#expected-output","title":"Expected Output","text":"<pre><code>Connecting to Notion MCP server...\nListing available tools:\n  - search: Search for pages and databases\n  - get_page: Retrieve a page by ID\n  - create_page: Create a new page\n  - update_page: Update an existing page\n  - query_database: Query a database\n  ...\n\nTesting search...\nSearch results:\n{\n  \"results\": [\n    {\n      \"id\": \"abc123...\",\n      \"title\": \"Test Page\",\n      \"type\": \"page\"\n    }\n  ]\n}\n</code></pre>"},{"location":"getting-started/quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"getting-started/quickstart/#command-not-found-npx","title":"\"Command not found: npx\"","text":"<p>Ensure Node.js is installed and in your PATH:</p> <pre><code>which npx\nnode --version\n</code></pre>"},{"location":"getting-started/quickstart/#token-invalid-error","title":"\"Token invalid\" Error","text":"<ol> <li>Verify your token starts with <code>ntn_</code></li> <li>Regenerate the token in Notion integration settings</li> <li>Check the <code>.env</code> file has no extra whitespace</li> </ol>"},{"location":"getting-started/quickstart/#object-not-found-error","title":"\"Object not found\" Error","text":"<p>The integration doesn't have access to the page/database:</p> <ol> <li>Open the Notion page</li> <li>Click \"...\" \u2192 \"Add connections\"</li> <li>Select your integration</li> </ol>"},{"location":"getting-started/quickstart/#connection-timeout","title":"Connection Timeout","text":"<p>The MCP server may be taking too long to start:</p> <pre><code>$transport = new StdioClientTransport(\n    command: $serverConfig['command'],\n    args: $serverConfig['args'],\n    env: $serverConfig['env'],\n    timeout: 30000  // 30 seconds\n);\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<p>You now have MCP working with Notion. Continue with:</p> <ul> <li>Core Concepts - Understand tools, resources, and prompts</li> <li>Notion MCP Tutorial - Complete Notion integration guide</li> <li>PHP Client Implementation - Deep dive into the client</li> </ul> <p>Congratulations!</p> <p>You've successfully connected Rea to Notion via MCP. Your AI agents can now search, read, and modify Notion content.</p>"},{"location":"implementation/php-client/","title":"PHP MCP Client Implementation","text":"<p>This guide covers implementing an MCP client in PHP for integrating with Rea.</p> <p></p>"},{"location":"implementation/php-client/#overview","title":"Overview","text":"<p>An MCP client is responsible for:</p> <ol> <li>Connecting to MCP servers</li> <li>Initializing the protocol with capability negotiation</li> <li>Discovering available tools, resources, and prompts</li> <li>Executing tool calls and resource reads</li> <li>Managing the connection lifecycle</li> </ol>"},{"location":"implementation/php-client/#prerequisites","title":"Prerequisites","text":"<ul> <li>PHP 8.1+</li> <li>Composer</li> <li>Symfony Process component (for stdio)</li> <li>Guzzle HTTP client (for HTTP transport)</li> </ul> <pre><code>composer require symfony/process guzzlehttp/guzzle\n</code></pre>"},{"location":"implementation/php-client/#client-interface","title":"Client Interface","text":"app/Contracts/MCPClientInterface.php<pre><code>&lt;?php\n\nnamespace App\\Contracts;\n\ninterface MCPClientInterface\n{\n    /**\n     * Connect to the MCP server.\n     *\n     * @throws ConnectionException\n     */\n    public function connect(): void;\n\n    /**\n     * Check if connected to the server.\n     */\n    public function isConnected(): bool;\n\n    /**\n     * Get server information.\n     *\n     * @return array{name: string, version: string}\n     */\n    public function getServerInfo(): array;\n\n    /**\n     * Get server capabilities.\n     */\n    public function getCapabilities(): array;\n\n    /**\n     * List available tools.\n     *\n     * @return array&lt;int, array{\n     *     name: string,\n     *     description: string,\n     *     inputSchema: array\n     * }&gt;\n     */\n    public function listTools(): array;\n\n    /**\n     * Call a tool.\n     *\n     * @param string $name Tool name\n     * @param array $arguments Tool arguments\n     * @return array{content: array, isError?: bool}\n     * @throws ToolExecutionException\n     */\n    public function callTool(string $name, array $arguments = []): array;\n\n    /**\n     * List available resources.\n     *\n     * @return array&lt;int, array{\n     *     uri: string,\n     *     name: string,\n     *     mimeType?: string\n     * }&gt;\n     */\n    public function listResources(): array;\n\n    /**\n     * Read a resource.\n     *\n     * @param string $uri Resource URI\n     * @return array{uri: string, mimeType: string, text?: string, blob?: string}\n     */\n    public function readResource(string $uri): array;\n\n    /**\n     * List available prompts.\n     *\n     * @return array&lt;int, array{\n     *     name: string,\n     *     description?: string,\n     *     arguments?: array\n     * }&gt;\n     */\n    public function listPrompts(): array;\n\n    /**\n     * Get a prompt.\n     *\n     * @param string $name Prompt name\n     * @param array $arguments Prompt arguments\n     * @return array{description?: string, messages: array}\n     */\n    public function getPrompt(string $name, array $arguments = []): array;\n\n    /**\n     * Disconnect from the server.\n     */\n    public function disconnect(): void;\n}\n</code></pre>"},{"location":"implementation/php-client/#base-client-implementation","title":"Base Client Implementation","text":"app/Services/MCP/BaseMCPClient.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Contracts\\MCPClientInterface;\nuse App\\Exceptions\\MCPException;\nuse Illuminate\\Support\\Facades\\Log;\n\nabstract class BaseMCPClient implements MCPClientInterface\n{\n    protected bool $connected = false;\n    protected array $serverInfo = [];\n    protected array $capabilities = [];\n    protected int $requestId = 0;\n\n    protected array $config;\n\n    public function __construct(array $config)\n    {\n        $this-&gt;config = $config;\n    }\n\n    public function connect(): void\n    {\n        $this-&gt;doConnect();\n\n        // Send initialize request\n        $response = $this-&gt;sendRequest('initialize', [\n            'protocolVersion' =&gt; '2024-11-05',\n            'capabilities' =&gt; $this-&gt;getClientCapabilities(),\n            'clientInfo' =&gt; [\n                'name' =&gt; 'rea-mcp-client',\n                'version' =&gt; config('app.version', '1.0.0'),\n            ],\n        ]);\n\n        $this-&gt;serverInfo = $response['serverInfo'] ?? [];\n        $this-&gt;capabilities = $response['capabilities'] ?? [];\n\n        // Send initialized notification\n        $this-&gt;sendNotification('notifications/initialized');\n\n        $this-&gt;connected = true;\n\n        Log::info('MCP client connected', [\n            'server' =&gt; $this-&gt;serverInfo,\n            'capabilities' =&gt; $this-&gt;capabilities,\n        ]);\n    }\n\n    public function isConnected(): bool\n    {\n        return $this-&gt;connected;\n    }\n\n    public function getServerInfo(): array\n    {\n        return $this-&gt;serverInfo;\n    }\n\n    public function getCapabilities(): array\n    {\n        return $this-&gt;capabilities;\n    }\n\n    public function listTools(): array\n    {\n        $this-&gt;ensureConnected();\n\n        $response = $this-&gt;sendRequest('tools/list');\n        return $response['tools'] ?? [];\n    }\n\n    public function callTool(string $name, array $arguments = []): array\n    {\n        $this-&gt;ensureConnected();\n\n        Log::debug('Calling MCP tool', [\n            'tool' =&gt; $name,\n            'arguments' =&gt; $arguments,\n        ]);\n\n        $response = $this-&gt;sendRequest('tools/call', [\n            'name' =&gt; $name,\n            'arguments' =&gt; $arguments,\n        ]);\n\n        if (isset($response['isError']) &amp;&amp; $response['isError']) {\n            Log::warning('MCP tool returned error', [\n                'tool' =&gt; $name,\n                'error' =&gt; $response['content'],\n            ]);\n        }\n\n        return $response;\n    }\n\n    public function listResources(): array\n    {\n        $this-&gt;ensureConnected();\n\n        if (!$this-&gt;hasCapability('resources')) {\n            return [];\n        }\n\n        $response = $this-&gt;sendRequest('resources/list');\n        return $response['resources'] ?? [];\n    }\n\n    public function readResource(string $uri): array\n    {\n        $this-&gt;ensureConnected();\n\n        $response = $this-&gt;sendRequest('resources/read', [\n            'uri' =&gt; $uri,\n        ]);\n\n        return $response['contents'][0] ?? [];\n    }\n\n    public function listPrompts(): array\n    {\n        $this-&gt;ensureConnected();\n\n        if (!$this-&gt;hasCapability('prompts')) {\n            return [];\n        }\n\n        $response = $this-&gt;sendRequest('prompts/list');\n        return $response['prompts'] ?? [];\n    }\n\n    public function getPrompt(string $name, array $arguments = []): array\n    {\n        $this-&gt;ensureConnected();\n\n        return $this-&gt;sendRequest('prompts/get', [\n            'name' =&gt; $name,\n            'arguments' =&gt; $arguments,\n        ]);\n    }\n\n    public function disconnect(): void\n    {\n        if ($this-&gt;connected) {\n            $this-&gt;doDisconnect();\n            $this-&gt;connected = false;\n            Log::info('MCP client disconnected');\n        }\n    }\n\n    // Abstract methods for transport-specific implementation\n    abstract protected function doConnect(): void;\n    abstract protected function doDisconnect(): void;\n    abstract protected function sendMessage(array $message): void;\n    abstract protected function receiveMessage(int $expectedId): array;\n\n    protected function sendRequest(string $method, array $params = []): array\n    {\n        $id = ++$this-&gt;requestId;\n\n        $request = [\n            'jsonrpc' =&gt; '2.0',\n            'id' =&gt; $id,\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $request['params'] = $params;\n        }\n\n        $this-&gt;sendMessage($request);\n\n        $response = $this-&gt;receiveMessage($id);\n\n        if (isset($response['error'])) {\n            throw new MCPException(\n                $response['error']['message'],\n                $response['error']['code'] ?? 0\n            );\n        }\n\n        return $response['result'] ?? [];\n    }\n\n    protected function sendNotification(string $method, array $params = []): void\n    {\n        $notification = [\n            'jsonrpc' =&gt; '2.0',\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $notification['params'] = $params;\n        }\n\n        $this-&gt;sendMessage($notification);\n    }\n\n    protected function getClientCapabilities(): array\n    {\n        return [\n            'roots' =&gt; [\n                'listChanged' =&gt; true,\n            ],\n        ];\n    }\n\n    protected function hasCapability(string $capability): bool\n    {\n        return isset($this-&gt;capabilities[$capability]);\n    }\n\n    protected function ensureConnected(): void\n    {\n        if (!$this-&gt;connected) {\n            throw new MCPException('Not connected to MCP server');\n        }\n    }\n}\n</code></pre>"},{"location":"implementation/php-client/#stdio-client-implementation","title":"stdio Client Implementation","text":"app/Services/MCP/StdioMCPClient.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Exceptions\\MCPException;\nuse Symfony\\Component\\Process\\Process;\n\nclass StdioMCPClient extends BaseMCPClient\n{\n    private ?Process $process = null;\n    private $inputStream = null;\n    private string $outputBuffer = '';\n\n    protected function doConnect(): void\n    {\n        $command = array_merge(\n            [$this-&gt;config['command']],\n            $this-&gt;config['args'] ?? []\n        );\n\n        $env = array_merge(\n            getenv(),\n            $this-&gt;config['env'] ?? []\n        );\n\n        $this-&gt;process = new Process($command, null, $env);\n        $this-&gt;process-&gt;setTimeout(null);\n\n        // Use pipes for bidirectional communication\n        $this-&gt;process-&gt;setInput(STDIN);\n\n        $descriptors = [\n            0 =&gt; ['pipe', 'r'], // stdin\n            1 =&gt; ['pipe', 'w'], // stdout\n            2 =&gt; ['pipe', 'w'], // stderr\n        ];\n\n        $this-&gt;process-&gt;start(function ($type, $buffer) {\n            if ($type === Process::ERR) {\n                // Log stderr output\n                error_log(\"MCP stderr: {$buffer}\");\n            }\n        });\n\n        // Get the input stream\n        $pipes = $this-&gt;process-&gt;getPipes();\n        $this-&gt;inputStream = $pipes[0];\n\n        // Wait for process to be ready\n        usleep(500000); // 500ms\n\n        if (!$this-&gt;process-&gt;isRunning()) {\n            $error = $this-&gt;process-&gt;getErrorOutput();\n            throw new MCPException(\"Failed to start MCP server: {$error}\");\n        }\n    }\n\n    protected function doDisconnect(): void\n    {\n        if ($this-&gt;inputStream !== null) {\n            fclose($this-&gt;inputStream);\n            $this-&gt;inputStream = null;\n        }\n\n        if ($this-&gt;process !== null) {\n            $this-&gt;process-&gt;stop(3);\n            $this-&gt;process = null;\n        }\n\n        $this-&gt;outputBuffer = '';\n    }\n\n    protected function sendMessage(array $message): void\n    {\n        if ($this-&gt;inputStream === null) {\n            throw new MCPException('Not connected');\n        }\n\n        $json = json_encode($message, JSON_UNESCAPED_SLASHES);\n        fwrite($this-&gt;inputStream, $json . \"\\n\");\n        fflush($this-&gt;inputStream);\n    }\n\n    protected function receiveMessage(int $expectedId): array\n    {\n        $timeout = $this-&gt;config['timeout'] ?? 30;\n        $startTime = time();\n\n        while (time() - $startTime &lt; $timeout) {\n            // Read from process output\n            $output = $this-&gt;process-&gt;getIncrementalOutput();\n\n            if (!empty($output)) {\n                $this-&gt;outputBuffer .= $output;\n            }\n\n            // Try to parse complete messages\n            while (($pos = strpos($this-&gt;outputBuffer, \"\\n\")) !== false) {\n                $line = substr($this-&gt;outputBuffer, 0, $pos);\n                $this-&gt;outputBuffer = substr($this-&gt;outputBuffer, $pos + 1);\n\n                if (empty(trim($line))) {\n                    continue;\n                }\n\n                $message = json_decode($line, true);\n\n                if (json_last_error() !== JSON_ERROR_NONE) {\n                    continue;\n                }\n\n                // Check if this is the response we're waiting for\n                if (isset($message['id']) &amp;&amp; $message['id'] === $expectedId) {\n                    return $message;\n                }\n\n                // Handle notifications\n                if (!isset($message['id']) &amp;&amp; isset($message['method'])) {\n                    $this-&gt;handleNotification($message);\n                }\n            }\n\n            usleep(10000); // 10ms\n        }\n\n        throw new MCPException('Request timeout');\n    }\n\n    protected function handleNotification(array $notification): void\n    {\n        $method = $notification['method'] ?? '';\n\n        switch ($method) {\n            case 'notifications/tools/list_changed':\n                // Invalidate tools cache\n                event('mcp.tools.changed');\n                break;\n\n            case 'notifications/resources/list_changed':\n                // Invalidate resources cache\n                event('mcp.resources.changed');\n                break;\n\n            default:\n                // Log unknown notification\n                Log::debug('Unknown MCP notification', [\n                    'method' =&gt; $method,\n                ]);\n        }\n    }\n}\n</code></pre>"},{"location":"implementation/php-client/#http-client-implementation","title":"HTTP Client Implementation","text":"app/Services/MCP/HttpMCPClient.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Exceptions\\MCPException;\nuse GuzzleHttp\\Client;\nuse GuzzleHttp\\Exception\\RequestException;\n\nclass HttpMCPClient extends BaseMCPClient\n{\n    private Client $httpClient;\n    private ?string $sessionId = null;\n\n    protected function doConnect(): void\n    {\n        $this-&gt;httpClient = new Client([\n            'base_uri' =&gt; $this-&gt;config['url'],\n            'timeout' =&gt; $this-&gt;config['timeout'] ?? 30,\n            'headers' =&gt; $this-&gt;config['headers'] ?? [],\n        ]);\n    }\n\n    protected function doDisconnect(): void\n    {\n        if ($this-&gt;sessionId !== null) {\n            try {\n                $this-&gt;httpClient-&gt;delete('/mcp', [\n                    'headers' =&gt; [\n                        'Mcp-Session-Id' =&gt; $this-&gt;sessionId,\n                    ],\n                ]);\n            } catch (\\Exception $e) {\n                // Ignore disconnect errors\n            }\n\n            $this-&gt;sessionId = null;\n        }\n    }\n\n    protected function sendMessage(array $message): void\n    {\n        // For HTTP, we don't send messages separately\n        // They're sent as part of sendRequest\n    }\n\n    protected function receiveMessage(int $expectedId): array\n    {\n        // For HTTP, receiving is handled in sendRequest\n        throw new MCPException('Direct receive not supported for HTTP transport');\n    }\n\n    protected function sendRequest(string $method, array $params = []): array\n    {\n        $id = ++$this-&gt;requestId;\n\n        $request = [\n            'jsonrpc' =&gt; '2.0',\n            'id' =&gt; $id,\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $request['params'] = $params;\n        }\n\n        try {\n            $headers = [\n                'Content-Type' =&gt; 'application/json',\n            ];\n\n            if ($this-&gt;sessionId !== null) {\n                $headers['Mcp-Session-Id'] = $this-&gt;sessionId;\n            }\n\n            $response = $this-&gt;httpClient-&gt;post('/mcp', [\n                'headers' =&gt; $headers,\n                'json' =&gt; $request,\n            ]);\n\n            // Extract session ID from initialize response\n            if ($method === 'initialize') {\n                $sessionHeader = $response-&gt;getHeader('Mcp-Session-Id');\n                if (!empty($sessionHeader)) {\n                    $this-&gt;sessionId = $sessionHeader[0];\n                }\n            }\n\n            $body = json_decode($response-&gt;getBody()-&gt;getContents(), true);\n\n            if (isset($body['error'])) {\n                throw new MCPException(\n                    $body['error']['message'],\n                    $body['error']['code'] ?? 0\n                );\n            }\n\n            return $body['result'] ?? [];\n\n        } catch (RequestException $e) {\n            $statusCode = $e-&gt;hasResponse()\n                ? $e-&gt;getResponse()-&gt;getStatusCode()\n                : 0;\n\n            throw new MCPException(\n                \"HTTP request failed: {$e-&gt;getMessage()}\",\n                $statusCode\n            );\n        }\n    }\n\n    protected function sendNotification(string $method, array $params = []): void\n    {\n        $notification = [\n            'jsonrpc' =&gt; '2.0',\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $notification['params'] = $params;\n        }\n\n        try {\n            $headers = [\n                'Content-Type' =&gt; 'application/json',\n            ];\n\n            if ($this-&gt;sessionId !== null) {\n                $headers['Mcp-Session-Id'] = $this-&gt;sessionId;\n            }\n\n            $this-&gt;httpClient-&gt;post('/mcp', [\n                'headers' =&gt; $headers,\n                'json' =&gt; $notification,\n            ]);\n        } catch (\\Exception $e) {\n            // Notifications don't require responses\n            Log::warning('Failed to send MCP notification', [\n                'method' =&gt; $method,\n                'error' =&gt; $e-&gt;getMessage(),\n            ]);\n        }\n    }\n}\n</code></pre>"},{"location":"implementation/php-client/#client-factory","title":"Client Factory","text":"app/Services/MCP/MCPClientFactory.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Contracts\\MCPClientInterface;\nuse InvalidArgumentException;\n\nclass MCPClientFactory\n{\n    public static function create(array $config): MCPClientInterface\n    {\n        $transport = $config['transport'] ?? 'stdio';\n\n        return match ($transport) {\n            'stdio' =&gt; new StdioMCPClient($config),\n            'http' =&gt; new HttpMCPClient($config),\n            default =&gt; throw new InvalidArgumentException(\n                \"Unknown transport: {$transport}\"\n            ),\n        };\n    }\n}\n</code></pre>"},{"location":"implementation/php-client/#usage-example","title":"Usage Example","text":"<pre><code>&lt;?php\n\nuse App\\Services\\MCP\\MCPClientFactory;\n\n// Create client from config\n$config = [\n    'transport' =&gt; 'stdio',\n    'command' =&gt; 'npx',\n    'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n    'env' =&gt; [\n        'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n    ],\n];\n\n$client = MCPClientFactory::create($config);\n\ntry {\n    // Connect\n    $client-&gt;connect();\n    echo \"Connected to: \" . $client-&gt;getServerInfo()['name'] . \"\\n\";\n\n    // List tools\n    $tools = $client-&gt;listTools();\n    echo \"Available tools:\\n\";\n    foreach ($tools as $tool) {\n        echo \"  - {$tool['name']}: {$tool['description']}\\n\";\n    }\n\n    // Call a tool\n    $result = $client-&gt;callTool('search', [\n        'query' =&gt; 'meeting notes',\n    ]);\n\n    echo \"Search results:\\n\";\n    print_r($result);\n\n} finally {\n    $client-&gt;disconnect();\n}\n</code></pre>"},{"location":"implementation/php-client/#next-steps","title":"Next Steps","text":"<ul> <li>PHP MCP Server - Build your own MCP server</li> <li>Rea Integration - Integrate with Rea platform</li> <li>Security - Secure your implementation</li> </ul>"},{"location":"implementation/php-server/","title":"PHP MCP Server Implementation","text":"<p>This guide covers building your own MCP server in PHP to expose custom tools, resources, and prompts.</p>"},{"location":"implementation/php-server/#overview","title":"Overview","text":"<p>An MCP server exposes capabilities to clients:</p> <ul> <li>Tools - Functions the AI can call</li> <li>Resources - Data the application can access</li> <li>Prompts - Predefined workflow templates</li> </ul>"},{"location":"implementation/php-server/#using-the-php-sdk","title":"Using the PHP SDK","text":""},{"location":"implementation/php-server/#installation","title":"Installation","text":"<pre><code>composer require mcp/sdk\n</code></pre>"},{"location":"implementation/php-server/#basic-server-structure","title":"Basic Server Structure","text":"server.php<pre><code>&lt;?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\n\n// Create server\n$server = Server::builder()\n    -&gt;setServerInfo('My MCP Server', '1.0.0')\n    -&gt;setInstructions('Custom server for Rea integration')\n    -&gt;setDiscovery(__DIR__ . '/src', ['.'])\n    -&gt;build();\n\n// Run with stdio transport\n$transport = new StdioTransport();\n$server-&gt;run($transport);\n</code></pre>"},{"location":"implementation/php-server/#defining-tools","title":"Defining Tools","text":"<p>Use the <code>#[McpTool]</code> attribute to define tools:</p> src/Tools/CalculatorTools.php<pre><code>&lt;?php\n\nnamespace App\\Tools;\n\nuse Mcp\\Capability\\Attribute\\McpTool;\n\nclass CalculatorTools\n{\n    #[McpTool(\n        name: 'add',\n        description: 'Add two numbers together'\n    )]\n    public function add(int $a, int $b): int\n    {\n        return $a + $b;\n    }\n\n    #[McpTool(\n        name: 'multiply',\n        description: 'Multiply two numbers'\n    )]\n    public function multiply(float $a, float $b): float\n    {\n        return $a * $b;\n    }\n\n    #[McpTool(\n        name: 'calculate',\n        description: 'Perform a calculation with the given expression'\n    )]\n    public function calculate(\n        string $expression,\n        ?int $precision = 2\n    ): array {\n        // Safely evaluate mathematical expression\n        $result = $this-&gt;evaluateExpression($expression);\n\n        return [\n            'expression' =&gt; $expression,\n            'result' =&gt; round($result, $precision),\n        ];\n    }\n\n    private function evaluateExpression(string $expression): float\n    {\n        // Only allow safe mathematical operations\n        if (!preg_match('/^[\\d\\s\\+\\-\\*\\/\\(\\)\\.]+$/', $expression)) {\n            throw new \\InvalidArgumentException('Invalid expression');\n        }\n\n        return eval(\"return {$expression};\");\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#tool-input-schema","title":"Tool Input Schema","text":"<p>The SDK automatically generates JSON Schema from PHP type hints:</p> <pre><code>#[McpTool(name: 'create_user')]\npublic function createUser(\n    string $name,           // Required string\n    string $email,          // Required string\n    ?int $age = null,       // Optional integer\n    bool $active = true     // Optional boolean with default\n): array {\n    // Implementation\n}\n</code></pre> <p>Generates:</p> <pre><code>{\n  \"name\": \"create_user\",\n  \"inputSchema\": {\n    \"type\": \"object\",\n    \"properties\": {\n      \"name\": {\"type\": \"string\"},\n      \"email\": {\"type\": \"string\"},\n      \"age\": {\"type\": \"integer\"},\n      \"active\": {\"type\": \"boolean\", \"default\": true}\n    },\n    \"required\": [\"name\", \"email\"]\n  }\n}\n</code></pre>"},{"location":"implementation/php-server/#defining-resources","title":"Defining Resources","text":"<p>Use the <code>#[McpResource]</code> attribute:</p> src/Resources/ConfigResources.php<pre><code>&lt;?php\n\nnamespace App\\Resources;\n\nuse Mcp\\Capability\\Attribute\\McpResource;\n\nclass ConfigResources\n{\n    #[McpResource(\n        uri: 'config://app/settings',\n        name: 'Application Settings',\n        mimeType: 'application/json'\n    )]\n    public function getSettings(): array\n    {\n        return [\n            'app_name' =&gt; config('app.name'),\n            'version' =&gt; config('app.version'),\n            'environment' =&gt; config('app.env'),\n        ];\n    }\n\n    #[McpResource(\n        uri: 'file://logs/{date}',\n        name: 'Daily Log File',\n        mimeType: 'text/plain',\n        isTemplate: true\n    )]\n    public function getLogFile(string $date): string\n    {\n        $path = storage_path(\"logs/laravel-{$date}.log\");\n\n        if (!file_exists($path)) {\n            throw new \\RuntimeException(\"Log file not found: {$date}\");\n        }\n\n        return file_get_contents($path);\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#defining-prompts","title":"Defining Prompts","text":"<p>Use the <code>#[McpPrompt]</code> attribute:</p> src/Prompts/CodePrompts.php<pre><code>&lt;?php\n\nnamespace App\\Prompts;\n\nuse Mcp\\Capability\\Attribute\\McpPrompt;\n\nclass CodePrompts\n{\n    #[McpPrompt(\n        name: 'code_review',\n        description: 'Review code for issues and improvements'\n    )]\n    public function codeReview(\n        string $code,\n        ?string $language = null,\n        ?string $focus = null\n    ): array {\n        $languageHint = $language ? \"The code is written in {$language}.\" : '';\n        $focusHint = $focus ? \"Focus on: {$focus}\" : 'Cover all aspects.';\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Please review this code:\n\n                    ```{$language}\n                    {$code}\n                    ```\n\n                    {$languageHint}\n                    {$focusHint}\n\n                    Provide:\n                    1. Summary\n                    2. Issues found\n                    3. Improvements\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n\n    #[McpPrompt(\n        name: 'explain_error',\n        description: 'Explain an error message and suggest fixes'\n    )]\n    public function explainError(\n        string $error,\n        ?string $context = null\n    ): array {\n        $contextText = $context ? \"Context:\\n{$context}\\n\\n\" : '';\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; \"{$contextText}Explain this error and suggest fixes:\\n\\n{$error}\"\n                ]\n            ]\n        ];\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#database-integration-example","title":"Database Integration Example","text":"src/Tools/DatabaseTools.php<pre><code>&lt;?php\n\nnamespace App\\Tools;\n\nuse Mcp\\Capability\\Attribute\\McpTool;\nuse PDO;\n\nclass DatabaseTools\n{\n    private PDO $db;\n\n    public function __construct()\n    {\n        $this-&gt;db = new PDO(\n            getenv('DB_DSN'),\n            getenv('DB_USER'),\n            getenv('DB_PASSWORD')\n        );\n    }\n\n    #[McpTool(\n        name: 'query_users',\n        description: 'Search for users by name or email'\n    )]\n    public function queryUsers(\n        ?string $name = null,\n        ?string $email = null,\n        int $limit = 10\n    ): array {\n        $conditions = [];\n        $params = [];\n\n        if ($name !== null) {\n            $conditions[] = 'name LIKE :name';\n            $params['name'] = \"%{$name}%\";\n        }\n\n        if ($email !== null) {\n            $conditions[] = 'email LIKE :email';\n            $params['email'] = \"%{$email}%\";\n        }\n\n        $where = empty($conditions) ? '' : 'WHERE ' . implode(' AND ', $conditions);\n\n        $stmt = $this-&gt;db-&gt;prepare(\n            \"SELECT id, name, email, created_at FROM users {$where} LIMIT :limit\"\n        );\n\n        $stmt-&gt;bindValue(':limit', $limit, PDO::PARAM_INT);\n        foreach ($params as $key =&gt; $value) {\n            $stmt-&gt;bindValue(\":{$key}\", $value);\n        }\n\n        $stmt-&gt;execute();\n\n        return [\n            'users' =&gt; $stmt-&gt;fetchAll(PDO::FETCH_ASSOC),\n            'count' =&gt; $stmt-&gt;rowCount(),\n        ];\n    }\n\n    #[McpTool(\n        name: 'get_user',\n        description: 'Get a user by ID'\n    )]\n    public function getUser(int $id): ?array\n    {\n        $stmt = $this-&gt;db-&gt;prepare(\n            'SELECT id, name, email, created_at FROM users WHERE id = :id'\n        );\n        $stmt-&gt;execute(['id' =&gt; $id]);\n\n        $user = $stmt-&gt;fetch(PDO::FETCH_ASSOC);\n\n        return $user ?: null;\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#http-transport-server","title":"HTTP Transport Server","text":"<p>For remote access, use the HTTP transport:</p> http-server.php<pre><code>&lt;?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StreamableHttpTransport;\nuse Mcp\\Server\\Session\\FileSessionStore;\n\n// Create server\n$server = Server::builder()\n    -&gt;setServerInfo('My HTTP MCP Server', '1.0.0')\n    -&gt;setDiscovery(__DIR__ . '/src', ['.'])\n    -&gt;setSession(new FileSessionStore(__DIR__ . '/sessions'))\n    -&gt;build();\n\n// Configure HTTP transport\n$transport = new StreamableHttpTransport(\n    port: 8080,\n    host: '127.0.0.1',\n    authToken: getenv('MCP_AUTH_TOKEN')\n);\n\n// Run server\n$server-&gt;run($transport);\n</code></pre> <p>Run with:</p> <pre><code>MCP_AUTH_TOKEN=your-secret-token php http-server.php\n</code></pre>"},{"location":"implementation/php-server/#laravel-integration","title":"Laravel Integration","text":""},{"location":"implementation/php-server/#service-provider","title":"Service Provider","text":"app/Providers/MCPServerServiceProvider.php<pre><code>&lt;?php\n\nnamespace App\\Providers;\n\nuse Illuminate\\Support\\ServiceProvider;\nuse Mcp\\Server;\nuse Mcp\\Server\\Session\\Psr16SessionStore;\n\nclass MCPServerServiceProvider extends ServiceProvider\n{\n    public function register(): void\n    {\n        $this-&gt;app-&gt;singleton(Server::class, function ($app) {\n            return Server::builder()\n                -&gt;setServerInfo('Rea MCP Server', config('app.version'))\n                -&gt;setContainer($app)\n                -&gt;setDiscovery(app_path('MCP'), ['.'])\n                -&gt;setSession(new Psr16SessionStore(\n                    $app-&gt;make('cache.store')\n                ))\n                -&gt;build();\n        });\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#artisan-command","title":"Artisan Command","text":"app/Console/Commands/MCPServe.php<pre><code>&lt;?php\n\nnamespace App\\Console\\Commands;\n\nuse Illuminate\\Console\\Command;\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\n\nclass MCPServe extends Command\n{\n    protected $signature = 'mcp:serve';\n    protected $description = 'Start the MCP server';\n\n    public function handle(Server $server): int\n    {\n        $this-&gt;info('Starting MCP server...');\n\n        $transport = new StdioTransport();\n        $server-&gt;run($transport);\n\n        return 0;\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#security-best-practices","title":"Security Best Practices","text":""},{"location":"implementation/php-server/#input-validation","title":"Input Validation","text":"<pre><code>#[McpTool(name: 'execute_query')]\npublic function executeQuery(string $query): array\n{\n    // Validate query is read-only\n    $normalized = strtoupper(trim($query));\n\n    if (!str_starts_with($normalized, 'SELECT')) {\n        throw new \\InvalidArgumentException(\n            'Only SELECT queries are allowed'\n        );\n    }\n\n    // Check for dangerous patterns\n    $dangerous = ['DROP', 'DELETE', 'UPDATE', 'INSERT', 'TRUNCATE'];\n    foreach ($dangerous as $keyword) {\n        if (str_contains($normalized, $keyword)) {\n            throw new \\InvalidArgumentException(\n                \"Query contains forbidden keyword: {$keyword}\"\n            );\n        }\n    }\n\n    return $this-&gt;db-&gt;query($query)-&gt;fetchAll();\n}\n</code></pre>"},{"location":"implementation/php-server/#rate-limiting","title":"Rate Limiting","text":"<pre><code>#[McpTool(name: 'expensive_operation')]\npublic function expensiveOperation(string $input): array\n{\n    $key = 'mcp_rate_' . md5($input);\n\n    if (Cache::has($key)) {\n        throw new \\RuntimeException('Rate limited. Try again later.');\n    }\n\n    Cache::put($key, true, 60); // 1 minute cooldown\n\n    return $this-&gt;doExpensiveWork($input);\n}\n</code></pre>"},{"location":"implementation/php-server/#audit-logging","title":"Audit Logging","text":"<pre><code>#[McpTool(name: 'sensitive_operation')]\npublic function sensitiveOperation(int $userId): array\n{\n    Log::info('MCP sensitive operation', [\n        'tool' =&gt; 'sensitive_operation',\n        'user_id' =&gt; $userId,\n        'timestamp' =&gt; now()-&gt;toIso8601String(),\n    ]);\n\n    return $this-&gt;performOperation($userId);\n}\n</code></pre>"},{"location":"implementation/php-server/#testing-your-server","title":"Testing Your Server","text":""},{"location":"implementation/php-server/#mcp-inspector","title":"MCP Inspector","text":"<p>Use the MCP Inspector for interactive testing:</p> <pre><code>npx @modelcontextprotocol/inspector php server.php\n</code></pre> <p>This opens a web UI where you can:</p> <ul> <li>View available tools, resources, and prompts</li> <li>Test tool execution with custom arguments</li> <li>Inspect request/response messages</li> <li>Debug connection issues</li> </ul>"},{"location":"implementation/php-server/#unit-testing","title":"Unit Testing","text":"tests/Unit/CalculatorToolsTest.php<pre><code>&lt;?php\n\nnamespace Tests\\Unit;\n\nuse App\\Tools\\CalculatorTools;\nuse PHPUnit\\Framework\\TestCase;\n\nclass CalculatorToolsTest extends TestCase\n{\n    private CalculatorTools $tools;\n\n    protected function setUp(): void\n    {\n        $this-&gt;tools = new CalculatorTools();\n    }\n\n    public function test_add(): void\n    {\n        $result = $this-&gt;tools-&gt;add(2, 3);\n        $this-&gt;assertEquals(5, $result);\n    }\n\n    public function test_multiply(): void\n    {\n        $result = $this-&gt;tools-&gt;multiply(2.5, 4);\n        $this-&gt;assertEquals(10.0, $result);\n    }\n\n    public function test_calculate_with_expression(): void\n    {\n        $result = $this-&gt;tools-&gt;calculate('(2 + 3) * 4');\n        $this-&gt;assertEquals(20, $result['result']);\n    }\n\n    public function test_calculate_rejects_invalid_expression(): void\n    {\n        $this-&gt;expectException(\\InvalidArgumentException::class);\n        $this-&gt;tools-&gt;calculate('system(\"rm -rf /\")');\n    }\n}\n</code></pre>"},{"location":"implementation/php-server/#next-steps","title":"Next Steps","text":"<ul> <li>Rea Integration - Integrate with Rea platform</li> <li>Security Reference - Security best practices</li> <li>API Reference - Complete API documentation</li> </ul>"},{"location":"implementation/rea-integration/","title":"Rea MCP Integration Guide","text":"<p>This guide covers integrating MCP support into the Rea platform, leveraging existing architecture including LLaMA agents, Reflection prompts, n8n workflows, and Command Room.</p> <p></p>"},{"location":"implementation/rea-integration/#overview","title":"Overview","text":"<p>Rea.pro is an agentic framework and orchestration platform for running automations and consulting pods (multi-agent workflows). MCP integration enables Rea's AI agents to connect with external tools and data sources through a standardized protocol.</p> <p>Existing MCP Work</p> <p>A server/client pair prototype has already been initiated for Rea.pro. This documentation builds on that foundation.</p>"},{"location":"implementation/rea-integration/#architecture-vision","title":"Architecture Vision","text":"<p>Rea should implement MCP in two directions:</p> <ol> <li>MCP Host/Client - Enable Rea to connect to external MCP servers (Notion, Slack, GitHub)</li> <li>MCP Server - Expose Rea's consulting pods, automations, and Command Room to external MCP clients</li> </ol> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         REA.PRO                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502  \u2502   MCP HOST       \u2502    \u2502          MCP SERVER                 \u2502\u2502\n\u2502  \u2502  (Client Pool)   \u2502    \u2502   (Exposes Rea Capabilities)        \u2502\u2502\n\u2502  \u2502                  \u2502    \u2502                                     \u2502\u2502\n\u2502  \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502    \u2502  Tools:                            \u2502\u2502\n\u2502  \u2502 \u2502Notion Client \u2502 \u2502    \u2502  - rea_create_pod                  \u2502\u2502\n\u2502  \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502    \u2502  - rea_run_automation              \u2502\u2502\n\u2502  \u2502 \u2502Slack Client  \u2502 \u2502    \u2502  - rea_search_command_room         \u2502\u2502\n\u2502  \u2502 \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502    \u2502  - rea_query_analytics             \u2502\u2502\n\u2502  \u2502 \u2502GitHub Client \u2502 \u2502    \u2502                                     \u2502\u2502\n\u2502  \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502    \u2502  Resources:                         \u2502\u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  - rea://pods/{podId}               \u2502\u2502\n\u2502           \u2502              \u2502  - rea://workflows/{workflowId}     \u2502\u2502\n\u2502           \u25bc              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                   \u2502                       \u2502\n\u2502  \u2502   LLaMA Agent    \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                       \u2502\n\u2502  \u2502   + Reflection   \u2502                                           \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"implementation/rea-integration/#current-rea-architecture","title":"Current Rea Architecture","text":""},{"location":"implementation/rea-integration/#existing-components","title":"Existing Components","text":"Component Description MCP Relevance LLaMA Local LLM with custom system prompts Tool calling integration Reflection Prompts Prompt engineering framework Enhanced accuracy for tool use Consulting Pods Multi-agent workflows Expose as MCP tools Command Room Activity capture and automation Expose as MCP resources n8n Integration Cross-app workflow automation Complement MCP capabilities Chrome Extension User activity capture Context for MCP operations"},{"location":"implementation/rea-integration/#integration-patterns-to-leverage","title":"Integration Patterns to Leverage","text":"<p>Rea already uses:</p> <ul> <li>Token-based authentication between components</li> <li>n8n for cross-app automation</li> <li>Chrome extension for activity capture</li> <li>API integration with external services</li> </ul> <p>These patterns align well with MCP's design.</p>"},{"location":"implementation/rea-integration/#installation","title":"Installation","text":""},{"location":"implementation/rea-integration/#install-the-php-mcp-sdk","title":"Install the PHP MCP SDK","text":"<pre><code>composer require mcp/sdk\n</code></pre> <p>For Laravel-specific features:</p> <pre><code>composer require php-mcp/laravel\n</code></pre>"},{"location":"implementation/rea-integration/#core-implementation","title":"Core Implementation","text":""},{"location":"implementation/rea-integration/#mcp-host-service","title":"MCP Host Service","text":"<p>The central service managing all MCP server connections:</p> app/Services/MCP/ReaMcpHost.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse Mcp\\Client;\nuse Mcp\\Client\\Transport\\StdioTransport;\nuse Mcp\\Client\\Transport\\HttpTransport;\nuse Illuminate\\Support\\Facades\\Log;\nuse Illuminate\\Support\\Facades\\Cache;\n\nclass ReaMcpHost\n{\n    private array $clients = [];\n    private array $serverConfigs;\n\n    public function __construct()\n    {\n        $this-&gt;serverConfigs = config('mcp.servers', []);\n    }\n\n    /**\n     * Connect to an MCP server.\n     */\n    public function connect(string $serverName): Client\n    {\n        if (isset($this-&gt;clients[$serverName])) {\n            return $this-&gt;clients[$serverName];\n        }\n\n        $config = $this-&gt;serverConfigs[$serverName]\n            ?? throw new \\InvalidArgumentException(\"Unknown server: {$serverName}\");\n\n        if (!($config['enabled'] ?? true)) {\n            throw new \\RuntimeException(\"Server {$serverName} is disabled\");\n        }\n\n        $transport = $this-&gt;createTransport($config);\n\n        $client = new Client(\n            info: ['name' =&gt; 'rea-pro', 'version' =&gt; config('app.version', '1.0.0')],\n            capabilities: ['tools' =&gt; [], 'resources' =&gt; [], 'prompts' =&gt; []]\n        );\n\n        $client-&gt;connect($transport);\n        $this-&gt;clients[$serverName] = $client;\n\n        Log::info(\"Connected to MCP server: {$serverName}\");\n\n        return $client;\n    }\n\n    /**\n     * Get all available tools across connected servers.\n     */\n    public function getAvailableTools(): array\n    {\n        return Cache::remember('mcp_all_tools', 300, function () {\n            $allTools = [];\n\n            foreach (array_keys($this-&gt;serverConfigs) as $serverName) {\n                try {\n                    $client = $this-&gt;connect($serverName);\n                    $tools = $client-&gt;listTools();\n\n                    foreach ($tools as $tool) {\n                        $qualifiedName = \"{$serverName}.{$tool['name']}\";\n                        $allTools[$qualifiedName] = array_merge($tool, [\n                            'server' =&gt; $serverName,\n                            'qualifiedName' =&gt; $qualifiedName,\n                        ]);\n                    }\n                } catch (\\Exception $e) {\n                    Log::warning(\"Failed to get tools from {$serverName}: {$e-&gt;getMessage()}\");\n                }\n            }\n\n            return $allTools;\n        });\n    }\n\n    /**\n     * Call a tool by qualified name (server.toolName).\n     */\n    public function callTool(string $qualifiedName, array $arguments): mixed\n    {\n        [$serverName, $toolName] = explode('.', $qualifiedName, 2);\n\n        $client = $this-&gt;clients[$serverName]\n            ?? throw new \\RuntimeException(\"Server not connected: {$serverName}\");\n\n        Log::info(\"MCP tool call\", [\n            'server' =&gt; $serverName,\n            'tool' =&gt; $toolName,\n            'arguments' =&gt; $arguments,\n        ]);\n\n        return $client-&gt;callTool($toolName, $arguments);\n    }\n\n    /**\n     * Disconnect all clients.\n     */\n    public function disconnectAll(): void\n    {\n        foreach ($this-&gt;clients as $name =&gt; $client) {\n            try {\n                $client-&gt;disconnect();\n            } catch (\\Exception $e) {\n                Log::warning(\"Error disconnecting {$name}: {$e-&gt;getMessage()}\");\n            }\n        }\n\n        $this-&gt;clients = [];\n        Cache::forget('mcp_all_tools');\n    }\n\n    private function createTransport(array $config): mixed\n    {\n        return match ($config['transport'] ?? 'stdio') {\n            'stdio' =&gt; new StdioTransport(\n                command: $config['command'],\n                args: $config['args'] ?? [],\n                env: $this-&gt;resolveEnvVars($config['env'] ?? [])\n            ),\n            'http' =&gt; new HttpTransport(\n                url: $config['url'],\n                headers: $config['headers'] ?? []\n            ),\n            default =&gt; throw new \\InvalidArgumentException(\n                \"Unknown transport: {$config['transport']}\"\n            ),\n        };\n    }\n\n    private function resolveEnvVars(array $env): array\n    {\n        return array_map(function ($value) {\n            if (is_string($value) &amp;&amp; str_starts_with($value, 'env:')) {\n                return getenv(substr($value, 4)) ?: '';\n            }\n            return $value;\n        }, $env);\n    }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#llama-agent-integration","title":"LLaMA Agent Integration","text":""},{"location":"implementation/rea-integration/#mcp-aware-agent-with-reflection-prompts","title":"MCP-Aware Agent with Reflection Prompts","text":"<p>Integrate MCP tools with Rea's existing LLaMA agents and Reflection prompt framework:</p> app/Services/Agent/McpAwareAgent.php<pre><code>&lt;?php\n\nnamespace App\\Services\\Agent;\n\nuse App\\Services\\MCP\\ReaMcpHost;\nuse App\\Services\\LlamaClient;\nuse App\\Services\\ReflectionPromptBuilder;\n\nclass McpAwareAgent\n{\n    public function __construct(\n        private ReaMcpHost $mcpHost,\n        private LlamaClient $llama,\n        private ReflectionPromptBuilder $promptBuilder\n    ) {}\n\n    /**\n     * Process a user query with MCP tool access.\n     */\n    public function processWithTools(string $userQuery, array $context = []): AgentResponse\n    {\n        // Get available tools from all connected MCP servers\n        $tools = $this-&gt;mcpHost-&gt;getAvailableTools();\n\n        // Build system prompt with Reflection framework and tool definitions\n        $systemPrompt = $this-&gt;promptBuilder\n            -&gt;withReflection()\n            -&gt;withTools($tools)\n            -&gt;withContext($context)\n            -&gt;build();\n\n        // Get LLM response with potential tool calls\n        $response = $this-&gt;llama-&gt;chat([\n            'system' =&gt; $systemPrompt,\n            'user' =&gt; $userQuery,\n            'tools' =&gt; $this-&gt;formatToolsForLlama($tools),\n        ]);\n\n        // Execute any requested tool calls\n        if ($response-&gt;hasToolCalls()) {\n            return $this-&gt;executeToolCalls($response, $userQuery);\n        }\n\n        return new AgentResponse($response-&gt;content);\n    }\n\n    /**\n     * Execute tool calls and continue conversation.\n     */\n    private function executeToolCalls(LlamaResponse $response, string $originalQuery): AgentResponse\n    {\n        $toolResults = [];\n\n        foreach ($response-&gt;toolCalls as $call) {\n            try {\n                $result = $this-&gt;mcpHost-&gt;callTool(\n                    $call-&gt;name,\n                    $call-&gt;arguments\n                );\n\n                $toolResults[] = [\n                    'tool_call_id' =&gt; $call-&gt;id,\n                    'result' =&gt; $this-&gt;formatToolResult($result),\n                ];\n            } catch (\\Exception $e) {\n                $toolResults[] = [\n                    'tool_call_id' =&gt; $call-&gt;id,\n                    'error' =&gt; $e-&gt;getMessage(),\n                ];\n            }\n        }\n\n        // Continue conversation with tool results\n        $followUp = $this-&gt;llama-&gt;continueWithToolResults(\n            $response-&gt;conversationId,\n            $toolResults\n        );\n\n        // Recursively handle any additional tool calls\n        if ($followUp-&gt;hasToolCalls()) {\n            return $this-&gt;executeToolCalls($followUp, $originalQuery);\n        }\n\n        return new AgentResponse(\n            content: $followUp-&gt;content,\n            toolsUsed: array_map(fn($c) =&gt; $c-&gt;name, $response-&gt;toolCalls)\n        );\n    }\n\n    /**\n     * Format MCP tools for LLaMA's function calling format.\n     */\n    private function formatToolsForLlama(array $mcpTools): array\n    {\n        return array_map(function ($tool) {\n            return [\n                'type' =&gt; 'function',\n                'function' =&gt; [\n                    'name' =&gt; $tool['qualifiedName'],\n                    'description' =&gt; $tool['description'],\n                    'parameters' =&gt; $tool['inputSchema'],\n                ],\n            ];\n        }, $mcpTools);\n    }\n\n    private function formatToolResult(array $result): string\n    {\n        $content = $result['content'] ?? [];\n\n        foreach ($content as $item) {\n            if ($item['type'] === 'text') {\n                return $item['text'];\n            }\n        }\n\n        return json_encode($content);\n    }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#reflection-prompt-builder","title":"Reflection Prompt Builder","text":"<p>Extend the existing Reflection prompt framework to include MCP tools:</p> app/Services/ReflectionPromptBuilder.php<pre><code>&lt;?php\n\nnamespace App\\Services;\n\nclass ReflectionPromptBuilder\n{\n    private bool $useReflection = false;\n    private array $tools = [];\n    private array $context = [];\n\n    public function withReflection(): self\n    {\n        $this-&gt;useReflection = true;\n        return $this;\n    }\n\n    public function withTools(array $tools): self\n    {\n        $this-&gt;tools = $tools;\n        return $this;\n    }\n\n    public function withContext(array $context): self\n    {\n        $this-&gt;context = $context;\n        return $this;\n    }\n\n    public function build(): string\n    {\n        $prompt = $this-&gt;getBasePrompt();\n\n        if ($this-&gt;useReflection) {\n            $prompt .= $this-&gt;getReflectionInstructions();\n        }\n\n        if (!empty($this-&gt;tools)) {\n            $prompt .= $this-&gt;getToolInstructions();\n        }\n\n        if (!empty($this-&gt;context)) {\n            $prompt .= $this-&gt;getContextSection();\n        }\n\n        return $prompt;\n    }\n\n    private function getBasePrompt(): string\n    {\n        return &lt;&lt;&lt;PROMPT\n        You are Rea, an AI assistant within the Multiply Universe platform.\n        You help users with automations, consulting workflows, and cross-app tasks.\n\n        PROMPT;\n    }\n\n    private function getReflectionInstructions(): string\n    {\n        return &lt;&lt;&lt;PROMPT\n\n        ## Reflection Framework\n\n        Before responding, always:\n        1. **Understand**: Restate the user's request in your own words\n        2. **Plan**: Outline the steps needed to fulfill the request\n        3. **Execute**: Carry out the plan, using tools when helpful\n        4. **Verify**: Check that your response addresses the original request\n        5. **Reflect**: Consider if there's a better approach\n\n        PROMPT;\n    }\n\n    private function getToolInstructions(): string\n    {\n        $toolList = array_map(function ($tool) {\n            return \"- **{$tool['qualifiedName']}**: {$tool['description']}\";\n        }, $this-&gt;tools);\n\n        $toolListStr = implode(\"\\n\", $toolList);\n\n        return &lt;&lt;&lt;PROMPT\n\n        ## Available Tools\n\n        You have access to the following tools via MCP:\n\n        {$toolListStr}\n\n        When using tools:\n        - Use tools when they would help answer the user's question\n        - Explain what you're doing before calling a tool\n        - Summarize tool results in a helpful way\n        - Request user approval for destructive operations\n\n        PROMPT;\n    }\n\n    private function getContextSection(): string\n    {\n        $contextStr = json_encode($this-&gt;context, JSON_PRETTY_PRINT);\n\n        return &lt;&lt;&lt;PROMPT\n\n        ## Current Context\n\n        ```json\n        {$contextStr}\n        ```\n\n        PROMPT;\n    }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#exposing-rea-as-an-mcp-server","title":"Exposing Rea as an MCP Server","text":""},{"location":"implementation/rea-integration/#rea-mcp-server-implementation","title":"Rea MCP Server Implementation","text":"<p>Expose Rea's consulting pods and Command Room as MCP capabilities:</p> app/MCP/ReaMcpServer.php<pre><code>&lt;?php\n\nnamespace App\\MCP;\n\nuse Mcp\\Capability\\Attribute\\McpTool;\nuse Mcp\\Capability\\Attribute\\McpResource;\nuse Mcp\\Capability\\Attribute\\McpPrompt;\nuse App\\Services\\ConsultingPodService;\nuse App\\Services\\CommandRoomService;\nuse App\\Services\\WorkflowService;\n\nclass ReaMcpServer\n{\n    public function __construct(\n        private ConsultingPodService $podService,\n        private CommandRoomService $commandRoom,\n        private WorkflowService $workflows\n    ) {}\n\n    // =====================\n    // TOOLS\n    // =====================\n\n    #[McpTool(\n        name: 'rea_create_pod',\n        description: 'Create a new consulting pod (multi-agent workflow)'\n    )]\n    public function createPod(\n        string $name,\n        string $description,\n        array $agents,\n        ?array $config = null\n    ): array {\n        $pod = $this-&gt;podService-&gt;create([\n            'name' =&gt; $name,\n            'description' =&gt; $description,\n            'agents' =&gt; $agents,\n            'config' =&gt; $config ?? [],\n        ]);\n\n        return [\n            'status' =&gt; 'success',\n            'pod_id' =&gt; $pod-&gt;id,\n            'message' =&gt; \"Created consulting pod: {$name}\",\n        ];\n    }\n\n    #[McpTool(\n        name: 'rea_run_pod',\n        description: 'Execute a consulting pod with given inputs'\n    )]\n    public function runPod(\n        string $podId,\n        array $inputs,\n        ?bool $async = false\n    ): array {\n        $pod = $this-&gt;podService-&gt;find($podId);\n\n        if (!$pod) {\n            return ['error' =&gt; \"Pod not found: {$podId}\"];\n        }\n\n        if ($async) {\n            $jobId = $this-&gt;podService-&gt;executeAsync($pod, $inputs);\n            return [\n                'status' =&gt; 'queued',\n                'job_id' =&gt; $jobId,\n                'message' =&gt; 'Pod execution queued',\n            ];\n        }\n\n        $result = $this-&gt;podService-&gt;execute($pod, $inputs);\n\n        return [\n            'status' =&gt; 'completed',\n            'output' =&gt; $result-&gt;output,\n            'agents_used' =&gt; $result-&gt;agentsUsed,\n            'execution_time_ms' =&gt; $result-&gt;executionTime,\n        ];\n    }\n\n    #[McpTool(\n        name: 'rea_search_command_room',\n        description: 'Search Command Room for captured activities and suggestions'\n    )]\n    public function searchCommandRoom(\n        string $query,\n        ?string $dateFrom = null,\n        ?string $dateTo = null,\n        ?int $limit = 20\n    ): array {\n        $results = $this-&gt;commandRoom-&gt;search([\n            'query' =&gt; $query,\n            'date_from' =&gt; $dateFrom,\n            'date_to' =&gt; $dateTo,\n            'limit' =&gt; $limit,\n        ]);\n\n        return [\n            'results' =&gt; $results-&gt;items,\n            'total' =&gt; $results-&gt;total,\n            'suggestions' =&gt; $results-&gt;automationSuggestions,\n        ];\n    }\n\n    #[McpTool(\n        name: 'rea_trigger_workflow',\n        description: 'Trigger an n8n workflow with given parameters'\n    )]\n    public function triggerWorkflow(\n        string $workflowId,\n        array $parameters\n    ): array {\n        $execution = $this-&gt;workflows-&gt;trigger($workflowId, $parameters);\n\n        return [\n            'status' =&gt; 'triggered',\n            'execution_id' =&gt; $execution-&gt;id,\n            'workflow_name' =&gt; $execution-&gt;workflow-&gt;name,\n        ];\n    }\n\n    #[McpTool(\n        name: 'rea_list_pods',\n        description: 'List available consulting pods'\n    )]\n    public function listPods(?string $category = null): array\n    {\n        $pods = $this-&gt;podService-&gt;list($category);\n\n        return array_map(fn($pod) =&gt; [\n            'id' =&gt; $pod-&gt;id,\n            'name' =&gt; $pod-&gt;name,\n            'description' =&gt; $pod-&gt;description,\n            'agent_count' =&gt; count($pod-&gt;agents),\n            'category' =&gt; $pod-&gt;category,\n        ], $pods);\n    }\n\n    // =====================\n    // RESOURCES\n    // =====================\n\n    #[McpResource(\n        uri: 'rea://pods',\n        name: 'All Consulting Pods',\n        mimeType: 'application/json'\n    )]\n    public function getAllPods(): array\n    {\n        return $this-&gt;podService-&gt;all()-&gt;toArray();\n    }\n\n    #[McpResource(\n        uri: 'rea://pods/{podId}',\n        name: 'Consulting Pod Details',\n        mimeType: 'application/json',\n        isTemplate: true\n    )]\n    public function getPodDetails(string $podId): array\n    {\n        $pod = $this-&gt;podService-&gt;find($podId);\n\n        if (!$pod) {\n            throw new \\RuntimeException(\"Pod not found: {$podId}\");\n        }\n\n        return [\n            'id' =&gt; $pod-&gt;id,\n            'name' =&gt; $pod-&gt;name,\n            'description' =&gt; $pod-&gt;description,\n            'agents' =&gt; $pod-&gt;agents,\n            'config' =&gt; $pod-&gt;config,\n            'executions' =&gt; $pod-&gt;recentExecutions(5),\n            'created_at' =&gt; $pod-&gt;created_at-&gt;toIso8601String(),\n        ];\n    }\n\n    #[McpResource(\n        uri: 'rea://command-room/recent',\n        name: 'Recent Command Room Activity',\n        mimeType: 'application/json'\n    )]\n    public function getRecentActivity(): array\n    {\n        return $this-&gt;commandRoom-&gt;getRecent(50)-&gt;toArray();\n    }\n\n    #[McpResource(\n        uri: 'rea://workflows',\n        name: 'Available Workflows',\n        mimeType: 'application/json'\n    )]\n    public function getWorkflows(): array\n    {\n        return $this-&gt;workflows-&gt;list()-&gt;toArray();\n    }\n\n    // =====================\n    // PROMPTS\n    // =====================\n\n    #[McpPrompt(\n        name: 'rea_automation_analysis',\n        description: 'Analyze Command Room data to suggest automations'\n    )]\n    public function automationAnalysis(?int $days = 7): array\n    {\n        $recentActivity = $this-&gt;commandRoom-&gt;getRecent($days * 24);\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Analyze the following Command Room activity from the past {$days} days\n                    and suggest automations that could save time:\n\n                    Activity Summary:\n                    - Total activities: {$recentActivity-&gt;count()}\n                    - Top apps used: {$recentActivity-&gt;topApps()-&gt;implode(', ')}\n                    - Repetitive patterns: {$recentActivity-&gt;patterns()-&gt;count()} detected\n\n                    Please identify:\n                    1. Repetitive tasks that could be automated\n                    2. Cross-app workflows that could be streamlined\n                    3. Time-consuming activities with automation potential\n\n                    For each suggestion, provide:\n                    - Description of the automation\n                    - Estimated time savings per week\n                    - Complexity (low/medium/high)\n                    - Recommended approach (n8n workflow, consulting pod, or MCP tool)\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n\n    #[McpPrompt(\n        name: 'rea_pod_builder',\n        description: 'Interactive prompt for designing a new consulting pod'\n    )]\n    public function podBuilder(string $objective): array\n    {\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Help me design a consulting pod for the following objective:\n\n                    **Objective:** {$objective}\n\n                    Please recommend:\n                    1. What specialized agents should be in the pod\n                    2. How the agents should collaborate\n                    3. What inputs the pod needs\n                    4. What outputs it should produce\n                    5. Any MCP integrations that would enhance it\n\n                    Format your response as a pod configuration that can be created\n                    using the rea_create_pod tool.\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#server-entry-point","title":"Server Entry Point","text":"mcp-server.php<pre><code>&lt;?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\nuse Mcp\\Server\\Session\\FileSessionStore;\n\n// Suppress output to stdout\nini_set('display_errors', '0');\nini_set('error_log', 'php://stderr');\n\n// Bootstrap Laravel (or your framework)\n$app = require_once __DIR__ . '/bootstrap/app.php';\n$kernel = $app-&gt;make(Illuminate\\Contracts\\Console\\Kernel::class);\n$kernel-&gt;bootstrap();\n\n// Create MCP server\n$server = Server::builder()\n    -&gt;setServerInfo('Rea.pro MCP Server', config('app.version', '1.0.0'))\n    -&gt;setInstructions(&lt;&lt;&lt;INSTRUCTIONS\n    Rea.pro MCP Server provides access to:\n    - Consulting Pods: Multi-agent workflows for complex tasks\n    - Command Room: Activity capture and automation suggestions\n    - Workflows: n8n-based automation triggers\n\n    Use rea_list_pods to discover available consulting pods.\n    Use rea_search_command_room to find relevant past activities.\n    INSTRUCTIONS)\n    -&gt;setContainer(app())\n    -&gt;setDiscovery(__DIR__ . '/app/MCP', ['.'])\n    -&gt;setSession(new FileSessionStore(storage_path('mcp-sessions')))\n    -&gt;build();\n\n// Run with stdio transport\n$transport = new StdioTransport();\n$server-&gt;run($transport);\n</code></pre>"},{"location":"implementation/rea-integration/#artisan-command","title":"Artisan Command","text":"app/Console/Commands/McpServe.php<pre><code>&lt;?php\n\nnamespace App\\Console\\Commands;\n\nuse Illuminate\\Console\\Command;\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\n\nclass McpServe extends Command\n{\n    protected $signature = 'mcp:serve {--transport=stdio}';\n    protected $description = 'Start the Rea MCP server';\n\n    public function handle(Server $server): int\n    {\n        $this-&gt;info('Starting Rea MCP server...');\n\n        $transport = match ($this-&gt;option('transport')) {\n            'stdio' =&gt; new StdioTransport(),\n            default =&gt; throw new \\InvalidArgumentException('Unknown transport'),\n        };\n\n        $server-&gt;run($transport);\n\n        return 0;\n    }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#configuration","title":"Configuration","text":"config/mcp.php<pre><code>&lt;?php\n\nreturn [\n    /*\n    |--------------------------------------------------------------------------\n    | External MCP Servers (Rea as Client)\n    |--------------------------------------------------------------------------\n    */\n    'servers' =&gt; [\n        'notion' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n            'env' =&gt; [\n                'NOTION_TOKEN' =&gt; 'env:NOTION_TOKEN',\n            ],\n            'enabled' =&gt; true,\n        ],\n\n        'slack' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@modelcontextprotocol/server-slack'],\n            'env' =&gt; [\n                'SLACK_BOT_TOKEN' =&gt; 'env:SLACK_BOT_TOKEN',\n                'SLACK_TEAM_ID' =&gt; 'env:SLACK_TEAM_ID',\n            ],\n            'enabled' =&gt; true,\n        ],\n\n        'filesystem' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; [\n                '-y',\n                '@modelcontextprotocol/server-filesystem',\n                storage_path('user-files'),\n            ],\n            'enabled' =&gt; true,\n        ],\n\n        'github' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@modelcontextprotocol/server-github'],\n            'env' =&gt; [\n                'GITHUB_PERSONAL_ACCESS_TOKEN' =&gt; 'env:GITHUB_TOKEN',\n            ],\n            'enabled' =&gt; false,\n        ],\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Session Configuration\n    |--------------------------------------------------------------------------\n    */\n    'session' =&gt; [\n        'driver' =&gt; env('MCP_SESSION_DRIVER', 'redis'),\n        'ttl' =&gt; env('MCP_SESSION_TTL', 3600),\n        'prefix' =&gt; 'rea-mcp-',\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Security\n    |--------------------------------------------------------------------------\n    */\n    'security' =&gt; [\n        'require_user_consent' =&gt; true,\n        'allowed_tools' =&gt; ['*'],\n        'blocked_tools' =&gt; [],\n        'audit_logging' =&gt; true,\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Caching\n    |--------------------------------------------------------------------------\n    */\n    'cache' =&gt; [\n        'enabled' =&gt; true,\n        'ttl' =&gt; 300,\n        'store' =&gt; 'redis',\n    ],\n];\n</code></pre>"},{"location":"implementation/rea-integration/#phased-rollout-plan","title":"Phased Rollout Plan","text":"<p>Based on the existing MCP prototype work and Rea's architecture:</p>"},{"location":"implementation/rea-integration/#phase-1-foundation-2-3-weeks","title":"Phase 1: Foundation (2-3 weeks)","text":"<ul> <li>[ ] Install official PHP SDK</li> <li>[ ] Implement ReaMcpHost wrapper class</li> <li>[ ] Add configuration system</li> <li>[ ] Create stdio transport handler</li> <li>[ ] Basic connection tests</li> </ul>"},{"location":"implementation/rea-integration/#phase-2-external-server-integration-3-4-weeks","title":"Phase 2: External Server Integration (3-4 weeks)","text":"<ul> <li>[ ] Integrate Notion MCP server</li> <li>[ ] Integrate Slack MCP server</li> <li>[ ] Integrate filesystem server</li> <li>[ ] Build tool discovery and caching</li> <li>[ ] Integrate with LLaMA agent prompts</li> <li>[ ] Add user consent UI</li> </ul>"},{"location":"implementation/rea-integration/#phase-3-rea-mcp-server-3-4-weeks","title":"Phase 3: Rea MCP Server (3-4 weeks)","text":"<ul> <li>[ ] Expose consulting pods as tools</li> <li>[ ] Expose Command Room as resources</li> <li>[ ] Create workflow triggers as tools</li> <li>[ ] Add automation prompts</li> <li>[ ] Implement authentication for external clients</li> </ul>"},{"location":"implementation/rea-integration/#phase-4-production-hardening-2-3-weeks","title":"Phase 4: Production Hardening (2-3 weeks)","text":"<ul> <li>[ ] Redis session management</li> <li>[ ] Comprehensive error handling</li> <li>[ ] Rate limiting per server/tool</li> <li>[ ] Monitoring and logging</li> <li>[ ] Security audit</li> <li>[ ] Performance optimization</li> </ul>"},{"location":"implementation/rea-integration/#testing-with-claude-desktop","title":"Testing with Claude Desktop","text":"<p>Configure Claude Desktop to connect to the Rea MCP server:</p> ~/Library/Application Support/Claude/claude_desktop_config.json<pre><code>{\n  \"mcpServers\": {\n    \"rea-pro\": {\n      \"command\": \"php\",\n      \"args\": [\"/path/to/rea/artisan\", \"mcp:serve\", \"--transport=stdio\"],\n      \"env\": {\n        \"REA_API_KEY\": \"your-api-key\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"implementation/rea-integration/#next-steps","title":"Next Steps","text":"<ul> <li>Notion MCP Tutorial - Detailed Notion integration</li> <li>Security Reference - Security best practices</li> <li>API Reference - Complete API documentation</li> </ul>"},{"location":"reference/api/","title":"API Reference","text":"<p>Complete API reference for MCP integration in Rea.</p>"},{"location":"reference/api/#protocol-messages","title":"Protocol Messages","text":"<p>MCP uses JSON-RPC 2.0 for all communication.</p>"},{"location":"reference/api/#request-format","title":"Request Format","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"search\",\n    \"arguments\": {\"query\": \"test\"}\n  }\n}\n</code></pre>"},{"location":"reference/api/#response-format","title":"Response Format","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"result\": {\n    \"content\": [\n      {\"type\": \"text\", \"text\": \"...\"}\n    ]\n  }\n}\n</code></pre>"},{"location":"reference/api/#error-format","title":"Error Format","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": 1,\n  \"error\": {\n    \"code\": -32600,\n    \"message\": \"Invalid Request\",\n    \"data\": {}\n  }\n}\n</code></pre>"},{"location":"reference/api/#lifecycle-methods","title":"Lifecycle Methods","text":""},{"location":"reference/api/#initialize","title":"initialize","text":"<p>Establishes connection and negotiates capabilities.</p> <p>Request: <pre><code>{\n  \"method\": \"initialize\",\n  \"params\": {\n    \"protocolVersion\": \"2024-11-05\",\n    \"capabilities\": {\n      \"roots\": {\"listChanged\": true}\n    },\n    \"clientInfo\": {\n      \"name\": \"rea-mcp-client\",\n      \"version\": \"1.0.0\"\n    }\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"protocolVersion\": \"2024-11-05\",\n    \"capabilities\": {\n      \"tools\": {\"listChanged\": true},\n      \"resources\": {\"subscribe\": true},\n      \"prompts\": {}\n    },\n    \"serverInfo\": {\n      \"name\": \"notion-mcp-server\",\n      \"version\": \"1.0.0\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#notificationsinitialized","title":"notifications/initialized","text":"<p>Sent by client after successful initialization.</p> <pre><code>{\n  \"method\": \"notifications/initialized\"\n}\n</code></pre>"},{"location":"reference/api/#tool-methods","title":"Tool Methods","text":""},{"location":"reference/api/#toolslist","title":"tools/list","text":"<p>List available tools.</p> <p>Request: <pre><code>{\n  \"method\": \"tools/list\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"tools\": [\n      {\n        \"name\": \"search\",\n        \"description\": \"Search for pages\",\n        \"inputSchema\": {\n          \"type\": \"object\",\n          \"properties\": {\n            \"query\": {\"type\": \"string\"}\n          },\n          \"required\": [\"query\"]\n        }\n      }\n    ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#toolscall","title":"tools/call","text":"<p>Execute a tool.</p> <p>Request: <pre><code>{\n  \"method\": \"tools/call\",\n  \"params\": {\n    \"name\": \"search\",\n    \"arguments\": {\n      \"query\": \"meeting notes\"\n    }\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"{\\\"results\\\": [...]}\"\n      }\n    ],\n    \"isError\": false\n  }\n}\n</code></pre></p> <p>Content Types:</p> Type Fields Description <code>text</code> <code>text</code> Plain text content <code>image</code> <code>data</code>, <code>mimeType</code> Base64-encoded image <code>resource</code> <code>resource</code> Embedded resource"},{"location":"reference/api/#resource-methods","title":"Resource Methods","text":""},{"location":"reference/api/#resourceslist","title":"resources/list","text":"<p>List available resources.</p> <p>Request: <pre><code>{\n  \"method\": \"resources/list\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"resources\": [\n      {\n        \"uri\": \"notion://workspace/info\",\n        \"name\": \"Workspace Info\",\n        \"mimeType\": \"application/json\"\n      }\n    ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#resourcesread","title":"resources/read","text":"<p>Read a resource.</p> <p>Request: <pre><code>{\n  \"method\": \"resources/read\",\n  \"params\": {\n    \"uri\": \"notion://workspace/info\"\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"contents\": [\n      {\n        \"uri\": \"notion://workspace/info\",\n        \"mimeType\": \"application/json\",\n        \"text\": \"{\\\"name\\\": \\\"My Workspace\\\"}\"\n      }\n    ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#resourcessubscribe","title":"resources/subscribe","text":"<p>Subscribe to resource changes.</p> <p>Request: <pre><code>{\n  \"method\": \"resources/subscribe\",\n  \"params\": {\n    \"uri\": \"notion://pages/abc123\"\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#prompt-methods","title":"Prompt Methods","text":""},{"location":"reference/api/#promptslist","title":"prompts/list","text":"<p>List available prompts.</p> <p>Request: <pre><code>{\n  \"method\": \"prompts/list\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"prompts\": [\n      {\n        \"name\": \"code_review\",\n        \"description\": \"Review code for issues\",\n        \"arguments\": [\n          {\n            \"name\": \"code\",\n            \"description\": \"Code to review\",\n            \"required\": true\n          }\n        ]\n      }\n    ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#promptsget","title":"prompts/get","text":"<p>Get a prompt with arguments.</p> <p>Request: <pre><code>{\n  \"method\": \"prompts/get\",\n  \"params\": {\n    \"name\": \"code_review\",\n    \"arguments\": {\n      \"code\": \"function add(a, b) { return a + b; }\"\n    }\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"result\": {\n    \"messages\": [\n      {\n        \"role\": \"user\",\n        \"content\": {\n          \"type\": \"text\",\n          \"text\": \"Please review this code...\"\n        }\n      }\n    ]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#notifications","title":"Notifications","text":""},{"location":"reference/api/#notificationstoolslist_changed","title":"notifications/tools/list_changed","text":"<p>Server notifies client when tools change.</p> <pre><code>{\n  \"method\": \"notifications/tools/list_changed\"\n}\n</code></pre>"},{"location":"reference/api/#notificationsresourceslist_changed","title":"notifications/resources/list_changed","text":"<p>Server notifies client when resources change.</p> <pre><code>{\n  \"method\": \"notifications/resources/list_changed\"\n}\n</code></pre>"},{"location":"reference/api/#notificationsresourcesupdated","title":"notifications/resources/updated","text":"<p>Server notifies client when a subscribed resource updates.</p> <pre><code>{\n  \"method\": \"notifications/resources/updated\",\n  \"params\": {\n    \"uri\": \"notion://pages/abc123\"\n  }\n}\n</code></pre>"},{"location":"reference/api/#rea-rest-api","title":"Rea REST API","text":""},{"location":"reference/api/#connections","title":"Connections","text":""},{"location":"reference/api/#list-connections","title":"List Connections","text":"<pre><code>GET /api/mcp/connections\n</code></pre> <p>Response: <pre><code>{\n  \"connections\": [\n    {\n      \"id\": 1,\n      \"name\": \"notion\",\n      \"server_type\": \"notion\",\n      \"enabled\": true,\n      \"last_connected_at\": \"2024-01-15T10:30:00Z\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"reference/api/#create-connection","title":"Create Connection","text":"<pre><code>POST /api/mcp/connections\n</code></pre> <p>Body: <pre><code>{\n  \"name\": \"notion\",\n  \"server_type\": \"notion\",\n  \"credentials\": {\n    \"token\": \"ntn_...\"\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#test-connection","title":"Test Connection","text":"<pre><code>POST /api/mcp/connections/{id}/test\n</code></pre> <p>Response: <pre><code>{\n  \"success\": true,\n  \"tools_count\": 12,\n  \"server_info\": {\n    \"name\": \"notion-mcp-server\",\n    \"version\": \"1.0.0\"\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#delete-connection","title":"Delete Connection","text":"<pre><code>DELETE /api/mcp/connections/{id}\n</code></pre>"},{"location":"reference/api/#tools","title":"Tools","text":""},{"location":"reference/api/#list-tools","title":"List Tools","text":"<pre><code>GET /api/mcp/tools\n</code></pre> <p>Response: <pre><code>{\n  \"tools\": [\n    {\n      \"fullName\": \"notion.search\",\n      \"name\": \"search\",\n      \"description\": \"Search for pages and databases\",\n      \"connection\": \"notion\",\n      \"inputSchema\": {...}\n    }\n  ]\n}\n</code></pre></p>"},{"location":"reference/api/#call-tool","title":"Call Tool","text":"<pre><code>POST /api/mcp/tools/call\n</code></pre> <p>Body: <pre><code>{\n  \"tool\": \"notion.search\",\n  \"arguments\": {\n    \"query\": \"meeting notes\"\n  }\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"success\": true,\n  \"result\": {\n    \"content\": [...]\n  }\n}\n</code></pre></p>"},{"location":"reference/api/#chat","title":"Chat","text":""},{"location":"reference/api/#send-message","title":"Send Message","text":"<pre><code>POST /api/agent/chat\n</code></pre> <p>Body: <pre><code>{\n  \"message\": \"Search my Notion for meeting notes\"\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"message\": \"I found 3 meeting notes in your Notion workspace...\",\n  \"tools_used\": [\"notion.search\"]\n}\n</code></pre></p>"},{"location":"reference/api/#error-codes","title":"Error Codes","text":""},{"location":"reference/api/#json-rpc-errors","title":"JSON-RPC Errors","text":"Code Message Description -32700 Parse error Invalid JSON -32600 Invalid Request Not a valid request object -32601 Method not found Unknown method -32602 Invalid params Invalid method parameters -32603 Internal error Internal server error"},{"location":"reference/api/#mcp-errors","title":"MCP Errors","text":"Code Message Description -32001 Connection failed Failed to connect to server -32002 Timeout Request timed out -32003 Tool not found Unknown tool name -32004 Resource not found Unknown resource URI -32005 Unauthorized Missing or invalid credentials"},{"location":"reference/api/#http-status-codes","title":"HTTP Status Codes","text":"Code Description 200 Success 201 Created 400 Bad Request 401 Unauthorized 403 Forbidden 404 Not Found 429 Rate Limited 500 Server Error"},{"location":"reference/api/#php-sdk-classes","title":"PHP SDK Classes","text":""},{"location":"reference/api/#mcpclientinterface","title":"MCPClientInterface","text":"<pre><code>interface MCPClientInterface\n{\n    public function connect(): void;\n    public function isConnected(): bool;\n    public function getServerInfo(): array;\n    public function getCapabilities(): array;\n    public function listTools(): array;\n    public function callTool(string $name, array $arguments = []): array;\n    public function listResources(): array;\n    public function readResource(string $uri): array;\n    public function listPrompts(): array;\n    public function getPrompt(string $name, array $arguments = []): array;\n    public function disconnect(): void;\n}\n</code></pre>"},{"location":"reference/api/#mcpmanagerservice","title":"MCPManagerService","text":"<pre><code>class MCPManagerService\n{\n    public function getClient(User $user, string $connectionName): MCPClientInterface;\n    public function getAllTools(User $user): array;\n    public function callTool(User $user, string $fullName, array $arguments): array;\n    public function disconnectUser(User $user): void;\n    public function disconnectAll(): void;\n}\n</code></pre>"},{"location":"reference/api/#tool-attributes","title":"Tool Attributes","text":"<pre><code>#[McpTool(\n    name: 'tool_name',\n    description: 'Tool description'\n)]\npublic function toolMethod(string $arg1, ?int $arg2 = null): array;\n</code></pre>"},{"location":"reference/api/#resource-attributes","title":"Resource Attributes","text":"<pre><code>#[McpResource(\n    uri: 'resource://path',\n    name: 'Resource Name',\n    mimeType: 'application/json',\n    isTemplate: false\n)]\npublic function resourceMethod(): array;\n</code></pre>"},{"location":"reference/api/#prompt-attributes","title":"Prompt Attributes","text":"<pre><code>#[McpPrompt(\n    name: 'prompt_name',\n    description: 'Prompt description'\n)]\npublic function promptMethod(string $arg): array;\n</code></pre>"},{"location":"reference/api/#next-steps","title":"Next Steps","text":"<ul> <li>Configuration Reference</li> <li>Security Reference</li> <li>Notion Tutorial</li> </ul>"},{"location":"reference/configuration/","title":"Configuration Reference","text":"<p>Complete configuration options for MCP integration in Rea.</p>"},{"location":"reference/configuration/#configuration-file","title":"Configuration File","text":"config/mcp.php<pre><code>&lt;?php\n\nreturn [\n    /*\n    |--------------------------------------------------------------------------\n    | MCP Servers\n    |--------------------------------------------------------------------------\n    |\n    | Configure your MCP server connections. Each server can use either\n    | 'stdio' transport (local process) or 'http' transport (remote).\n    |\n    */\n    'servers' =&gt; [\n        'notion' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n            'env' =&gt; [\n                'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n            ],\n            'timeout' =&gt; 30,\n        ],\n\n        'slack' =&gt; [\n            'transport' =&gt; 'stdio',\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@modelcontextprotocol/server-slack'],\n            'env' =&gt; [\n                'SLACK_BOT_TOKEN' =&gt; env('SLACK_BOT_TOKEN'),\n                'SLACK_TEAM_ID' =&gt; env('SLACK_TEAM_ID'),\n            ],\n        ],\n\n        'custom' =&gt; [\n            'transport' =&gt; 'http',\n            'url' =&gt; env('CUSTOM_MCP_URL'),\n            'headers' =&gt; [\n                'Authorization' =&gt; 'Bearer ' . env('CUSTOM_MCP_TOKEN'),\n            ],\n            'timeout' =&gt; 60,\n        ],\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Cache Settings\n    |--------------------------------------------------------------------------\n    |\n    | Configure caching for tool discovery and resource metadata.\n    |\n    */\n    'cache' =&gt; [\n        'enabled' =&gt; env('MCP_CACHE_ENABLED', true),\n        'ttl' =&gt; env('MCP_CACHE_TTL', 300),\n        'prefix' =&gt; 'mcp_',\n        'store' =&gt; env('MCP_CACHE_STORE', 'redis'),\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Security Settings\n    |--------------------------------------------------------------------------\n    */\n    'security' =&gt; [\n        // Tools requiring human approval\n        'require_approval' =&gt; [\n            'delete',\n            'archive',\n            'send_message',\n            'create_user',\n        ],\n\n        // Enable audit logging\n        'audit_logging' =&gt; env('MCP_AUDIT_LOGGING', true),\n\n        // Tool blacklist (never allow these)\n        'tool_blacklist' =&gt; [\n            // 'dangerous_tool',\n        ],\n\n        // Maximum arguments size (bytes)\n        'max_argument_size' =&gt; 1024 * 1024, // 1MB\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Connection Settings\n    |--------------------------------------------------------------------------\n    */\n    'connection' =&gt; [\n        // Default timeout for operations (seconds)\n        'timeout' =&gt; env('MCP_TIMEOUT', 30),\n\n        // Reconnect on failure\n        'reconnect' =&gt; env('MCP_RECONNECT', true),\n\n        // Delay between reconnection attempts (seconds)\n        'reconnect_delay' =&gt; env('MCP_RECONNECT_DELAY', 5),\n\n        // Maximum reconnection attempts\n        'max_reconnect_attempts' =&gt; env('MCP_MAX_RECONNECT', 3),\n\n        // Health check interval (seconds, 0 to disable)\n        'health_check_interval' =&gt; env('MCP_HEALTH_CHECK_INTERVAL', 60),\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Rate Limiting\n    |--------------------------------------------------------------------------\n    */\n    'rate_limits' =&gt; [\n        // Global rate limit per user (requests per minute)\n        'per_user' =&gt; env('MCP_RATE_LIMIT_USER', 60),\n\n        // Per-tool rate limit (requests per minute)\n        'per_tool' =&gt; env('MCP_RATE_LIMIT_TOOL', 30),\n\n        // Expensive tools (lower rate limit)\n        'expensive_tools' =&gt; [\n            'search' =&gt; 10,\n            'query_database' =&gt; 10,\n        ],\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Logging\n    |--------------------------------------------------------------------------\n    */\n    'logging' =&gt; [\n        'channel' =&gt; env('MCP_LOG_CHANNEL', 'mcp'),\n        'level' =&gt; env('MCP_LOG_LEVEL', 'info'),\n\n        // Log tool arguments (may contain sensitive data)\n        'log_arguments' =&gt; env('MCP_LOG_ARGUMENTS', false),\n\n        // Log tool results\n        'log_results' =&gt; env('MCP_LOG_RESULTS', false),\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Feature Flags\n    |--------------------------------------------------------------------------\n    */\n    'features' =&gt; [\n        // Enable resources support\n        'resources' =&gt; env('MCP_FEATURE_RESOURCES', true),\n\n        // Enable prompts support\n        'prompts' =&gt; env('MCP_FEATURE_PROMPTS', true),\n\n        // Enable sampling (server can request AI completions)\n        'sampling' =&gt; env('MCP_FEATURE_SAMPLING', false),\n\n        // Enable elicitation (server can request user input)\n        'elicitation' =&gt; env('MCP_FEATURE_ELICITATION', false),\n    ],\n];\n</code></pre>"},{"location":"reference/configuration/#environment-variables","title":"Environment Variables","text":".env<pre><code># Server Credentials\nNOTION_TOKEN=ntn_your_token_here\nSLACK_BOT_TOKEN=xoxb-your-token\nSLACK_TEAM_ID=T00000000\nCUSTOM_MCP_URL=https://mcp.example.com\nCUSTOM_MCP_TOKEN=your-secret-token\n\n# Cache Settings\nMCP_CACHE_ENABLED=true\nMCP_CACHE_TTL=300\nMCP_CACHE_STORE=redis\n\n# Connection Settings\nMCP_TIMEOUT=30\nMCP_RECONNECT=true\nMCP_RECONNECT_DELAY=5\nMCP_MAX_RECONNECT=3\nMCP_HEALTH_CHECK_INTERVAL=60\n\n# Rate Limiting\nMCP_RATE_LIMIT_USER=60\nMCP_RATE_LIMIT_TOOL=30\n\n# Logging\nMCP_LOG_CHANNEL=mcp\nMCP_LOG_LEVEL=info\nMCP_LOG_ARGUMENTS=false\nMCP_LOG_RESULTS=false\nMCP_AUDIT_LOGGING=true\n\n# Feature Flags\nMCP_FEATURE_RESOURCES=true\nMCP_FEATURE_PROMPTS=true\nMCP_FEATURE_SAMPLING=false\nMCP_FEATURE_ELICITATION=false\n</code></pre>"},{"location":"reference/configuration/#server-configuration","title":"Server Configuration","text":""},{"location":"reference/configuration/#stdio-transport","title":"stdio Transport","text":"<pre><code>'notion' =&gt; [\n    'transport' =&gt; 'stdio',\n\n    // Command to execute\n    'command' =&gt; 'npx',\n\n    // Command arguments\n    'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n\n    // Environment variables\n    'env' =&gt; [\n        'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n    ],\n\n    // Working directory (optional)\n    'cwd' =&gt; base_path(),\n\n    // Connection timeout (seconds)\n    'timeout' =&gt; 30,\n\n    // Process start timeout (seconds)\n    'start_timeout' =&gt; 10,\n],\n</code></pre>"},{"location":"reference/configuration/#http-transport","title":"HTTP Transport","text":"<pre><code>'remote' =&gt; [\n    'transport' =&gt; 'http',\n\n    // Server URL\n    'url' =&gt; 'https://mcp.example.com',\n\n    // Request headers\n    'headers' =&gt; [\n        'Authorization' =&gt; 'Bearer ' . env('MCP_TOKEN'),\n        'X-Client-Id' =&gt; env('MCP_CLIENT_ID'),\n    ],\n\n    // Request timeout (seconds)\n    'timeout' =&gt; 60,\n\n    // Verify SSL certificates\n    'verify_ssl' =&gt; true,\n\n    // Retry configuration\n    'retry' =&gt; [\n        'times' =&gt; 3,\n        'sleep' =&gt; 1000, // milliseconds\n        'when' =&gt; function ($exception) {\n            return $exception-&gt;getCode() &gt;= 500;\n        },\n    ],\n],\n</code></pre>"},{"location":"reference/configuration/#logging-configuration","title":"Logging Configuration","text":"config/logging.php<pre><code>'channels' =&gt; [\n    'mcp' =&gt; [\n        'driver' =&gt; 'daily',\n        'path' =&gt; storage_path('logs/mcp.log'),\n        'level' =&gt; env('MCP_LOG_LEVEL', 'info'),\n        'days' =&gt; 14,\n    ],\n\n    'mcp_audit' =&gt; [\n        'driver' =&gt; 'daily',\n        'path' =&gt; storage_path('logs/mcp-audit.log'),\n        'level' =&gt; 'info',\n        'days' =&gt; 90,\n    ],\n],\n</code></pre>"},{"location":"reference/configuration/#rate-limiting-configuration","title":"Rate Limiting Configuration","text":"app/Providers/RouteServiceProvider.php<pre><code>use Illuminate\\Cache\\RateLimiting\\Limit;\nuse Illuminate\\Support\\Facades\\RateLimiter;\n\npublic function boot(): void\n{\n    $this-&gt;configureRateLimiting();\n}\n\nprotected function configureRateLimiting(): void\n{\n    RateLimiter::for('mcp', function (Request $request) {\n        $user = $request-&gt;user();\n        $tool = $request-&gt;input('tool');\n\n        $limits = [\n            Limit::perMinute(config('mcp.rate_limits.per_user'))\n                -&gt;by($user?-&gt;id ?: $request-&gt;ip()),\n        ];\n\n        // Add per-tool limit\n        if ($tool) {\n            $toolLimit = config(\"mcp.rate_limits.expensive_tools.{$tool}\")\n                ?? config('mcp.rate_limits.per_tool');\n\n            $limits[] = Limit::perMinute($toolLimit)\n                -&gt;by(\"{$user?-&gt;id}:{$tool}\");\n        }\n\n        return $limits;\n    });\n}\n</code></pre>"},{"location":"reference/configuration/#queue-configuration","title":"Queue Configuration","text":"<p>For async tool execution:</p> config/queue.php<pre><code>'connections' =&gt; [\n    'mcp' =&gt; [\n        'driver' =&gt; 'redis',\n        'connection' =&gt; 'mcp',\n        'queue' =&gt; 'mcp',\n        'retry_after' =&gt; 90,\n        'block_for' =&gt; null,\n    ],\n],\n</code></pre> config/database.php<pre><code>'redis' =&gt; [\n    'mcp' =&gt; [\n        'url' =&gt; env('MCP_REDIS_URL'),\n        'host' =&gt; env('MCP_REDIS_HOST', '127.0.0.1'),\n        'password' =&gt; env('MCP_REDIS_PASSWORD'),\n        'port' =&gt; env('MCP_REDIS_PORT', '6379'),\n        'database' =&gt; env('MCP_REDIS_DB', '2'),\n    ],\n],\n</code></pre>"},{"location":"reference/configuration/#health-check-configuration","title":"Health Check Configuration","text":"config/health.php<pre><code>return [\n    'checks' =&gt; [\n        \\App\\Health\\MCPConnectionCheck::class =&gt; [\n            'connections' =&gt; ['notion', 'slack'],\n            'timeout' =&gt; 5,\n        ],\n    ],\n];\n</code></pre> app/Health/MCPConnectionCheck.php<pre><code>&lt;?php\n\nnamespace App\\Health;\n\nuse App\\Services\\MCP\\MCPManagerService;\nuse Spatie\\Health\\Checks\\Check;\nuse Spatie\\Health\\Checks\\Result;\n\nclass MCPConnectionCheck extends Check\n{\n    public function __construct(\n        private MCPManagerService $mcp,\n        private array $connections = [],\n        private int $timeout = 5\n    ) {}\n\n    public function run(): Result\n    {\n        $result = Result::make();\n        $failures = [];\n\n        foreach ($this-&gt;connections as $name) {\n            try {\n                $client = $this-&gt;mcp-&gt;getClientByName($name);\n                $client-&gt;listTools();\n            } catch (\\Exception $e) {\n                $failures[] = \"{$name}: {$e-&gt;getMessage()}\";\n            }\n        }\n\n        if (empty($failures)) {\n            return $result-&gt;ok('All MCP connections healthy');\n        }\n\n        return $result-&gt;failed(implode(', ', $failures));\n    }\n}\n</code></pre>"},{"location":"reference/configuration/#publishing-configuration","title":"Publishing Configuration","text":"<p>Publish the configuration file:</p> <pre><code>php artisan vendor:publish --tag=mcp-config\n</code></pre>"},{"location":"reference/configuration/#validation","title":"Validation","text":"<p>Validate configuration on boot:</p> app/Providers/MCPServiceProvider.php<pre><code>public function boot(): void\n{\n    $this-&gt;validateConfiguration();\n}\n\nprivate function validateConfiguration(): void\n{\n    $servers = config('mcp.servers', []);\n\n    foreach ($servers as $name =&gt; $config) {\n        if (!isset($config['transport'])) {\n            throw new \\InvalidArgumentException(\n                \"MCP server '{$name}' missing transport\"\n            );\n        }\n\n        if ($config['transport'] === 'stdio') {\n            if (!isset($config['command'])) {\n                throw new \\InvalidArgumentException(\n                    \"MCP server '{$name}' missing command\"\n                );\n            }\n        }\n\n        if ($config['transport'] === 'http') {\n            if (!isset($config['url'])) {\n                throw new \\InvalidArgumentException(\n                    \"MCP server '{$name}' missing url\"\n                );\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"reference/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Security Reference</li> <li>API Reference</li> <li>Rea Integration</li> </ul>"},{"location":"reference/security/","title":"Security Reference","text":"<p>Security best practices for MCP integration in Rea.</p> <p></p>"},{"location":"reference/security/#overview","title":"Overview","text":"<p>MCP security operates at multiple layers:</p> Layer Concerns Transport Encryption, authentication Protocol Message validation, capability negotiation Application Authorization, audit logging Data Credential storage, input sanitization"},{"location":"reference/security/#transport-security","title":"Transport Security","text":""},{"location":"reference/security/#stdio-transport","title":"stdio Transport","text":"<p>For local servers running via stdio:</p> <ul> <li>Process isolation: Server runs with same privileges as client</li> <li>No network exposure: Communication via pipes only</li> <li>Trust boundary: Trust is implicit (same machine)</li> </ul> <p>Best Practices:</p> <pre><code>// Never echo to stdout in stdio servers (breaks protocol)\nini_set('display_errors', '0');\nini_set('log_errors', '1');\nini_set('error_log', 'php://stderr');\n</code></pre>"},{"location":"reference/security/#http-transport","title":"HTTP Transport","text":"<p>For remote servers:</p> <p>Required:</p> <ul> <li>HTTPS in production (TLS 1.2+)</li> <li>Authentication tokens</li> <li>Origin validation</li> </ul> <pre><code>// Validate Origin header to prevent DNS rebinding\n$origin = $request-&gt;getHeader('Origin')[0] ?? '';\n$allowed = config('mcp.allowed_origins', []);\n\nif (!empty($origin) &amp;&amp; !in_array($origin, $allowed)) {\n    return response()-&gt;json(['error' =&gt; 'Forbidden'], 403);\n}\n</code></pre> <p>Bind to localhost for local HTTP servers:</p> <pre><code>$transport = new StreamableHttpTransport(\n    host: '127.0.0.1', // Not 0.0.0.0\n    port: 8080\n);\n</code></pre>"},{"location":"reference/security/#authentication","title":"Authentication","text":""},{"location":"reference/security/#token-management","title":"Token Management","text":"<p>Storage:</p> <pre><code>// Use Laravel's encryption for API tokens\nprotected $casts = [\n    'credentials' =&gt; AsEncryptedCollection::class,\n];\n</code></pre> <p>Rotation:</p> <pre><code>// Implement token rotation\nclass TokenRotationService\n{\n    public function rotateToken(MCPConnection $connection): void\n    {\n        $newToken = $this-&gt;generateToken();\n\n        $connection-&gt;update([\n            'credentials' =&gt; array_merge(\n                $connection-&gt;credentials-&gt;toArray(),\n                ['token' =&gt; $newToken]\n            ),\n        ]);\n\n        // Invalidate old sessions\n        Cache::forget(\"mcp_session_{$connection-&gt;id}\");\n    }\n}\n</code></pre>"},{"location":"reference/security/#oauth-21-for-http-servers","title":"OAuth 2.1 for HTTP Servers","text":"<pre><code>// OAuth authorization code flow with PKCE\nclass MCPOAuthController extends Controller\n{\n    public function authorize(Request $request)\n    {\n        $validated = $request-&gt;validate([\n            'client_id' =&gt; 'required|string',\n            'redirect_uri' =&gt; 'required|url',\n            'code_challenge' =&gt; 'required|string',\n            'code_challenge_method' =&gt; 'required|in:S256',\n            'state' =&gt; 'required|string',\n        ]);\n\n        // Verify client and redirect URI\n        $client = OAuthClient::where('client_id', $validated['client_id'])\n            -&gt;where('redirect_uri', $validated['redirect_uri'])\n            -&gt;firstOrFail();\n\n        // Generate authorization code\n        $code = AuthorizationCode::create([\n            'client_id' =&gt; $client-&gt;id,\n            'user_id' =&gt; auth()-&gt;id(),\n            'code' =&gt; Str::random(64),\n            'code_challenge' =&gt; $validated['code_challenge'],\n            'expires_at' =&gt; now()-&gt;addMinutes(10),\n        ]);\n\n        return redirect($validated['redirect_uri'] . '?' . http_build_query([\n            'code' =&gt; $code-&gt;code,\n            'state' =&gt; $validated['state'],\n        ]));\n    }\n\n    public function token(Request $request)\n    {\n        $validated = $request-&gt;validate([\n            'grant_type' =&gt; 'required|in:authorization_code',\n            'code' =&gt; 'required|string',\n            'client_id' =&gt; 'required|string',\n            'code_verifier' =&gt; 'required|string',\n        ]);\n\n        $authCode = AuthorizationCode::where('code', $validated['code'])\n            -&gt;where('expires_at', '&gt;', now())\n            -&gt;firstOrFail();\n\n        // Verify PKCE\n        $challenge = base64_encode(hash('sha256', $validated['code_verifier'], true));\n        if (!hash_equals($authCode-&gt;code_challenge, $challenge)) {\n            abort(400, 'Invalid code verifier');\n        }\n\n        // Generate access token\n        $accessToken = AccessToken::create([\n            'user_id' =&gt; $authCode-&gt;user_id,\n            'client_id' =&gt; $authCode-&gt;client_id,\n            'token' =&gt; Str::random(64),\n            'expires_at' =&gt; now()-&gt;addHour(),\n        ]);\n\n        $authCode-&gt;delete();\n\n        return response()-&gt;json([\n            'access_token' =&gt; $accessToken-&gt;token,\n            'token_type' =&gt; 'Bearer',\n            'expires_in' =&gt; 3600,\n        ]);\n    }\n}\n</code></pre>"},{"location":"reference/security/#authorization","title":"Authorization","text":""},{"location":"reference/security/#permission-model","title":"Permission Model","text":"<p>Define granular permissions for MCP operations:</p> <pre><code>// Permission constants\nclass MCPPermission\n{\n    const READ_TOOLS = 'mcp.tools.read';\n    const EXECUTE_TOOLS = 'mcp.tools.execute';\n    const READ_RESOURCES = 'mcp.resources.read';\n    const MANAGE_CONNECTIONS = 'mcp.connections.manage';\n}\n\n// Policy\nclass MCPConnectionPolicy\n{\n    public function view(User $user, MCPConnection $connection): bool\n    {\n        return $user-&gt;id === $connection-&gt;user_id;\n    }\n\n    public function executeTool(User $user, MCPConnection $connection, string $tool): bool\n    {\n        // Check user has execute permission\n        if (!$user-&gt;can(MCPPermission::EXECUTE_TOOLS)) {\n            return false;\n        }\n\n        // Check connection belongs to user\n        if ($user-&gt;id !== $connection-&gt;user_id) {\n            return false;\n        }\n\n        // Check tool is not blacklisted\n        $blacklist = config('mcp.tool_blacklist', []);\n        if (in_array($tool, $blacklist)) {\n            return false;\n        }\n\n        return true;\n    }\n}\n</code></pre>"},{"location":"reference/security/#human-in-the-loop","title":"Human-in-the-Loop","text":"<p>Require explicit approval for sensitive operations:</p> <pre><code>class ToolApprovalService\n{\n    private array $requiresApproval = [\n        'delete',\n        'archive',\n        'update',\n        'create',\n        'send_message',\n    ];\n\n    public function needsApproval(string $toolName): bool\n    {\n        foreach ($this-&gt;requiresApproval as $keyword) {\n            if (str_contains(strtolower($toolName), $keyword)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    public function requestApproval(User $user, string $tool, array $args): ToolApproval\n    {\n        return ToolApproval::create([\n            'user_id' =&gt; $user-&gt;id,\n            'tool' =&gt; $tool,\n            'arguments' =&gt; $args,\n            'status' =&gt; 'pending',\n            'expires_at' =&gt; now()-&gt;addMinutes(5),\n        ]);\n    }\n\n    public function approve(ToolApproval $approval, User $user): void\n    {\n        if ($approval-&gt;user_id !== $user-&gt;id) {\n            throw new UnauthorizedException();\n        }\n\n        if ($approval-&gt;expires_at &lt; now()) {\n            throw new ExpiredException();\n        }\n\n        $approval-&gt;update([\n            'status' =&gt; 'approved',\n            'approved_at' =&gt; now(),\n        ]);\n    }\n}\n</code></pre>"},{"location":"reference/security/#input-validation","title":"Input Validation","text":""},{"location":"reference/security/#json-schema-validation","title":"JSON Schema Validation","text":"<pre><code>use Opis\\JsonSchema\\Validator;\nuse Opis\\JsonSchema\\Errors\\ErrorFormatter;\n\nclass ToolInputValidator\n{\n    public function validate(array $tool, array $arguments): void\n    {\n        $schema = $tool['inputSchema'];\n\n        $validator = new Validator();\n        $result = $validator-&gt;validate(\n            json_decode(json_encode($arguments)),\n            json_encode($schema)\n        );\n\n        if (!$result-&gt;isValid()) {\n            $formatter = new ErrorFormatter();\n            $errors = $formatter-&gt;format($result-&gt;error());\n\n            throw new ValidationException(\n                'Invalid tool arguments: ' . json_encode($errors)\n            );\n        }\n    }\n}\n</code></pre>"},{"location":"reference/security/#input-sanitization","title":"Input Sanitization","text":"<pre><code>class InputSanitizer\n{\n    public function sanitize(array $arguments, array $schema): array\n    {\n        $sanitized = [];\n\n        foreach ($arguments as $key =&gt; $value) {\n            $propSchema = $schema['properties'][$key] ?? null;\n\n            if ($propSchema === null) {\n                continue; // Skip unknown properties\n            }\n\n            $sanitized[$key] = $this-&gt;sanitizeValue($value, $propSchema);\n        }\n\n        return $sanitized;\n    }\n\n    private function sanitizeValue(mixed $value, array $schema): mixed\n    {\n        return match ($schema['type'] ?? 'string') {\n            'string' =&gt; $this-&gt;sanitizeString($value),\n            'integer' =&gt; (int) $value,\n            'number' =&gt; (float) $value,\n            'boolean' =&gt; (bool) $value,\n            'array' =&gt; array_map(\n                fn($v) =&gt; $this-&gt;sanitizeValue($v, $schema['items'] ?? []),\n                (array) $value\n            ),\n            'object' =&gt; $this-&gt;sanitize((array) $value, $schema),\n            default =&gt; $value,\n        };\n    }\n\n    private function sanitizeString(string $value): string\n    {\n        // Remove null bytes\n        $value = str_replace(\"\\0\", '', $value);\n\n        // Limit length\n        if (strlen($value) &gt; 10000) {\n            $value = substr($value, 0, 10000);\n        }\n\n        return $value;\n    }\n}\n</code></pre>"},{"location":"reference/security/#sql-injection-prevention","title":"SQL Injection Prevention","text":"<pre><code>#[McpTool(name: 'query_database')]\npublic function queryDatabase(string $table, array $filters): array\n{\n    // Whitelist allowed tables\n    $allowedTables = ['users', 'posts', 'comments'];\n    if (!in_array($table, $allowedTables)) {\n        throw new InvalidArgumentException(\"Invalid table: {$table}\");\n    }\n\n    // Use parameterized queries\n    $query = DB::table($table);\n\n    foreach ($filters as $column =&gt; $value) {\n        // Validate column names\n        if (!preg_match('/^[a-z_]+$/', $column)) {\n            throw new InvalidArgumentException(\"Invalid column: {$column}\");\n        }\n\n        $query-&gt;where($column, '=', $value);\n    }\n\n    return $query-&gt;limit(100)-&gt;get()-&gt;toArray();\n}\n</code></pre>"},{"location":"reference/security/#audit-logging","title":"Audit Logging","text":""},{"location":"reference/security/#structured-logging","title":"Structured Logging","text":"<pre><code>class MCPAuditLogger\n{\n    public function logToolCall(\n        User $user,\n        string $tool,\n        array $arguments,\n        mixed $result,\n        float $duration\n    ): void {\n        Log::channel('mcp_audit')-&gt;info('Tool execution', [\n            'event' =&gt; 'tool_call',\n            'user_id' =&gt; $user-&gt;id,\n            'user_email' =&gt; $user-&gt;email,\n            'tool' =&gt; $tool,\n            'arguments' =&gt; $this-&gt;redactSensitive($arguments),\n            'result_type' =&gt; gettype($result),\n            'is_error' =&gt; $result['isError'] ?? false,\n            'duration_ms' =&gt; round($duration * 1000),\n            'ip_address' =&gt; request()-&gt;ip(),\n            'user_agent' =&gt; request()-&gt;userAgent(),\n            'timestamp' =&gt; now()-&gt;toIso8601String(),\n        ]);\n    }\n\n    public function logConnectionEvent(\n        User $user,\n        MCPConnection $connection,\n        string $event\n    ): void {\n        Log::channel('mcp_audit')-&gt;info('Connection event', [\n            'event' =&gt; $event,\n            'user_id' =&gt; $user-&gt;id,\n            'connection_id' =&gt; $connection-&gt;id,\n            'connection_name' =&gt; $connection-&gt;name,\n            'server_type' =&gt; $connection-&gt;server_type,\n            'timestamp' =&gt; now()-&gt;toIso8601String(),\n        ]);\n    }\n\n    private function redactSensitive(array $data): array\n    {\n        $sensitive = ['password', 'token', 'secret', 'key', 'credential'];\n\n        return collect($data)-&gt;map(function ($value, $key) use ($sensitive) {\n            foreach ($sensitive as $pattern) {\n                if (str_contains(strtolower($key), $pattern)) {\n                    return '[REDACTED]';\n                }\n            }\n            return $value;\n        })-&gt;toArray();\n    }\n}\n</code></pre>"},{"location":"reference/security/#log-retention","title":"Log Retention","text":"<pre><code>// config/logging.php\n'channels' =&gt; [\n    'mcp_audit' =&gt; [\n        'driver' =&gt; 'daily',\n        'path' =&gt; storage_path('logs/mcp-audit.log'),\n        'level' =&gt; 'info',\n        'days' =&gt; 90, // Retain for 90 days\n    ],\n],\n</code></pre>"},{"location":"reference/security/#rate-limiting","title":"Rate Limiting","text":"<pre><code>// App\\Providers\\RouteServiceProvider\n\nRateLimiter::for('mcp_tools', function (Request $request) {\n    return [\n        // Per-user limit\n        Limit::perMinute(60)-&gt;by($request-&gt;user()?-&gt;id),\n\n        // Per-tool limit (prevent abuse of expensive tools)\n        Limit::perMinute(10)-&gt;by(\n            $request-&gt;user()?-&gt;id . ':' . $request-&gt;input('tool')\n        ),\n    ];\n});\n\n// Middleware\nRoute::middleware(['auth:sanctum', 'throttle:mcp_tools'])\n    -&gt;post('/mcp/tools/call', [MCPToolController::class, 'call']);\n</code></pre>"},{"location":"reference/security/#security-checklist","title":"Security Checklist","text":""},{"location":"reference/security/#before-production","title":"Before Production","text":"<ul> <li>[ ] HTTPS enabled for all HTTP transport servers</li> <li>[ ] API tokens stored encrypted in database</li> <li>[ ] Input validation on all tool arguments</li> <li>[ ] Rate limiting configured</li> <li>[ ] Audit logging enabled</li> <li>[ ] Sensitive operations require approval</li> <li>[ ] Origin validation for HTTP servers</li> <li>[ ] Error messages don't leak sensitive info</li> <li>[ ] Dependencies up to date</li> </ul>"},{"location":"reference/security/#ongoing","title":"Ongoing","text":"<ul> <li>[ ] Regular security audits</li> <li>[ ] Monitor audit logs for anomalies</li> <li>[ ] Rotate API tokens periodically</li> <li>[ ] Review tool permissions</li> <li>[ ] Update MCP SDK versions</li> <li>[ ] Test disaster recovery</li> </ul>"},{"location":"reference/security/#common-vulnerabilities","title":"Common Vulnerabilities","text":""},{"location":"reference/security/#1-command-injection","title":"1. Command Injection","text":"<p>Vulnerable: <pre><code>#[McpTool(name: 'run_command')]\npublic function runCommand(string $command): string\n{\n    return shell_exec($command); // DANGEROUS!\n}\n</code></pre></p> <p>Safe: <pre><code>#[McpTool(name: 'list_files')]\npublic function listFiles(string $directory): array\n{\n    // Validate path\n    $realPath = realpath($directory);\n    $allowedBase = realpath('/var/data');\n\n    if (!$realPath || !str_starts_with($realPath, $allowedBase)) {\n        throw new InvalidArgumentException('Invalid directory');\n    }\n\n    return scandir($realPath);\n}\n</code></pre></p>"},{"location":"reference/security/#2-path-traversal","title":"2. Path Traversal","text":"<p>Vulnerable: <pre><code>public function readFile(string $filename): string\n{\n    return file_get_contents(\"/data/{$filename}\"); // DANGEROUS!\n}\n</code></pre></p> <p>Safe: <pre><code>public function readFile(string $filename): string\n{\n    // Remove path components\n    $filename = basename($filename);\n\n    // Validate extension\n    $allowed = ['txt', 'json', 'md'];\n    $ext = pathinfo($filename, PATHINFO_EXTENSION);\n\n    if (!in_array($ext, $allowed)) {\n        throw new InvalidArgumentException('Invalid file type');\n    }\n\n    $path = \"/data/{$filename}\";\n\n    if (!file_exists($path)) {\n        throw new NotFoundException('File not found');\n    }\n\n    return file_get_contents($path);\n}\n</code></pre></p>"},{"location":"reference/security/#3-credential-exposure","title":"3. Credential Exposure","text":"<p>Vulnerable: <pre><code>public function handleError(\\Exception $e): array\n{\n    return ['error' =&gt; $e-&gt;getMessage()]; // May leak credentials\n}\n</code></pre></p> <p>Safe: <pre><code>public function handleError(\\Exception $e): array\n{\n    Log::error('MCP error', ['exception' =&gt; $e]);\n\n    return [\n        'error' =&gt; 'An error occurred',\n        'code' =&gt; $e-&gt;getCode(),\n    ];\n}\n</code></pre></p>"},{"location":"reference/security/#next-steps","title":"Next Steps","text":"<ul> <li>API Reference - Complete API documentation</li> <li>Configuration - Configuration options</li> <li>Rea Integration - Implementation guide</li> </ul>"},{"location":"tutorials/custom-connectors/","title":"Building Custom MCP Connectors","text":"<p>Learn how to build custom MCP servers to expose your own tools, resources, and prompts.</p>"},{"location":"tutorials/custom-connectors/#overview","title":"Overview","text":"<p>Custom MCP connectors allow you to:</p> <ul> <li>Expose internal APIs to Rea agents</li> <li>Create domain-specific tools</li> <li>Integrate proprietary systems</li> <li>Build reusable integration packages</li> </ul>"},{"location":"tutorials/custom-connectors/#when-to-build-custom","title":"When to Build Custom","text":"Use Case Recommendation Standard service (Notion, Slack) Use existing server Internal API Build custom server Proprietary system Build custom server Custom business logic Build custom server Modified existing server Fork and customize"},{"location":"tutorials/custom-connectors/#quick-start","title":"Quick Start","text":""},{"location":"tutorials/custom-connectors/#1-create-project","title":"1. Create Project","text":"<pre><code>mkdir my-mcp-server\ncd my-mcp-server\ncomposer init\ncomposer require mcp/sdk\n</code></pre>"},{"location":"tutorials/custom-connectors/#2-create-server","title":"2. Create Server","text":"server.php<pre><code>&lt;?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\n\n$server = Server::builder()\n    -&gt;setServerInfo('My Custom Server', '1.0.0')\n    -&gt;setInstructions('Custom server for internal APIs')\n    -&gt;setDiscovery(__DIR__ . '/src', ['.'])\n    -&gt;build();\n\n$transport = new StdioTransport();\n$server-&gt;run($transport);\n</code></pre>"},{"location":"tutorials/custom-connectors/#3-create-a-tool","title":"3. Create a Tool","text":"src/Tools/HelloTools.php<pre><code>&lt;?php\n\nnamespace MyServer\\Tools;\n\nuse Mcp\\Capability\\Attribute\\McpTool;\n\nclass HelloTools\n{\n    #[McpTool(\n        name: 'greet',\n        description: 'Greet someone by name'\n    )]\n    public function greet(string $name): string\n    {\n        return \"Hello, {$name}!\";\n    }\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#4-test","title":"4. Test","text":"<pre><code># Run with MCP Inspector\nnpx @modelcontextprotocol/inspector php server.php\n</code></pre>"},{"location":"tutorials/custom-connectors/#building-a-database-connector","title":"Building a Database Connector","text":"<p>Let's build a complete MCP server for querying a customer database.</p>"},{"location":"tutorials/custom-connectors/#project-structure","title":"Project Structure","text":"<pre><code>customer-mcp-server/\n\u251c\u2500\u2500 composer.json\n\u251c\u2500\u2500 server.php\n\u251c\u2500\u2500 config.php\n\u2514\u2500\u2500 src/\n    \u251c\u2500\u2500 Tools/\n    \u2502   \u2514\u2500\u2500 CustomerTools.php\n    \u251c\u2500\u2500 Resources/\n    \u2502   \u2514\u2500\u2500 CustomerResources.php\n    \u2514\u2500\u2500 Prompts/\n        \u2514\u2500\u2500 CustomerPrompts.php\n</code></pre>"},{"location":"tutorials/custom-connectors/#configuration","title":"Configuration","text":"config.php<pre><code>&lt;?php\n\nreturn [\n    'database' =&gt; [\n        'dsn' =&gt; getenv('DB_DSN') ?: 'mysql:host=localhost;dbname=customers',\n        'user' =&gt; getenv('DB_USER') ?: 'root',\n        'password' =&gt; getenv('DB_PASSWORD') ?: '',\n    ],\n    'api' =&gt; [\n        'base_url' =&gt; getenv('API_URL') ?: 'https://api.example.com',\n        'key' =&gt; getenv('API_KEY'),\n    ],\n];\n</code></pre>"},{"location":"tutorials/custom-connectors/#tools","title":"Tools","text":"src/Tools/CustomerTools.php<pre><code>&lt;?php\n\nnamespace CustomerServer\\Tools;\n\nuse Mcp\\Capability\\Attribute\\McpTool;\nuse PDO;\n\nclass CustomerTools\n{\n    private PDO $db;\n\n    public function __construct()\n    {\n        $config = require __DIR__ . '/../../config.php';\n        $this-&gt;db = new PDO(\n            $config['database']['dsn'],\n            $config['database']['user'],\n            $config['database']['password'],\n            [PDO::ATTR_ERRMODE =&gt; PDO::ERRMODE_EXCEPTION]\n        );\n    }\n\n    #[McpTool(\n        name: 'search_customers',\n        description: 'Search for customers by name, email, or company'\n    )]\n    public function searchCustomers(\n        ?string $name = null,\n        ?string $email = null,\n        ?string $company = null,\n        int $limit = 10\n    ): array {\n        $conditions = [];\n        $params = [];\n\n        if ($name !== null) {\n            $conditions[] = 'name LIKE :name';\n            $params['name'] = \"%{$name}%\";\n        }\n\n        if ($email !== null) {\n            $conditions[] = 'email LIKE :email';\n            $params['email'] = \"%{$email}%\";\n        }\n\n        if ($company !== null) {\n            $conditions[] = 'company LIKE :company';\n            $params['company'] = \"%{$company}%\";\n        }\n\n        $where = empty($conditions) ? '' : 'WHERE ' . implode(' AND ', $conditions);\n\n        $sql = \"SELECT id, name, email, company, created_at\n                FROM customers {$where}\n                ORDER BY created_at DESC\n                LIMIT :limit\";\n\n        $stmt = $this-&gt;db-&gt;prepare($sql);\n        $stmt-&gt;bindValue(':limit', min($limit, 100), PDO::PARAM_INT);\n\n        foreach ($params as $key =&gt; $value) {\n            $stmt-&gt;bindValue(\":{$key}\", $value);\n        }\n\n        $stmt-&gt;execute();\n\n        return [\n            'customers' =&gt; $stmt-&gt;fetchAll(PDO::FETCH_ASSOC),\n            'count' =&gt; $stmt-&gt;rowCount(),\n        ];\n    }\n\n    #[McpTool(\n        name: 'get_customer',\n        description: 'Get detailed information about a specific customer'\n    )]\n    public function getCustomer(int $id): ?array\n    {\n        $stmt = $this-&gt;db-&gt;prepare(\n            'SELECT * FROM customers WHERE id = :id'\n        );\n        $stmt-&gt;execute(['id' =&gt; $id]);\n\n        $customer = $stmt-&gt;fetch(PDO::FETCH_ASSOC);\n\n        if (!$customer) {\n            return null;\n        }\n\n        // Get related data\n        $customer['orders'] = $this-&gt;getCustomerOrders($id);\n        $customer['notes'] = $this-&gt;getCustomerNotes($id);\n\n        return $customer;\n    }\n\n    #[McpTool(\n        name: 'create_customer',\n        description: 'Create a new customer record'\n    )]\n    public function createCustomer(\n        string $name,\n        string $email,\n        ?string $company = null,\n        ?string $phone = null\n    ): array {\n        // Validate email\n        if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n            throw new \\InvalidArgumentException('Invalid email address');\n        }\n\n        // Check for duplicate\n        $stmt = $this-&gt;db-&gt;prepare('SELECT id FROM customers WHERE email = :email');\n        $stmt-&gt;execute(['email' =&gt; $email]);\n\n        if ($stmt-&gt;fetch()) {\n            throw new \\RuntimeException('Customer with this email already exists');\n        }\n\n        // Insert\n        $stmt = $this-&gt;db-&gt;prepare(\n            'INSERT INTO customers (name, email, company, phone, created_at)\n             VALUES (:name, :email, :company, :phone, NOW())'\n        );\n\n        $stmt-&gt;execute([\n            'name' =&gt; $name,\n            'email' =&gt; $email,\n            'company' =&gt; $company,\n            'phone' =&gt; $phone,\n        ]);\n\n        $id = $this-&gt;db-&gt;lastInsertId();\n\n        return [\n            'success' =&gt; true,\n            'id' =&gt; $id,\n            'message' =&gt; \"Customer created with ID {$id}\",\n        ];\n    }\n\n    #[McpTool(\n        name: 'add_customer_note',\n        description: 'Add a note to a customer record'\n    )]\n    public function addCustomerNote(\n        int $customerId,\n        string $note,\n        ?string $category = 'general'\n    ): array {\n        // Verify customer exists\n        $stmt = $this-&gt;db-&gt;prepare('SELECT id FROM customers WHERE id = :id');\n        $stmt-&gt;execute(['id' =&gt; $customerId]);\n\n        if (!$stmt-&gt;fetch()) {\n            throw new \\RuntimeException(\"Customer {$customerId} not found\");\n        }\n\n        // Add note\n        $stmt = $this-&gt;db-&gt;prepare(\n            'INSERT INTO customer_notes (customer_id, note, category, created_at)\n             VALUES (:customer_id, :note, :category, NOW())'\n        );\n\n        $stmt-&gt;execute([\n            'customer_id' =&gt; $customerId,\n            'note' =&gt; $note,\n            'category' =&gt; $category,\n        ]);\n\n        return [\n            'success' =&gt; true,\n            'note_id' =&gt; $this-&gt;db-&gt;lastInsertId(),\n        ];\n    }\n\n    private function getCustomerOrders(int $customerId): array\n    {\n        $stmt = $this-&gt;db-&gt;prepare(\n            'SELECT id, total, status, created_at\n             FROM orders\n             WHERE customer_id = :id\n             ORDER BY created_at DESC\n             LIMIT 10'\n        );\n        $stmt-&gt;execute(['id' =&gt; $customerId]);\n        return $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);\n    }\n\n    private function getCustomerNotes(int $customerId): array\n    {\n        $stmt = $this-&gt;db-&gt;prepare(\n            'SELECT id, note, category, created_at\n             FROM customer_notes\n             WHERE customer_id = :id\n             ORDER BY created_at DESC'\n        );\n        $stmt-&gt;execute(['id' =&gt; $customerId]);\n        return $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);\n    }\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#resources","title":"Resources","text":"src/Resources/CustomerResources.php<pre><code>&lt;?php\n\nnamespace CustomerServer\\Resources;\n\nuse Mcp\\Capability\\Attribute\\McpResource;\nuse PDO;\n\nclass CustomerResources\n{\n    private PDO $db;\n\n    public function __construct()\n    {\n        // Initialize database connection\n    }\n\n    #[McpResource(\n        uri: 'customers://stats',\n        name: 'Customer Statistics',\n        mimeType: 'application/json'\n    )]\n    public function getStats(): array\n    {\n        return [\n            'total_customers' =&gt; $this-&gt;getTotalCustomers(),\n            'new_this_month' =&gt; $this-&gt;getNewThisMonth(),\n            'active_customers' =&gt; $this-&gt;getActiveCustomers(),\n            'top_companies' =&gt; $this-&gt;getTopCompanies(),\n        ];\n    }\n\n    #[McpResource(\n        uri: 'customers://{id}/profile',\n        name: 'Customer Profile',\n        mimeType: 'application/json',\n        isTemplate: true\n    )]\n    public function getProfile(int $id): array\n    {\n        $stmt = $this-&gt;db-&gt;prepare('SELECT * FROM customers WHERE id = :id');\n        $stmt-&gt;execute(['id' =&gt; $id]);\n\n        $customer = $stmt-&gt;fetch(PDO::FETCH_ASSOC);\n\n        if (!$customer) {\n            throw new \\RuntimeException(\"Customer {$id} not found\");\n        }\n\n        return $customer;\n    }\n\n    #[McpResource(\n        uri: 'customers://schema',\n        name: 'Database Schema',\n        mimeType: 'application/json'\n    )]\n    public function getSchema(): array\n    {\n        return [\n            'customers' =&gt; [\n                'id' =&gt; 'int (primary key)',\n                'name' =&gt; 'varchar(255)',\n                'email' =&gt; 'varchar(255) unique',\n                'company' =&gt; 'varchar(255) nullable',\n                'phone' =&gt; 'varchar(50) nullable',\n                'created_at' =&gt; 'datetime',\n                'updated_at' =&gt; 'datetime',\n            ],\n            'customer_notes' =&gt; [\n                'id' =&gt; 'int (primary key)',\n                'customer_id' =&gt; 'int (foreign key)',\n                'note' =&gt; 'text',\n                'category' =&gt; 'varchar(50)',\n                'created_at' =&gt; 'datetime',\n            ],\n            'orders' =&gt; [\n                'id' =&gt; 'int (primary key)',\n                'customer_id' =&gt; 'int (foreign key)',\n                'total' =&gt; 'decimal(10,2)',\n                'status' =&gt; 'varchar(50)',\n                'created_at' =&gt; 'datetime',\n            ],\n        ];\n    }\n\n    private function getTotalCustomers(): int\n    {\n        return (int) $this-&gt;db-&gt;query('SELECT COUNT(*) FROM customers')-&gt;fetchColumn();\n    }\n\n    private function getNewThisMonth(): int\n    {\n        return (int) $this-&gt;db-&gt;query(\n            'SELECT COUNT(*) FROM customers WHERE created_at &gt;= DATE_SUB(NOW(), INTERVAL 1 MONTH)'\n        )-&gt;fetchColumn();\n    }\n\n    private function getActiveCustomers(): int\n    {\n        return (int) $this-&gt;db-&gt;query(\n            'SELECT COUNT(DISTINCT customer_id) FROM orders WHERE created_at &gt;= DATE_SUB(NOW(), INTERVAL 3 MONTH)'\n        )-&gt;fetchColumn();\n    }\n\n    private function getTopCompanies(): array\n    {\n        return $this-&gt;db-&gt;query(\n            'SELECT company, COUNT(*) as count FROM customers WHERE company IS NOT NULL GROUP BY company ORDER BY count DESC LIMIT 10'\n        )-&gt;fetchAll(PDO::FETCH_ASSOC);\n    }\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#prompts","title":"Prompts","text":"src/Prompts/CustomerPrompts.php<pre><code>&lt;?php\n\nnamespace CustomerServer\\Prompts;\n\nuse Mcp\\Capability\\Attribute\\McpPrompt;\n\nclass CustomerPrompts\n{\n    #[McpPrompt(\n        name: 'customer_summary',\n        description: 'Generate a summary of a customer relationship'\n    )]\n    public function customerSummary(int $customerId): array\n    {\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Please provide a comprehensive summary of customer #{$customerId}.\n\n                    Use the following tools to gather information:\n                    1. get_customer - Get basic customer info and recent orders\n                    2. Check customer notes for any important history\n\n                    Then provide:\n                    - Customer overview (name, company, contact)\n                    - Relationship history\n                    - Recent activity\n                    - Key notes or concerns\n                    - Recommended next actions\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n\n    #[McpPrompt(\n        name: 'find_similar_customers',\n        description: 'Find customers similar to a given customer'\n    )]\n    public function findSimilar(\n        int $customerId,\n        ?string $criteria = null\n    ): array {\n        $criteriaText = $criteria\n            ? \"Focus on similarity in: {$criteria}\"\n            : \"Consider company size, industry, purchase patterns, and engagement\";\n\n        return [\n            [\n                'role' =&gt; 'user',\n                'content' =&gt; [\n                    'type' =&gt; 'text',\n                    'text' =&gt; &lt;&lt;&lt;PROMPT\n                    Find customers similar to customer #{$customerId}.\n\n                    {$criteriaText}\n\n                    Steps:\n                    1. Get details of customer #{$customerId}\n                    2. Search for customers with similar attributes\n                    3. Compare and rank by similarity\n\n                    Provide a list of 5-10 similar customers with explanations.\n                    PROMPT\n                ]\n            ]\n        ];\n    }\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#server-entry-point","title":"Server Entry Point","text":"server.php<pre><code>&lt;?php\n\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nuse Mcp\\Server;\nuse Mcp\\Server\\Transport\\StdioTransport;\n\n// Ensure clean stdout (no debug output)\nini_set('display_errors', '0');\nini_set('error_log', 'php://stderr');\n\n$server = Server::builder()\n    -&gt;setServerInfo('Customer MCP Server', '1.0.0')\n    -&gt;setInstructions(&lt;&lt;&lt;INSTRUCTIONS\n    This server provides access to the customer database.\n\n    Available capabilities:\n    - Search and retrieve customer records\n    - Create new customers\n    - Add notes to customer records\n    - View customer statistics\n\n    Use search_customers to find customers before operating on them.\n    INSTRUCTIONS)\n    -&gt;setDiscovery(__DIR__ . '/src', ['.'])\n    -&gt;build();\n\n$transport = new StdioTransport();\n$server-&gt;run($transport);\n</code></pre>"},{"location":"tutorials/custom-connectors/#registering-with-rea","title":"Registering with Rea","text":""},{"location":"tutorials/custom-connectors/#configuration_1","title":"Configuration","text":"config/mcp.php<pre><code>'servers' =&gt; [\n    'customers' =&gt; [\n        'transport' =&gt; 'stdio',\n        'command' =&gt; 'php',\n        'args' =&gt; ['/path/to/customer-mcp-server/server.php'],\n        'env' =&gt; [\n            'DB_DSN' =&gt; env('CUSTOMER_DB_DSN'),\n            'DB_USER' =&gt; env('CUSTOMER_DB_USER'),\n            'DB_PASSWORD' =&gt; env('CUSTOMER_DB_PASSWORD'),\n        ],\n    ],\n],\n</code></pre>"},{"location":"tutorials/custom-connectors/#usage","title":"Usage","text":"<pre><code>User: \"Find all customers from Acme Corp\"\n\nAgent: Uses customers.search_customers with company=\"Acme Corp\"\n       Returns list of matching customers\n\nUser: \"Add a note to customer #123 about our call today\"\n\nAgent: Uses customers.add_customer_note with customerId=123\n       and note=\"Discussed renewal - customer interested\"\n</code></pre>"},{"location":"tutorials/custom-connectors/#best-practices","title":"Best Practices","text":""},{"location":"tutorials/custom-connectors/#1-descriptive-tool-names","title":"1. Descriptive Tool Names","text":"<pre><code>// Good\n#[McpTool(name: 'search_customers')]\n#[McpTool(name: 'get_customer_orders')]\n#[McpTool(name: 'create_support_ticket')]\n\n// Bad\n#[McpTool(name: 'search')]\n#[McpTool(name: 'get')]\n#[McpTool(name: 'create')]\n</code></pre>"},{"location":"tutorials/custom-connectors/#2-comprehensive-descriptions","title":"2. Comprehensive Descriptions","text":"<pre><code>#[McpTool(\n    name: 'search_customers',\n    description: 'Search for customers by name, email, or company. ' .\n                 'Returns up to 10 results by default. ' .\n                 'Use this before get_customer to find customer IDs.'\n)]\n</code></pre>"},{"location":"tutorials/custom-connectors/#3-input-validation","title":"3. Input Validation","text":"<pre><code>public function createCustomer(string $email): array\n{\n    // Validate\n    if (!filter_var($email, FILTER_VALIDATE_EMAIL)) {\n        throw new \\InvalidArgumentException(\n            \"Invalid email format: {$email}\"\n        );\n    }\n\n    // Sanitize\n    $email = strtolower(trim($email));\n\n    // Process...\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#4-error-handling","title":"4. Error Handling","text":"<pre><code>public function getCustomer(int $id): array\n{\n    try {\n        $customer = $this-&gt;repository-&gt;find($id);\n\n        if ($customer === null) {\n            return [\n                'error' =&gt; \"Customer {$id} not found\",\n                'suggestion' =&gt; 'Use search_customers to find valid IDs',\n            ];\n        }\n\n        return $customer;\n\n    } catch (\\PDOException $e) {\n        error_log(\"Database error: \" . $e-&gt;getMessage());\n\n        return [\n            'error' =&gt; 'Database error occurred',\n            'code' =&gt; 'DB_ERROR',\n        ];\n    }\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#5-resource-organization","title":"5. Resource Organization","text":"<pre><code>// Logical URI scheme\n'customers://stats'           // Aggregate data\n'customers://{id}/profile'    // Individual record\n'customers://{id}/orders'     // Related data\n'customers://schema'          // Metadata\n</code></pre>"},{"location":"tutorials/custom-connectors/#packaging-for-distribution","title":"Packaging for Distribution","text":""},{"location":"tutorials/custom-connectors/#composer-package","title":"Composer Package","text":"composer.json<pre><code>{\n    \"name\": \"mycompany/customer-mcp-server\",\n    \"description\": \"MCP server for customer database\",\n    \"type\": \"library\",\n    \"require\": {\n        \"php\": \"^8.1\",\n        \"mcp/sdk\": \"^1.0\"\n    },\n    \"autoload\": {\n        \"psr-4\": {\n            \"MyCompany\\\\CustomerMCP\\\\\": \"src/\"\n        }\n    },\n    \"bin\": [\"server.php\"]\n}\n</code></pre>"},{"location":"tutorials/custom-connectors/#distribution","title":"Distribution","text":"<pre><code># Install globally\ncomposer global require mycompany/customer-mcp-server\n\n# Use in Rea\n'command' =&gt; 'customer-mcp-server'\n</code></pre>"},{"location":"tutorials/custom-connectors/#next-steps","title":"Next Steps","text":"<ul> <li>PHP Server Implementation - Full server details</li> <li>Security Reference - Secure your server</li> <li>API Reference - Protocol reference</li> </ul>"},{"location":"tutorials/notion-mcp/","title":"Notion MCP Integration Tutorial","text":"<p>This comprehensive tutorial walks you through integrating Notion with Rea using the Model Context Protocol (MCP). By the end, your Rea AI agents will be able to search, read, create, and update Notion content.</p> <p></p>"},{"location":"tutorials/notion-mcp/#what-youll-build","title":"What You'll Build","text":"<p>A complete integration that allows Rea agents to:</p> <ul> <li>Search your Notion workspace for pages and databases</li> <li>Read page content and database entries</li> <li>Create new pages and database items</li> <li>Update existing content</li> <li>Comment on pages</li> </ul>"},{"location":"tutorials/notion-mcp/#prerequisites","title":"Prerequisites","text":"<p>Before starting, ensure you have:</p> <ul> <li>[ ] Rea platform (v1.15+) with PHP 8.1+</li> <li>[ ] Composer installed</li> <li>[ ] Node.js 18+ (for running the Notion MCP server)</li> <li>[ ] A Notion account with a workspace</li> <li>[ ] Admin access to create integrations</li> </ul>"},{"location":"tutorials/notion-mcp/#architecture-overview","title":"Architecture Overview","text":"<p>The integration consists of three components:</p> Component Technology Role Rea Platform PHP/Laravel MCP Host &amp; Client Notion MCP Server Node.js/TypeScript MCP Server Notion API REST API Data source"},{"location":"tutorials/notion-mcp/#step-1-create-a-notion-integration","title":"Step 1: Create a Notion Integration","text":""},{"location":"tutorials/notion-mcp/#11-navigate-to-integrations","title":"1.1 Navigate to Integrations","text":"<ol> <li>Go to notion.so/my-integrations</li> <li>Click \"+ New integration\"</li> </ol>"},{"location":"tutorials/notion-mcp/#12-configure-integration","title":"1.2 Configure Integration","text":"<p>Fill in the integration details:</p> Field Value Name <code>Rea MCP Integration</code> Associated workspace Select your workspace Logo (Optional) Upload a logo"},{"location":"tutorials/notion-mcp/#13-set-capabilities","title":"1.3 Set Capabilities","text":"<p>Enable the following capabilities:</p> Read ContentUpdate ContentInsert ContentRead CommentsCreate Comments <p>Required for searching and reading pages/databases.</p> <p>Required for modifying existing pages.</p> <p>Required for creating new pages and blocks.</p> <p>Required for reading page comments.</p> <p>Required for adding comments to pages.</p> <p>Principle of Least Privilege</p> <p>Only enable capabilities your agents actually need. For read-only use cases, disable Update, Insert, and Create Comments.</p>"},{"location":"tutorials/notion-mcp/#14-copy-the-token","title":"1.4 Copy the Token","text":"<p>After clicking Submit, you'll see your Internal Integration Token:</p> <pre><code>ntn_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\n</code></pre> <p>Keep This Secret</p> <p>Never commit this token to version control or share it publicly.</p>"},{"location":"tutorials/notion-mcp/#step-2-grant-notion-access","title":"Step 2: Grant Notion Access","text":"<p>The integration needs explicit access to each page/database.</p>"},{"location":"tutorials/notion-mcp/#option-a-via-page-menu","title":"Option A: Via Page Menu","text":"<ol> <li>Open a Notion page you want to access</li> <li>Click \"...\" (top-right menu)</li> <li>Select \"Add connections\"</li> <li>Find and select \"Rea MCP Integration\"</li> </ol>"},{"location":"tutorials/notion-mcp/#option-b-via-database","title":"Option B: Via Database","text":"<ol> <li>Open a Notion database</li> <li>Click \"...\" \u2192 \"Add connections\"</li> <li>Select your integration</li> </ol> <p>Access Inheritance</p> <p>Granting access to a parent page automatically grants access to all child pages.</p>"},{"location":"tutorials/notion-mcp/#step-3-install-php-mcp-sdk","title":"Step 3: Install PHP MCP SDK","text":"<p>Add the MCP SDK to your Rea installation:</p> <pre><code>cd /path/to/rea\ncomposer require mcp/sdk\n</code></pre> <p>SDK Status</p> <p>The PHP MCP SDK is in active development. Check github.com/modelcontextprotocol/php-sdk for the latest version.</p>"},{"location":"tutorials/notion-mcp/#step-4-configure-the-mcp-server","title":"Step 4: Configure the MCP Server","text":""},{"location":"tutorials/notion-mcp/#41-create-configuration-file","title":"4.1 Create Configuration File","text":"<p>Create <code>config/mcp.php</code>:</p> config/mcp.php<pre><code>&lt;?php\n\nreturn [\n    /*\n    |--------------------------------------------------------------------------\n    | MCP Servers Configuration\n    |--------------------------------------------------------------------------\n    |\n    | Define your MCP server connections here. Each server can use either\n    | 'stdio' transport (local process) or 'http' transport (remote server).\n    |\n    */\n\n    'servers' =&gt; [\n        'notion' =&gt; [\n            // Transport type: 'stdio' for local, 'http' for remote\n            'transport' =&gt; 'stdio',\n\n            // Command to start the server (stdio only)\n            'command' =&gt; 'npx',\n            'args' =&gt; ['-y', '@notionhq/notion-mcp-server'],\n\n            // Environment variables\n            'env' =&gt; [\n                'NOTION_TOKEN' =&gt; env('NOTION_TOKEN'),\n            ],\n\n            // Connection timeout in seconds\n            'timeout' =&gt; 30,\n\n            // Auto-reconnect on failure\n            'reconnect' =&gt; true,\n            'reconnect_delay' =&gt; 5,\n        ],\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Tool Caching\n    |--------------------------------------------------------------------------\n    |\n    | Cache discovered tools to improve performance.\n    |\n    */\n\n    'cache' =&gt; [\n        'enabled' =&gt; true,\n        'ttl' =&gt; 300, // 5 minutes\n        'prefix' =&gt; 'mcp_',\n    ],\n\n    /*\n    |--------------------------------------------------------------------------\n    | Security Settings\n    |--------------------------------------------------------------------------\n    */\n\n    'security' =&gt; [\n        // Require approval for destructive operations\n        'require_approval' =&gt; ['delete', 'archive'],\n\n        // Log all tool executions\n        'audit_logging' =&gt; true,\n    ],\n];\n</code></pre>"},{"location":"tutorials/notion-mcp/#42-set-environment-variable","title":"4.2 Set Environment Variable","text":"<p>Add your Notion token to <code>.env</code>:</p> .env<pre><code>NOTION_TOKEN=ntn_your_token_here\n</code></pre>"},{"location":"tutorials/notion-mcp/#step-5-create-the-mcp-service","title":"Step 5: Create the MCP Service","text":""},{"location":"tutorials/notion-mcp/#51-mcp-client-interface","title":"5.1 MCP Client Interface","text":"app/Contracts/MCPClientInterface.php<pre><code>&lt;?php\n\nnamespace App\\Contracts;\n\ninterface MCPClientInterface\n{\n    /**\n     * Connect to the MCP server.\n     */\n    public function connect(): void;\n\n    /**\n     * Check if connected.\n     */\n    public function isConnected(): bool;\n\n    /**\n     * List available tools.\n     *\n     * @return array&lt;string, array{name: string, description: string, inputSchema: array}&gt;\n     */\n    public function listTools(): array;\n\n    /**\n     * Call a tool with arguments.\n     *\n     * @param string $name Tool name\n     * @param array $arguments Tool arguments\n     * @return mixed Tool result\n     */\n    public function callTool(string $name, array $arguments): mixed;\n\n    /**\n     * List available resources.\n     *\n     * @return array&lt;string, array{uri: string, name: string, mimeType: string}&gt;\n     */\n    public function listResources(): array;\n\n    /**\n     * Read a resource by URI.\n     *\n     * @param string $uri Resource URI\n     * @return array{uri: string, mimeType: string, text?: string, blob?: string}\n     */\n    public function readResource(string $uri): array;\n\n    /**\n     * Disconnect from the server.\n     */\n    public function disconnect(): void;\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#52-stdio-mcp-client","title":"5.2 Stdio MCP Client","text":"app/Services/MCP/StdioMCPClient.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Contracts\\MCPClientInterface;\nuse Illuminate\\Support\\Facades\\Log;\nuse Symfony\\Component\\Process\\Process;\n\nclass StdioMCPClient implements MCPClientInterface\n{\n    private ?Process $process = null;\n    private array $config;\n    private array $capabilities = [];\n    private array $tools = [];\n    private int $requestId = 0;\n\n    public function __construct(array $config)\n    {\n        $this-&gt;config = $config;\n    }\n\n    public function connect(): void\n    {\n        // Build environment\n        $env = array_merge($_ENV, $this-&gt;config['env'] ?? []);\n\n        // Start server process\n        $command = array_merge(\n            [$this-&gt;config['command']],\n            $this-&gt;config['args'] ?? []\n        );\n\n        $this-&gt;process = new Process($command);\n        $this-&gt;process-&gt;setEnv($env);\n        $this-&gt;process-&gt;setTimeout(null);\n        $this-&gt;process-&gt;start();\n\n        // Wait for process to be ready\n        usleep(500000); // 500ms\n\n        if (!$this-&gt;process-&gt;isRunning()) {\n            throw new \\RuntimeException(\n                'MCP server failed to start: ' . $this-&gt;process-&gt;getErrorOutput()\n            );\n        }\n\n        // Send initialize request\n        $response = $this-&gt;sendRequest('initialize', [\n            'protocolVersion' =&gt; '2024-11-05',\n            'capabilities' =&gt; [\n                'roots' =&gt; ['listChanged' =&gt; true],\n            ],\n            'clientInfo' =&gt; [\n                'name' =&gt; 'rea-mcp-client',\n                'version' =&gt; '1.0.0',\n            ],\n        ]);\n\n        $this-&gt;capabilities = $response['capabilities'] ?? [];\n\n        // Send initialized notification\n        $this-&gt;sendNotification('notifications/initialized');\n\n        Log::info('MCP server connected', [\n            'server' =&gt; $response['serverInfo'] ?? [],\n            'capabilities' =&gt; $this-&gt;capabilities,\n        ]);\n    }\n\n    public function isConnected(): bool\n    {\n        return $this-&gt;process !== null &amp;&amp; $this-&gt;process-&gt;isRunning();\n    }\n\n    public function listTools(): array\n    {\n        if (!empty($this-&gt;tools)) {\n            return $this-&gt;tools;\n        }\n\n        $response = $this-&gt;sendRequest('tools/list');\n        $this-&gt;tools = $response['tools'] ?? [];\n\n        return $this-&gt;tools;\n    }\n\n    public function callTool(string $name, array $arguments): mixed\n    {\n        Log::info('MCP tool call', ['tool' =&gt; $name, 'arguments' =&gt; $arguments]);\n\n        $response = $this-&gt;sendRequest('tools/call', [\n            'name' =&gt; $name,\n            'arguments' =&gt; $arguments,\n        ]);\n\n        if (isset($response['isError']) &amp;&amp; $response['isError']) {\n            throw new \\RuntimeException(\n                'Tool execution failed: ' . json_encode($response['content'])\n            );\n        }\n\n        return $response['content'] ?? [];\n    }\n\n    public function listResources(): array\n    {\n        $response = $this-&gt;sendRequest('resources/list');\n        return $response['resources'] ?? [];\n    }\n\n    public function readResource(string $uri): array\n    {\n        $response = $this-&gt;sendRequest('resources/read', [\n            'uri' =&gt; $uri,\n        ]);\n\n        return $response['contents'][0] ?? [];\n    }\n\n    public function disconnect(): void\n    {\n        if ($this-&gt;process !== null) {\n            $this-&gt;process-&gt;stop(3);\n            $this-&gt;process = null;\n        }\n\n        $this-&gt;capabilities = [];\n        $this-&gt;tools = [];\n    }\n\n    private function sendRequest(string $method, array $params = []): array\n    {\n        $id = ++$this-&gt;requestId;\n\n        $request = [\n            'jsonrpc' =&gt; '2.0',\n            'id' =&gt; $id,\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $request['params'] = $params;\n        }\n\n        $this-&gt;writeMessage($request);\n        return $this-&gt;readResponse($id);\n    }\n\n    private function sendNotification(string $method, array $params = []): void\n    {\n        $notification = [\n            'jsonrpc' =&gt; '2.0',\n            'method' =&gt; $method,\n        ];\n\n        if (!empty($params)) {\n            $notification['params'] = $params;\n        }\n\n        $this-&gt;writeMessage($notification);\n    }\n\n    private function writeMessage(array $message): void\n    {\n        $json = json_encode($message);\n        $this-&gt;process-&gt;getInput()-&gt;write($json . \"\\n\");\n    }\n\n    private function readResponse(int $expectedId): array\n    {\n        $timeout = $this-&gt;config['timeout'] ?? 30;\n        $startTime = time();\n\n        while (time() - $startTime &lt; $timeout) {\n            $output = $this-&gt;process-&gt;getIncrementalOutput();\n\n            if (!empty($output)) {\n                foreach (explode(\"\\n\", trim($output)) as $line) {\n                    if (empty($line)) continue;\n\n                    $response = json_decode($line, true);\n\n                    if (json_last_error() !== JSON_ERROR_NONE) {\n                        continue;\n                    }\n\n                    if (isset($response['id']) &amp;&amp; $response['id'] === $expectedId) {\n                        if (isset($response['error'])) {\n                            throw new \\RuntimeException(\n                                'MCP error: ' . $response['error']['message']\n                            );\n                        }\n                        return $response['result'] ?? [];\n                    }\n                }\n            }\n\n            usleep(10000); // 10ms\n        }\n\n        throw new \\RuntimeException('MCP request timeout');\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#53-mcp-manager-service","title":"5.3 MCP Manager Service","text":"app/Services/MCP/MCPManagerService.php<pre><code>&lt;?php\n\nnamespace App\\Services\\MCP;\n\nuse App\\Contracts\\MCPClientInterface;\nuse Illuminate\\Support\\Facades\\Cache;\nuse Illuminate\\Support\\Facades\\Log;\n\nclass MCPManagerService\n{\n    private array $clients = [];\n    private array $config;\n\n    public function __construct()\n    {\n        $this-&gt;config = config('mcp');\n    }\n\n    /**\n     * Get or create a client for a server.\n     */\n    public function getClient(string $serverName): MCPClientInterface\n    {\n        if (isset($this-&gt;clients[$serverName])) {\n            return $this-&gt;clients[$serverName];\n        }\n\n        $serverConfig = $this-&gt;config['servers'][$serverName] ?? null;\n\n        if ($serverConfig === null) {\n            throw new \\InvalidArgumentException(\"Unknown MCP server: {$serverName}\");\n        }\n\n        $client = $this-&gt;createClient($serverConfig);\n        $client-&gt;connect();\n\n        $this-&gt;clients[$serverName] = $client;\n\n        return $client;\n    }\n\n    /**\n     * Get all tools across all configured servers.\n     */\n    public function getAllTools(): array\n    {\n        $cacheKey = 'mcp_all_tools';\n\n        if ($this-&gt;config['cache']['enabled'] ?? false) {\n            $cached = Cache::get($cacheKey);\n            if ($cached !== null) {\n                return $cached;\n            }\n        }\n\n        $allTools = [];\n\n        foreach (array_keys($this-&gt;config['servers']) as $serverName) {\n            try {\n                $client = $this-&gt;getClient($serverName);\n                $tools = $client-&gt;listTools();\n\n                foreach ($tools as $tool) {\n                    $fullName = \"{$serverName}.{$tool['name']}\";\n                    $allTools[$fullName] = array_merge($tool, [\n                        'server' =&gt; $serverName,\n                        'fullName' =&gt; $fullName,\n                    ]);\n                }\n            } catch (\\Exception $e) {\n                Log::warning(\"Failed to get tools from {$serverName}\", [\n                    'error' =&gt; $e-&gt;getMessage(),\n                ]);\n            }\n        }\n\n        if ($this-&gt;config['cache']['enabled'] ?? false) {\n            Cache::put($cacheKey, $allTools, $this-&gt;config['cache']['ttl'] ?? 300);\n        }\n\n        return $allTools;\n    }\n\n    /**\n     * Call a tool by its full name (server.toolName).\n     */\n    public function callTool(string $fullName, array $arguments): mixed\n    {\n        [$serverName, $toolName] = $this-&gt;parseFullName($fullName);\n\n        // Security check for destructive operations\n        if ($this-&gt;requiresApproval($toolName)) {\n            throw new \\RuntimeException(\n                \"Tool '{$toolName}' requires user approval before execution\"\n            );\n        }\n\n        $client = $this-&gt;getClient($serverName);\n\n        // Audit logging\n        if ($this-&gt;config['security']['audit_logging'] ?? false) {\n            Log::info('MCP tool execution', [\n                'server' =&gt; $serverName,\n                'tool' =&gt; $toolName,\n                'arguments' =&gt; $arguments,\n            ]);\n        }\n\n        return $client-&gt;callTool($toolName, $arguments);\n    }\n\n    /**\n     * Disconnect all clients.\n     */\n    public function disconnectAll(): void\n    {\n        foreach ($this-&gt;clients as $client) {\n            try {\n                $client-&gt;disconnect();\n            } catch (\\Exception $e) {\n                Log::warning('Error disconnecting MCP client', [\n                    'error' =&gt; $e-&gt;getMessage(),\n                ]);\n            }\n        }\n\n        $this-&gt;clients = [];\n    }\n\n    private function createClient(array $config): MCPClientInterface\n    {\n        return match ($config['transport'] ?? 'stdio') {\n            'stdio' =&gt; new StdioMCPClient($config),\n            'http' =&gt; new HttpMCPClient($config),\n            default =&gt; throw new \\InvalidArgumentException(\n                \"Unknown transport: {$config['transport']}\"\n            ),\n        };\n    }\n\n    private function parseFullName(string $fullName): array\n    {\n        $parts = explode('.', $fullName, 2);\n\n        if (count($parts) !== 2) {\n            throw new \\InvalidArgumentException(\n                \"Invalid tool name format. Expected 'server.tool', got '{$fullName}'\"\n            );\n        }\n\n        return $parts;\n    }\n\n    private function requiresApproval(string $toolName): bool\n    {\n        $requireApproval = $this-&gt;config['security']['require_approval'] ?? [];\n\n        foreach ($requireApproval as $keyword) {\n            if (str_contains(strtolower($toolName), strtolower($keyword))) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#54-service-provider","title":"5.4 Service Provider","text":"app/Providers/MCPServiceProvider.php<pre><code>&lt;?php\n\nnamespace App\\Providers;\n\nuse App\\Services\\MCP\\MCPManagerService;\nuse Illuminate\\Support\\ServiceProvider;\n\nclass MCPServiceProvider extends ServiceProvider\n{\n    public function register(): void\n    {\n        $this-&gt;app-&gt;singleton(MCPManagerService::class, function ($app) {\n            return new MCPManagerService();\n        });\n    }\n\n    public function boot(): void\n    {\n        $this-&gt;publishes([\n            __DIR__ . '/../../config/mcp.php' =&gt; config_path('mcp.php'),\n        ], 'mcp-config');\n\n        // Disconnect on shutdown\n        $this-&gt;app-&gt;terminating(function () {\n            $this-&gt;app-&gt;make(MCPManagerService::class)-&gt;disconnectAll();\n        });\n    }\n}\n</code></pre> <p>Register the provider in <code>config/app.php</code>:</p> <pre><code>'providers' =&gt; [\n    // ...\n    App\\Providers\\MCPServiceProvider::class,\n],\n</code></pre>"},{"location":"tutorials/notion-mcp/#step-6-integrate-with-rea-agents","title":"Step 6: Integrate with Rea Agents","text":""},{"location":"tutorials/notion-mcp/#61-agent-tool-discovery","title":"6.1 Agent Tool Discovery","text":"app/Services/AgentService.php<pre><code>&lt;?php\n\nnamespace App\\Services;\n\nuse App\\Services\\MCP\\MCPManagerService;\n\nclass AgentService\n{\n    public function __construct(\n        private MCPManagerService $mcpManager,\n        private AIService $aiService,\n    ) {}\n\n    /**\n     * Get all available tools for the AI agent.\n     */\n    public function getAvailableTools(): array\n    {\n        $mcpTools = $this-&gt;mcpManager-&gt;getAllTools();\n\n        // Convert to AI-compatible format\n        return array_map(function ($tool) {\n            return [\n                'name' =&gt; $tool['fullName'],\n                'description' =&gt; $tool['description'],\n                'parameters' =&gt; $tool['inputSchema'],\n            ];\n        }, $mcpTools);\n    }\n\n    /**\n     * Execute a tool requested by the AI.\n     */\n    public function executeTool(string $toolName, array $arguments): array\n    {\n        // Check if it's an MCP tool\n        if (str_contains($toolName, '.')) {\n            $result = $this-&gt;mcpManager-&gt;callTool($toolName, $arguments);\n\n            return [\n                'success' =&gt; true,\n                'result' =&gt; $result,\n            ];\n        }\n\n        // Handle built-in tools...\n        throw new \\InvalidArgumentException(\"Unknown tool: {$toolName}\");\n    }\n\n    /**\n     * Process a user message with tool usage.\n     */\n    public function processMessage(string $userMessage): string\n    {\n        $tools = $this-&gt;getAvailableTools();\n\n        // Send to AI with tools\n        $response = $this-&gt;aiService-&gt;chat($userMessage, $tools);\n\n        // Handle tool calls\n        while ($response['tool_calls'] ?? false) {\n            foreach ($response['tool_calls'] as $toolCall) {\n                $result = $this-&gt;executeTool(\n                    $toolCall['name'],\n                    $toolCall['arguments']\n                );\n\n                $response = $this-&gt;aiService-&gt;submitToolResult(\n                    $toolCall['id'],\n                    $result\n                );\n            }\n        }\n\n        return $response['content'];\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#62-api-endpoint","title":"6.2 API Endpoint","text":"app/Http/Controllers/AgentController.php<pre><code>&lt;?php\n\nnamespace App\\Http\\Controllers;\n\nuse App\\Services\\AgentService;\nuse Illuminate\\Http\\Request;\n\nclass AgentController extends Controller\n{\n    public function __construct(\n        private AgentService $agentService,\n    ) {}\n\n    public function chat(Request $request)\n    {\n        $request-&gt;validate([\n            'message' =&gt; 'required|string|max:10000',\n        ]);\n\n        $response = $this-&gt;agentService-&gt;processMessage(\n            $request-&gt;input('message')\n        );\n\n        return response()-&gt;json([\n            'message' =&gt; $response,\n        ]);\n    }\n\n    public function tools()\n    {\n        $tools = $this-&gt;agentService-&gt;getAvailableTools();\n\n        return response()-&gt;json([\n            'tools' =&gt; $tools,\n        ]);\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#step-7-test-the-integration","title":"Step 7: Test the Integration","text":""},{"location":"tutorials/notion-mcp/#71-create-test-command","title":"7.1 Create Test Command","text":"app/Console/Commands/TestNotionMCP.php<pre><code>&lt;?php\n\nnamespace App\\Console\\Commands;\n\nuse App\\Services\\MCP\\MCPManagerService;\nuse Illuminate\\Console\\Command;\n\nclass TestNotionMCP extends Command\n{\n    protected $signature = 'mcp:test-notion';\n    protected $description = 'Test Notion MCP integration';\n\n    public function handle(MCPManagerService $mcp): int\n    {\n        $this-&gt;info('Testing Notion MCP integration...');\n        $this-&gt;newLine();\n\n        try {\n            // Connect\n            $this-&gt;info('1. Connecting to Notion MCP server...');\n            $client = $mcp-&gt;getClient('notion');\n            $this-&gt;info('   \u2713 Connected');\n\n            // List tools\n            $this-&gt;newLine();\n            $this-&gt;info('2. Discovering available tools...');\n            $tools = $client-&gt;listTools();\n            $this-&gt;info(\"   \u2713 Found \" . count($tools) . \" tools:\");\n\n            foreach (array_slice($tools, 0, 5) as $tool) {\n                $this-&gt;line(\"     - {$tool['name']}: {$tool['description']}\");\n            }\n\n            if (count($tools) &gt; 5) {\n                $this-&gt;line(\"     ... and \" . (count($tools) - 5) . \" more\");\n            }\n\n            // Test search\n            $this-&gt;newLine();\n            $this-&gt;info('3. Testing search...');\n            $result = $client-&gt;callTool('search', [\n                'query' =&gt; 'test',\n            ]);\n\n            $this-&gt;info('   \u2713 Search completed');\n\n            // Parse and display results\n            $content = json_decode($result[0]['text'] ?? '{}', true);\n            $resultCount = count($content['results'] ?? []);\n            $this-&gt;info(\"   Found {$resultCount} result(s)\");\n\n            $this-&gt;newLine();\n            $this-&gt;info('\u2713 All tests passed!');\n\n            return 0;\n\n        } catch (\\Exception $e) {\n            $this-&gt;error('Test failed: ' . $e-&gt;getMessage());\n            return 1;\n\n        } finally {\n            $mcp-&gt;disconnectAll();\n        }\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#72-run-the-test","title":"7.2 Run the Test","text":"<pre><code>php artisan mcp:test-notion\n</code></pre> <p>Expected output:</p> <pre><code>Testing Notion MCP integration...\n\n1. Connecting to Notion MCP server...\n   \u2713 Connected\n\n2. Discovering available tools...\n   \u2713 Found 12 tools:\n     - search: Search for pages and databases\n     - get_page: Retrieve a page by ID\n     - create_page: Create a new page\n     - update_page: Update an existing page\n     - query_database: Query a database\n     ... and 7 more\n\n3. Testing search...\n   \u2713 Search completed\n   Found 3 result(s)\n\n\u2713 All tests passed!\n</code></pre>"},{"location":"tutorials/notion-mcp/#step-8-production-considerations","title":"Step 8: Production Considerations","text":""},{"location":"tutorials/notion-mcp/#81-error-handling","title":"8.1 Error Handling","text":"<pre><code>public function callToolWithRetry(string $name, array $args, int $maxRetries = 3): mixed\n{\n    $attempt = 0;\n\n    while ($attempt &lt; $maxRetries) {\n        try {\n            return $this-&gt;mcpManager-&gt;callTool($name, $args);\n        } catch (\\Exception $e) {\n            $attempt++;\n\n            if ($attempt &gt;= $maxRetries) {\n                throw $e;\n            }\n\n            Log::warning(\"MCP tool call failed, retrying\", [\n                'tool' =&gt; $name,\n                'attempt' =&gt; $attempt,\n                'error' =&gt; $e-&gt;getMessage(),\n            ]);\n\n            sleep(1 * $attempt); // Exponential backoff\n        }\n    }\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#82-rate-limiting","title":"8.2 Rate Limiting","text":"<p>Notion API has rate limits (~3 requests/second). Implement throttling:</p> <pre><code>use Illuminate\\Support\\Facades\\RateLimiter;\n\npublic function callTool(string $name, array $arguments): mixed\n{\n    $key = 'mcp_notion_' . auth()-&gt;id();\n\n    if (RateLimiter::tooManyAttempts($key, 3)) {\n        $seconds = RateLimiter::availableIn($key);\n        throw new \\RuntimeException(\"Rate limited. Retry in {$seconds} seconds.\");\n    }\n\n    RateLimiter::hit($key, 1);\n\n    return $this-&gt;mcpManager-&gt;callTool($name, $arguments);\n}\n</code></pre>"},{"location":"tutorials/notion-mcp/#83-monitoring","title":"8.3 Monitoring","text":"<p>Add metrics for MCP operations:</p> <pre><code>use Illuminate\\Support\\Facades\\Event;\n\nEvent::listen('mcp.tool.called', function ($event) {\n    Metrics::increment('mcp.tool.calls', [\n        'server' =&gt; $event-&gt;server,\n        'tool' =&gt; $event-&gt;tool,\n    ]);\n\n    Metrics::timing('mcp.tool.duration', $event-&gt;duration, [\n        'server' =&gt; $event-&gt;server,\n        'tool' =&gt; $event-&gt;tool,\n    ]);\n});\n</code></pre>"},{"location":"tutorials/notion-mcp/#example-use-cases","title":"Example Use Cases","text":""},{"location":"tutorials/notion-mcp/#search-and-summarize","title":"Search and Summarize","text":"<pre><code>User: \"Find all my meeting notes from this week and summarize them\"\n\nAgent:\n1. Calls notion.search with query \"meeting notes\"\n2. Filters results by date\n3. Calls notion.get_page for each result\n4. Summarizes content using AI\n</code></pre>"},{"location":"tutorials/notion-mcp/#create-task-from-conversation","title":"Create Task from Conversation","text":"<pre><code>User: \"Add a task to my Notion database: Review Q4 budget by Friday\"\n\nAgent:\n1. Calls notion.search to find \"Tasks\" database\n2. Calls notion.create_page with:\n   - Parent: Tasks database ID\n   - Properties: Title, Due Date, Status\n</code></pre>"},{"location":"tutorials/notion-mcp/#update-project-status","title":"Update Project Status","text":"<pre><code>User: \"Mark the 'Website Redesign' project as completed\"\n\nAgent:\n1. Calls notion.search for \"Website Redesign\"\n2. Calls notion.update_page to set Status = \"Completed\"\n</code></pre>"},{"location":"tutorials/notion-mcp/#ui-preview","title":"UI Preview","text":"<p>Here's what the MCP integration looks like in the Rea interface:</p> <p></p>"},{"location":"tutorials/notion-mcp/#troubleshooting","title":"Troubleshooting","text":""},{"location":"tutorials/notion-mcp/#common-issues","title":"Common Issues","text":"Issue Solution \"Token invalid\" Verify token starts with <code>ntn_</code>, regenerate if needed \"Object not found\" Grant integration access to the page/database \"Rate limited\" Implement throttling, reduce request frequency \"Connection timeout\" Increase timeout in config, check Node.js installation"},{"location":"tutorials/notion-mcp/#debug-mode","title":"Debug Mode","text":"<p>Enable debug logging:</p> config/mcp.php<pre><code>'debug' =&gt; env('MCP_DEBUG', false),\n</code></pre> .env<pre><code>MCP_DEBUG=true\n</code></pre>"},{"location":"tutorials/notion-mcp/#next-steps","title":"Next Steps","text":"<ul> <li>Building Custom Connectors - Create your own MCP servers</li> <li>Security Best Practices - Secure your integration</li> <li>PHP Server Implementation - Build MCP servers in PHP</li> </ul> <p>Congratulations!</p> <p>You've successfully integrated Notion with Rea via MCP. Your AI agents can now interact with your Notion workspace.</p>"}]}