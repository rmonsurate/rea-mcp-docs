%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#a484fb', 'primaryTextColor': '#ffffff', 'primaryBorderColor': '#a484fb', 'secondaryColor': '#22c55a', 'secondaryTextColor': '#ffffff', 'tertiaryColor': '#1e293b', 'lineColor': '#a484fb', 'textColor': '#f8fafc', 'mainBkg': '#0f172a', 'nodeBorder': '#a484fb', 'nodeTextColor': '#ffffff'}}}%%
flowchart TD
    A["User Request"] --> B{"AI Agent<br/>Analysis"}
    B --> C["Identify Required Tool"]
    C --> D["Validate Parameters"]
    D --> E{"Parameters<br/>Valid?"}
    E -->|No| F["Return Error"]
    E -->|Yes| G["MCP Client"]
    G --> H["JSON-RPC Request"]
    H --> I["MCP Server"]
    I --> J["Execute Tool Logic"]
    J --> K{"External API<br/>Call?"}
    K -->|Yes| L["Call External API"]
    L --> M["Process Response"]
    K -->|No| M
    M --> N["Format Result"]
    N --> O["JSON-RPC Response"]
    O --> P["MCP Client"]
    P --> Q["AI Agent"]
    Q --> R["Format for User"]
    R --> S["Display Result"]

    style A fill:#a484fb,stroke:#a484fb,stroke-width:2px,color:#ffffff
    style S fill:#22c55a,stroke:#22c55a,stroke-width:2px,color:#ffffff
    style F fill:#dc2626,stroke:#dc2626,stroke-width:2px,color:#ffffff
