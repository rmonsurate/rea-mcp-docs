%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#6366f1', 'primaryTextColor': '#fff', 'primaryBorderColor': '#818cf8', 'lineColor': '#94a3b8', 'secondaryColor': '#1e293b', 'tertiaryColor': '#334155'}}}%%
graph TB
    subgraph Laravel["Rea Laravel Backend"]
        Routes[API Routes]
        Controller[Agent Controller]

        subgraph Services["Service Layer"]
            AgentSvc[Agent Service]
            MCPSvc[MCP Service]
            AuthSvc[Auth Service]
        end

        subgraph MCP["MCP Integration"]
            Manager[MCP Manager]
            ClientPool[Client Pool]
            ConfigRepo[Config Repository]
        end

        subgraph Cache["Caching"]
            ToolCache[Tool Cache]
            SessionCache[Session Cache]
        end
    end

    subgraph External["External MCP Servers"]
        Notion[Notion MCP]
        Slack[Slack MCP]
        Custom[Custom MCP]
    end

    subgraph Storage["Data Storage"]
        DB[(PostgreSQL)]
        Redis[(Redis)]
        Secrets[(Vault)]
    end

    Routes --> Controller
    Controller --> AgentSvc
    AgentSvc --> MCPSvc
    MCPSvc --> Manager
    Manager --> ClientPool
    Manager --> ConfigRepo
    ClientPool --> ToolCache
    ClientPool --> SessionCache

    ConfigRepo --> DB
    ToolCache --> Redis
    SessionCache --> Redis
    AuthSvc --> Secrets

    ClientPool -.-> Notion
    ClientPool -.-> Slack
    ClientPool -.-> Custom

    style Laravel fill:#1e293b,stroke:#6366f1
    style MCP fill:#334155,stroke:#818cf8
