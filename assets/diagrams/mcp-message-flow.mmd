%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#a484fb', 'primaryTextColor': '#ffffff', 'primaryBorderColor': '#a484fb', 'secondaryColor': '#22c55a', 'lineColor': '#a484fb', 'textColor': '#f8fafc', 'actorBkg': '#a484fb', 'actorBorder': '#a484fb', 'actorTextColor': '#ffffff', 'actorLineColor': '#a484fb', 'signalColor': '#a484fb', 'signalTextColor': '#f8fafc', 'labelBoxBkgColor': '#0f172a', 'labelBoxBorderColor': '#a484fb', 'labelTextColor': '#f8fafc', 'loopTextColor': '#f8fafc', 'noteBorderColor': '#22c55a', 'noteBkgColor': '#14532d', 'noteTextColor': '#ffffff', 'activationBorderColor': '#a484fb', 'activationBkgColor': '#1e293b', 'sequenceNumberColor': '#ffffff'}}}%%
sequenceDiagram
    participant U as User
    participant R as Rea Platform
    participant A as AI Agent
    participant M as MCP Client
    participant S as MCP Server
    participant E as External API

    rect rgba(164, 132, 251, 0.15)
        Note over M,S: Initialization Phase
        M->>S: initialize(protocolVersion, capabilities)
        S-->>M: serverInfo, capabilities
        M->>S: notifications/initialized
    end

    rect rgba(34, 197, 94, 0.15)
        Note over U,E: Tool Discovery
        U->>R: "Search my Notion workspace"
        R->>A: Process user request
        A->>M: tools/list
        M->>S: tools/list
        S-->>M: Available tools
        M-->>A: [search, get_page, create_page, ...]
    end

    rect rgba(164, 132, 251, 0.15)
        Note over U,E: Tool Execution
        A->>A: Select appropriate tool
        A->>M: tools/call("search", {query: "..."})
        M->>S: tools/call
        S->>E: API Request
        E-->>S: API Response
        S-->>M: Tool result
        M-->>A: Search results
        A-->>R: Formatted response
        R-->>U: Display results
    end
