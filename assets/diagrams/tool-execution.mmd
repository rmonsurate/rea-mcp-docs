%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#6366f1', 'primaryTextColor': '#fff', 'primaryBorderColor': '#818cf8', 'lineColor': '#94a3b8', 'secondaryColor': '#1e293b', 'tertiaryColor': '#334155'}}}%%
flowchart TD
    A[User Request] --> B{AI Agent<br/>Analysis}
    B --> C[Identify Required Tool]
    C --> D[Validate Parameters]
    D --> E{Parameters<br/>Valid?}
    E -->|No| F[Return Error]
    E -->|Yes| G[MCP Client]
    G --> H[JSON-RPC Request]
    H --> I[MCP Server]
    I --> J[Execute Tool Logic]
    J --> K{External API<br/>Call?}
    K -->|Yes| L[Call External API]
    L --> M[Process Response]
    K -->|No| M
    M --> N[Format Result]
    N --> O[JSON-RPC Response]
    O --> P[MCP Client]
    P --> Q[AI Agent]
    Q --> R[Format for User]
    R --> S[Display Result]

    style A fill:#6366f1,stroke:#818cf8
    style S fill:#22c55e,stroke:#4ade80
    style F fill:#ef4444,stroke:#f87171
